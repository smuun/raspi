<!doctype html>

<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <meta name="description" content="μ΄ κΈ€μ—μ„λ” ν”„λ΅κ·Έλλ° ν•  μ μλ” μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬κ°€ μΈν„°λ½νΈλ“¤μ„ CPUλ΅ μ •ν™•ν μ „λ‹¬ν•λ„λ΅ μ„¤μ •ν•  κ²ƒμ…λ‹λ‹¤. μƒλ΅μ΄ μΈν„°λ½νΈλ“¤μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ μΈν„°λ½νΈ μ„μ μ ν…μ΄λΈ” (interrupt descriptor table)μ— μƒλ΅μ΄ μ—”νΈλ¦¬λ“¤μ„ μ¶”κ°€ν•  κ²ƒμ…λ‹λ‹¤ (μ΄μ „μ— μβ€¦">
    <meta name="author" content="Philipp Oppermann">

    
        <link rel="canonical" href="index.html" />
    
    <link href="../../css/edition-2/main.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="RSS feed for os.phil-opp.com" href="../../rss.xml" />

    <script>
        let theme = localStorage.getItem("theme");
        if (theme != null) {
            document.documentElement.setAttribute("data-theme", theme);
        }
    </script>

    <script async src="../../js/edition-2/main.js"></script>

    <title>ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ | Writing an OS in Rust</title>
</head>

<body>
    <div class="container content">
        <header class="masthead">
            <div style="position:relative">
                <h2 class="masthead-title">
                    <a href="../../index.html" title="Home">Writing an OS in Rust</a>
                </h2>
                <p><small>Philipp&nbsp;Oppermann's&nbsp;blog</small></p>
                
    <aside id="all-posts-link"><a href="https://os.phil-opp.com/ko" title="All Posts">Β« λ¨λ“  κ²μ‹κΈ€</a></aside>

            </div>
        </header>

        <div class="theme-switch">
            <div class="light-switch" onclick="toggle_lights()" title="Switch between light and dark theme"></div>
            <div class="light-switch-reset" onclick="clear_theme_override()" title="Clear the theme override and go back to the system theme"></div>
        </div>

        <div>
            
<aside id="toc-aside" class="">
        <h2>λ©μ°¨</h2>
    <ol>
        <li>
            <a href="index.html#ggayo">κ°μ”</a>
            
        </li><li>
            <a href="index.html#8259-pic">8259 PIC</a>
            <ol>
                <li>
                    <a href="index.html#guhyeon">κµ¬ν„</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#inteoreobteu-hwalsseonhwahagi">μΈν„°λ½νΈ ν™μ„±ν™”ν•κΈ°</a>
            
        </li><li>
            <a href="index.html#taimeo-inteoreobteu-ceorihagi">νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ν•κΈ°</a>
            <ol>
                <li>
                    <a href="index.html#end-of-interrupt">End of Interrupt</a>
                </li><li>
                    <a href="index.html#taimeo-sseojjeonhagi">νƒ€μ΄λ¨Έ μ„¤μ •ν•κΈ°</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#ggycag-ssantae-deadlock">κµμ°© μƒνƒ (Deadlock)</a>
            <ol>
                <li>
                    <a href="index.html#ggycag-ssantae-ileukigi">κµμ°© μƒνƒ μΌμΌν‚¤κΈ°</a>
                </li><li>
                    <a href="index.html#ggycag-ssantae-bbanjihagi">κµμ°© μƒνƒ λ°©μ§€ν•κΈ°</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#ggyeonjjaen-ssantae-race-condition-yebbanhagi">κ²½μ μƒνƒ (Race Condition) μλ°©ν•κΈ°</a>
            
        </li><li>
            <a href="index.html#hlt-myeongryeongeo">hlt λ…λ Ήμ–΄</a>
            
        </li><li>
            <a href="index.html#kibodde-ibryeog">ν‚¤λ³΄λ“ μ…λ ¥</a>
            <ol>
                <li>
                    <a href="index.html#ssekaen-kodde-hilgi">μ¤μΊ” μ½”λ“ μ½κΈ°</a>
                </li><li>
                    <a href="index.html#ssekaen-kodde-haesseohagi">μ¤μΊ” μ½”λ“ ν•΄μ„ν•κΈ°</a>
                </li><li>
                    <a href="index.html#kibodde-sseojjeonhagi">ν‚¤λ³΄λ“ μ„¤μ •ν•κΈ°</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#jjeonri">μ •λ¦¬</a>
            
        </li><li>
            <a href="index.html#daheu-ddaggyneun-muheoilggayo">λ‹¤μ λ‹¨κ³„λ” λ¬΄μ—‡μΌκΉμ”?</a>
            
        </li>
        <li class="toc-comments-link"><a href="index.html#comments">λ“κΈ€</a></li>
    </ol>
</aside>

            <main>
    <div class="">
    <h1>ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ</h1>
    <time datetime="2018-10-22" class="post-date">
        Oct 22, 2018
        
    </time>
    </div>

    
        <div class="warning">
            
            
            <p>
            <b>λ²μ—­λ λ‚΄μ© : </b>
            μ΄κ²ƒμ€ μ»¤λ®¤λ‹ν‹° λ©¤λ²„κ°€ <strong><a href="../../hardware-interrupts/index.html">Hardware Interrupts</a></strong> ν¬μ¤νΈλ¥Ό λ²μ—­ν• κΈ€μ…λ‹λ‹¤. λ¶€μ΅±ν• μ„¤λ…μ΄λ‚ μ¤λ¥, νΉμ€ μ‹κ°„μ΄ μ§€λ‚ λ” μ΄μƒ μ ν¨ν•μ§€ μ•μ€ μ •λ³΄λ¥Ό λ°κ²¬ν•μ‹λ©΄ μ λ³΄ν•΄μ£Όμ„Έμ”!
            </p>
            <p>
                λ²μ—­ν• μ‚¬λ :  <a href="https://github.com/JOE1994">@JOE1994</a>.
                <span class="translation_contributors">
                    With contributions from <a href="https://github.com/dalinaum">@dalinaum</a>.
                </span>
                </p>
            </div>
    

    <div class="">
    <p>μ΄ κΈ€μ—μ„λ” ν”„λ΅κ·Έλλ° ν•  μ μλ” μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬κ°€ μΈν„°λ½νΈλ“¤μ„ CPUλ΅ μ •ν™•ν μ „λ‹¬ν•λ„λ΅ μ„¤μ •ν•  κ²ƒμ…λ‹λ‹¤. μƒλ΅μ΄ μΈν„°λ½νΈλ“¤μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ μΈν„°λ½νΈ μ„μ μ ν…μ΄λΈ” (interrupt descriptor table)μ— μƒλ΅μ΄ μ—”νΈλ¦¬λ“¤μ„ μ¶”κ°€ν•  κ²ƒμ…λ‹λ‹¤ (μ΄μ „μ— μμ™Έ μ²λ¦¬ ν•¨μλ¥Ό λ“±λ΅ν–λ“―μ΄). λν• μΌμ • μ£ΌκΈ°λ§λ‹¤ νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ¥Ό μΌμΌν‚¤λ” λ°©λ²• λ° ν‚¤λ³΄λ“ μ…λ ¥ λ°›λ” λ°©λ²•λ„ μ•μ•„λ³Ό κ²ƒμ…λ‹λ‹¤.</p>
<span id="continue-reading"></span>
<p>μ΄ λΈ”λ΅κ·Έλ” <a href="https://github.com/phil-opp/blog_os">GitHub μ €μ¥μ†</a>μ—μ„ μ¤ν” μ†μ¤λ΅ κ°λ°λκ³  μμΌλ‹, λ¬Έμ λ‚ λ¬Έμμ‚¬ν•­μ΄ μλ‹¤λ©΄ μ €μ¥μ†μ β€Issueβ€™ κΈ°λ¥μ„ μ΄μ©ν•΄ μ λ³΄ν•΄μ£Όμ„Έμ”. <a href="index.html#comments">νμ΄μ§€ λ§¨ μ•„λ</a>μ— λ“κΈ€μ„ λ‚¨κΈ°μ‹¤ μλ„ μμµλ‹λ‹¤. μ΄ ν¬μ¤νΈμ™€ κ΄€λ ¨λ λ¨λ“  μ†μ¤ μ½”λ“λ” μ €μ¥μ†μ <a href="https://github.com/phil-opp/blog_os/tree/post-07"><code>post-07 λΈλμΉ</code></a>μ—μ„ ν™•μΈν•μ‹¤ μ μμµλ‹λ‹¤.</p>
<!-- fix for zola anchor checker (target is in template): <a id="comments"> -->

    <details id = "toc-inline">
        <summary><b>λ©μ°¨</b></summary>
        <ul>
            <li>
                <a href="index.html#ggayo">κ°μ”</a>
                
            </li><li>
                <a href="index.html#8259-pic">8259 PIC</a>
                <ul>
                    <li>
                        <a href="index.html#guhyeon">κµ¬ν„</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#inteoreobteu-hwalsseonhwahagi">μΈν„°λ½νΈ ν™μ„±ν™”ν•κΈ°</a>
                
            </li><li>
                <a href="index.html#taimeo-inteoreobteu-ceorihagi">νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ν•κΈ°</a>
                <ul>
                    <li>
                        <a href="index.html#end-of-interrupt">End of Interrupt</a>
                    </li><li>
                        <a href="index.html#taimeo-sseojjeonhagi">νƒ€μ΄λ¨Έ μ„¤μ •ν•κΈ°</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#ggycag-ssantae-deadlock">κµμ°© μƒνƒ (Deadlock)</a>
                <ul>
                    <li>
                        <a href="index.html#ggycag-ssantae-ileukigi">κµμ°© μƒνƒ μΌμΌν‚¤κΈ°</a>
                    </li><li>
                        <a href="index.html#ggycag-ssantae-bbanjihagi">κµμ°© μƒνƒ λ°©μ§€ν•κΈ°</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#ggyeonjjaen-ssantae-race-condition-yebbanhagi">κ²½μ μƒνƒ (Race Condition) μλ°©ν•κΈ°</a>
                
            </li><li>
                <a href="index.html#hlt-myeongryeongeo">hlt λ…λ Ήμ–΄</a>
                
            </li><li>
                <a href="index.html#kibodde-ibryeog">ν‚¤λ³΄λ“ μ…λ ¥</a>
                <ul>
                    <li>
                        <a href="index.html#ssekaen-kodde-hilgi">μ¤μΊ” μ½”λ“ μ½κΈ°</a>
                    </li><li>
                        <a href="index.html#ssekaen-kodde-haesseohagi">μ¤μΊ” μ½”λ“ ν•΄μ„ν•κΈ°</a>
                    </li><li>
                        <a href="index.html#kibodde-sseojjeonhagi">ν‚¤λ³΄λ“ μ„¤μ •ν•κΈ°</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#jjeonri">μ •λ¦¬</a>
                
            </li><li>
                <a href="index.html#daheu-ddaggyneun-muheoilggayo">λ‹¤μ λ‹¨κ³„λ” λ¬΄μ—‡μΌκΉμ”?</a>
                
            </li>
            <li class="toc-comments-link"><a href="index.html#comments">λ“κΈ€</a></li>
        </ul>
    </details>

<h2 id="ggayo"><a class="zola-anchor" href="index.html#ggayo" aria-label="Anchor link for: ggayo">π”—</a>κ°μ”</h2>
<p>CPUμ— μ—°κ²°λ μ£Όλ³€ μ¥μΉλ“¤μ€ μΈν„°λ½νΈλ¥Ό ν†µν•΄ CPUμ— μ•λ¦Όμ„ λ³΄λ‚Ό μ μμµλ‹λ‹¤. κ·Έλμ„ μ»¤λ„μ΄ μ£ΌκΈ°μ μΌλ΅ ν‚¤λ³΄λ“ μ…λ ¥μ΄ λ“¤μ–΄μ™”λ”μ§€ ν™•μΈν•κ² ν•λ” λ€μ‹  (μ΄λ¥Ό <a href="https://en.wikipedia.org/wiki/Polling_(computer_science)"><em>ν΄λ§(polling)</em></a> λ°©μ‹μ΄λΌκ³  ν•©λ‹λ‹¤), ν‚¤λ³΄λ“ μ…λ ¥μ΄ λ“¤μ–΄μ¬ λ•λ§λ‹¤ ν‚¤λ³΄λ“κ°€ μ§μ ‘ μ»¤λ„μ— μ•λ¦Όμ„ λ³΄λ‚Ό μ μμµλ‹λ‹¤. μ΄ λ°©μ‹μ„ μ‚¬μ©ν•λ©΄ μ΄λ²¤νΈ λ°μƒ μ‹μ—λ§ μ»¤λ„μ΄ ν–‰λ™μ„ μ·¨ν•λ©΄ λλ―€λ΅ μ—λ„μ§€ ν¨μ¨μ„±μ΄ λ” μΆ‹μµλ‹λ‹¤. λν• μ΄λ²¤νΈκ°€ λ°μƒ μ‹ μ»¤λ„μ΄ λ‹¤μ pollκΉμ§€ κΈ°λ‹¤λ¦¬μ§€ μ•κ³  λ°”λ΅ λ°μ‘ν•  μ μκΈ°μ— μ΄λ²¤νΈμ— λ€ν• λ°μ‘ μ†λ„λ„ λ” λΉ λ¦…λ‹λ‹¤.</p>
<p>ν•λ“μ›¨μ–΄ μ¥μΉλ“¤μ„ λ¨λ‘ CPUμ— μ§μ ‘ μ—°κ²°ν•λ” κ²ƒμ€ λ¶κ°€λ¥ν•©λ‹λ‹¤. λ€μ‹  λ³„λ„μ <em>μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬ (interrupt controller)</em> κ°€ μ£Όλ³€ μ¥μΉλ΅λ¶€ν„° μ „μ†΅λ μΈν„°λ½νΈλ“¤μ„ μν•©ν• λ’¤ CPUμ— μ•λ¦Όμ„ λ³΄λƒ…λ‹λ‹¤.</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>                                    ____________             _____
</span><span>               Timer ------------&gt; |            |           |     |
</span><span>               Keyboard ---------&gt; | Interrupt  |---------&gt; | CPU |
</span><span>               Other Hardware ---&gt; | Controller |           |_____|
</span><span>               Etc. -------------&gt; |____________|
</span><span>
</span></code></pre>
<p>λ€λ¶€λ¶„μ μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬λ“¤μ€ ν”„λ΅κ·Έλλ°μ„ ν†µν•΄ μΈν„°λ½νΈλ§λ‹¤ λ‹¤λ¥Έ μ°μ„ μμ„ λ λ²¨μ„ λ°°μ •ν•λ” κ²ƒμ΄ κ°€λ¥ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, ν‚¤λ³΄λ“ μΈν„°λ½νΈλ³΄λ‹¤ νƒ€μ΄λ¨Έ μΈν„°λ½νΈμ— λ” λ†’μ€ μ°μ„ μμ„ λ λ²¨μ„ λ°°μ •ν•μ—¬ CPUμ—μ„ μ‹κ°„μ„ λ” μ •ν™•ν μΈ΅μ •ν•  μ μμµλ‹λ‹¤.</p>
<p>μμ™Έμ™€ λ‹¬λ¦¬ ν•λ“μ›¨μ–΄ μΈν„°λ½νΈλ” <em>λΉ„λ™κΈ°μ μΌλ΅ (asynchronously)</em> μΌμ–΄λ‚©λ‹λ‹¤. μ¦‰ CPUμ—μ„ μ‹¤ν–‰ μ¤‘μΈ μ½”λ“μ™€ λ³„κ°λ΅ μΈν„°λ½νΈλ” μ–Έμ λ“  λ°μƒν•  μ μλ‹¤λ” κ²ƒμ…λ‹λ‹¤. λ”°λΌμ„, μ»¤λ„μ— μΈν„°λ½νΈλ¥Ό λ„μ…ν•λ©΄μ„ λ™μ‹μ„±(concurrency)μ ν•νƒκ°€ λ“±μ¥ν•κ³  λ™μ‹μ„± κ΄€λ ¨ λ²„κ·Έ λ°μƒμ κ°€λ¥μ„±λ„ μƒκΉλ‹λ‹¤. Rustμ μ—„κ²©ν• μ†μ κ¶ (ownership) λ¨λΈμ΄ μ „μ—­ κ°€λ³€ λ³€μ μ‚¬μ©μ„ κΈμ§€ν•΄ λ™μ‹μ„± κ΄€λ ¨ λ²„κ·Έ λ°μƒ κ°€λ¥μ„±μ„ μ¤„μ—¬μ£Όμ§€λ§, κµμ°© μƒνƒ(deadlock)λ¥Ό λ§‰μ•„μ£Όμ§€λ” λ»ν•λ©° μ΄λ” λ³Έλ¬Έ μ•„λμ—μ„ κ³§ ν™•μΈν•μ‹¤ μ μμµλ‹λ‹¤.</p>
<h2 id="8259-pic"><a class="zola-anchor" href="index.html#8259-pic" aria-label="Anchor link for: 8259-pic">π”—</a>8259 PIC</h2>
<p><a href="https://en.wikipedia.org/wiki/Intel_8259">Intel 8259</a> λ” ν”„λ΅κ·Έλλ° κ°€λ¥ν• μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬ (PIC; Programmable Interrupt Controller)μ΄λ©°, 1976λ…„μ— μ²μ λ„μ…λμ—μµλ‹λ‹¤. μ΄ μ¥μΉλ” μ¤λμ „μ— μ‹ ν• μ¥μΉ <a href="https://en.wikipedia.org/wiki/Intel_APIC_Architecture">APIC</a>λ΅ λ€μ²΄λμ§€λ§, μ΄μ „ λ²„μ „κ³Όμ νΈν™μ„± μ μ§€λ¥Ό μ„ν•΄ κ·Έ μΈν„°νμ΄μ¤λ§μ€ μµμ‹  μ‹μ¤ν…λ“¤λ„ μ§€μ›ν•κ³  μμµλ‹λ‹¤. 8259 PICλ¥Ό λ‹¤λ£¨λ” κ²ƒμ΄ APICλ¥Ό λ‹¤λ£¨λ” κ²ƒλ³΄λ‹¤ μ‰½μµλ‹λ‹¤. κ·Έλ ‡κΈ°μ— μΈν„°λ½νΈμ— λ€ν•΄ λ°°μ°κ³  μ…λ¬Έν•λ” ν„μ¬ λ‹¨κ³„μ—μ„λ” 8259 PICλ¥Ό μ“°κ³ , μ΄ λΈ”λ΅κ·Έ μ‹λ¦¬μ¦μ μ΄ν›„ κΈ€μ—μ„λ” APICλ΅ κµμ²΄ν•μ—¬ μ‚¬μ©ν•κ² μµλ‹λ‹¤.</p>
<p>Intel 8259 PICλ” 8κ°μ μΈν„°λ½νΈ ν†µμ‹ μ„ κ³Ό CPUμ™€ ν†µμ‹ ν•κΈ° μ„ν• λ‡ κ°μ ν†µμ‹ μ„ μ„ κ°€μ§‘λ‹λ‹¤. κ³Όκ±°μ μ „ν•μ μΈ PC μ‹μ¤ν…μ€ 8259 PICλ¥Ό 2κ° μ¥μ°©ν•κ³  μμ—λ”λ° (μ£Ό PICμ™€ λ¶€ PIC), μ£Ό PICμ μΈν„°λ½νΈ ν†µμ‹ μ„  μ¤‘ ν•λ‚λ¥Ό λ¶€ PICμ— μ—°κ²°ν–μµλ‹λ‹¤.</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>                     ____________                          ____________
</span><span>Real Time Clock --&gt; |            |   Timer -------------&gt; |            |
</span><span>ACPI -------------&gt; |            |   Keyboard-----------&gt; |            |      _____
</span><span>Available --------&gt; | Secondary  |----------------------&gt; | Primary    |     |     |
</span><span>Available --------&gt; | Interrupt  |   Serial Port 2 -----&gt; | Interrupt  |---&gt; | CPU |
</span><span>Mouse ------------&gt; | Controller |   Serial Port 1 -----&gt; | Controller |     |_____|
</span><span>Co-Processor -----&gt; |            |   Parallel Port 2/3 -&gt; |            |
</span><span>Primary ATA ------&gt; |            |   Floppy disk -------&gt; |            |
</span><span>Secondary ATA ----&gt; |____________|   Parallel Port 1----&gt; |____________|
</span><span>
</span></code></pre>
<p>μ„ λ„ν‘λ” μΈν„°λ½νΈ ν†µμ‹ μ„ μ„ λ°°μ •ν•λ” μ „ν•μ μΈ λ°©μ‹μ„ λ³΄μ—¬μ¤λ‹λ‹¤. 15κ°μ μ„  μ¤‘ λ€λ¶€λ¶„μ€ μ–΄λ–¤ μ¥μΉμ™€ μ—°κ²°ν• μ§€ μ΄λ―Έ μ •ν•΄μ Έ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, λ¶€ PICμ 4λ² ν†µμ‹ μ„ μ€ λ§μ°μ¤μ— μ—°κ²°λ©λ‹λ‹¤.</p>
<p>κ° μ»¨νΈλ΅¤λ¬λ” β€commandβ€ ν¬νΈμ™€ β€dataβ€ ν¬νΈ, μ΄ 2κ°μ <a href="../../testing/index.html#i-o-ports">μ…μ¶λ ¥ ν¬νΈ</a>λ“¤μ„ μ‚¬μ©ν•΄ μ„¤μ •ν•©λ‹λ‹¤. μ£Ό PICλ” <code>0x20</code>λ² ν¬νΈκ°€ command ν¬νΈ, <code>0x21</code>λ² ν¬νΈκ°€ data ν¬νΈμ…λ‹λ‹¤. λ¶€ PICλ” <code>0xa0</code>λ² ν¬νΈκ°€ command ν¬νΈ, <code>0xa1</code> ν¬νΈκ°€ data ν¬νΈμ…λ‹λ‹¤. PICλ¥Ό μ„¤μ •ν•λ” μμ„Έν• λ°©λ²•μ— λ€ν•΄μ„λ” <a href="https://wiki.osdev.org/8259_PIC">osdev.orgμ κΈ€</a>μ„ μ°Ύμ•„λ³΄μ‹κΈΈ λ°”λλ‹λ‹¤.</p>
<h3 id="guhyeon"><a class="zola-anchor" href="index.html#guhyeon" aria-label="Anchor link for: guhyeon">π”—</a>κµ¬ν„</h3>
<p>μ„ PICλ“¤μ κΈ°λ³Έ μ„¤μ •μ—μ„ PICλ” 0-15 κµ¬κ°„μ μΈν„°λ½νΈ λ²΅ν„° λ²νΈλ¥Ό CPUμ— μ „μ†΅ν•©λ‹λ‹¤. IDTμ—μ„ μ΄ κµ¬κ°„μ μΈν„°λ½νΈ λ²΅ν„° λ²νΈλ“¤μ€ μ΄λ―Έ CPU μμ™Έλ“¤μ— λ°°μ •λμ–΄ μκΈ°μ—, PICμ κΈ°λ³Έ μ„¤μ •μ„ κ·Έλ€λ΅ μ‚¬μ©ν•μ§€ λ»ν•©λ‹λ‹¤. μλ¥Ό λ“¤λ©΄ λ²΅ν„° λ²νΈ 8μ€ λ”λΈ” ν΄νΈμ— λ°°μ •λμ–΄ μμµλ‹λ‹¤. λ²΅ν„° λ²νΈκ°€ μ¤‘λ³µλλ” λ¬Έμ λ¥Ό ν•΄κ²°ν•λ ¤λ©΄ PICκ°€ μ „μ†΅ν•λ” μΈν„°λ½νΈλ“¤μ„ λ‹¤λ¥Έ λ²΅ν„° λ²νΈμ— μ¬λ°°μ • ν•΄μ•Ό ν•©λ‹λ‹¤. κΈ°μ΅΄ μμ™Έλ“¤μ λ²΅ν„° λ²νΈμ™€ κ²ΉμΉμ§€ μ•λ” μ΄μƒ μΈν„°λ½νΈλ“¤μ— μ–΄λ–¤ λ²νΈλ¥Ό λ°°μ •ν•λ”μ§€λ” ν¬κ² μ¤‘μ”ν•μ§€ μ•μµλ‹λ‹¤λ§, μμ™Έλ“¤μ— λ°°μ •λ μ²« 32κ°μ μ¬λ΅― λ‹¤μ λΉ„λ” 32-47 κµ¬κ°„μ λ²΅ν„° λ²νΈλ¥Ό κ³ λ¥΄λ” κ²ƒμ΄ μΌλ°μ μ…λ‹λ‹¤.</p>
<p>PIC μ¥μΉμ command ν¬νΈ λ° data ν¬νΈμ— νΉμν• κ°’μ„ μ“°λ©΄ μ¥μΉ μ„¤μ •μ„ λ³€κ²½ν•  μ μμµλ‹λ‹¤. μ΄ μΆ‹κ²λ„ <a href="https://docs.rs/pic8259/0.10.1/pic8259/"><code>pic8259</code></a> ν¬λ μ΄νΈ λ•μ— μ°λ¦¬κ°€ μ¥μΉ μ„¤μ • μ΄κΈ°ν™”/λ³€κ²½ λ΅μ§μ„ μ§μ ‘ μ‘μ„±ν•  ν•„μ”λ” μ—†μµλ‹λ‹¤. μ‘λ™ μ›λ¦¬κ°€ κ¶κΈν•μ‹λ‹¤λ©΄ ν•΄λ‹Ή ν¬λ μ΄νΈμ <a href="https://docs.rs/crate/pic8259/0.10.1/source/src/lib.rs">μ†μ¤ μ½”λ“</a>λ¥Ό μ§μ ‘ ν™•μΈν•΄λ³΄μ„Έμ”. μ½”λ“μ–‘μ΄ λ§μ§€ μ•κ³  λ¬Έμ„ν™”λ„ μ λμ–΄ μμµλ‹λ‹¤.</p>
<p>μμ΅΄ ν¬λ μ΄νΈλ΅ ν•΄λ‹Ή ν¬λ μ΄νΈλ¥Ό μ¶”κ°€ν•κΈ° μ„ν•΄ μ•„λμ μ½”λ“λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">dependencies</span><span>]
</span><span style="color:#569cd6;">pic8259 </span><span>= </span><span style="color:#d69d85;">&quot;0.10.1&quot;
</span></code></pre>
<p>μ΄ ν¬λ μ΄νΈμ <a href="https://docs.rs/pic8259/0.10.1/pic8259/struct.ChainedPics.html"><code>ChainedPics</code></a> κµ¬μ΅°μ²΄λ” μ„μ—μ„ λ΄¤λ μ£Ό/λ¶€ PIC μ—°κ²° λ°©μ‹μ„ μ μ ν• μ¶”μƒ λ λ²¨μ—μ„ ν‘ν„ν•©λ‹λ‹¤. μ΄ κµ¬μ΅°μ²΄λ” μ•„λμ²λΌ μ‚¬μ©ν•λ„λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">use </span><span>pic8259::ChainedPics;
</span><span style="color:#569cd6;">use</span><span> spin;
</span><span>
</span><span style="color:#569cd6;">pub const </span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#b5cea8;">32</span><span>;
</span><span style="color:#569cd6;">pub const </span><span style="color:#b4cea8;">PIC_2_OFFSET</span><span>: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#b4cea8;">PIC_1_OFFSET </span><span>+ </span><span style="color:#b5cea8;">8</span><span>;
</span><span>
</span><span style="color:#569cd6;">pub static </span><span style="color:#b4cea8;">PICS</span><span>: spin::Mutex&lt;ChainedPics&gt; =
</span><span>    spin::Mutex::new(</span><span style="color:#569cd6;">unsafe </span><span>{ ChainedPics::new(</span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>, </span><span style="color:#b4cea8;">PIC_2_OFFSET</span><span>) });
</span></code></pre>
<p>μ„μ—μ„ μ–ΈκΈ‰ν–λ“―μ΄ PICλ“¤μ΄ μ‚¬μ©ν•  λ²΅ν„° λ²νΈμ μ¤ν”„μ…‹μ„ 32-47 κµ¬κ°„μ—μ„ μ„ νƒν•©λ‹λ‹¤. <code>ChainedPics</code> κµ¬μ΅°μ²΄λ¥Ό κ°μ‹Ό <code>Mutex</code>μ <code>lock</code> ν•¨μλ¥Ό ν†µν•΄ μ•μ „ν•κ² κ°’μ„ μμ •ν•  μ μλ”λ°, μ΄λ” λ‹¤μ λ‹¨κ³„μ—μ„ μ μ©ν•©λ‹λ‹¤. <code>ChainedPics::new</code> ν•¨μμ— μλ»λ μ¤ν”„μ…‹μ„ λ„κΈ°λ©΄ undefined behaviorκ°€ μΌμ–΄λ‚  μ μμ–΄ μ΄ ν•¨μλ” unsafe ν•¨μλ΅ μ •μλμ—μµλ‹λ‹¤.</p>
<p>μ΄μ  <code>init</code> ν•¨μμ—μ„ 8259 PIC μ¥μΉλ¥Ό μ΄κΈ°ν™”ν•  μ μμµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>init() {
</span><span>    gdt::init();
</span><span>    interrupts::init_idt();
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{ interrupts::</span><span style="color:#b4cea8;">PICS</span><span>.lock().initialize() }; </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>}
</span></code></pre>
<p><a href="https://docs.rs/pic8259/0.10.1/pic8259/struct.ChainedPics.html#method.initialize"><code>initialize</code></a> ν•¨μλ¥Ό μ‚¬μ©ν•΄ PIC μ¥μΉλ¥Ό μ΄κΈ°ν™”ν•©λ‹λ‹¤.  PIC μ¥μΉλ¥Ό μλ» μ΄κΈ°ν™”ν•λ©΄ undefined behaviorλ¥Ό μΌμΌν‚¬ μ μμΌλ―€λ΅, <code>ChainedPics::new</code> ν•¨μμ™€ λ§μ°¬κ°€μ§€λ΅ μ΄ ν•¨μλ„ unsafe ν•¨μλ΅ μ •μλμ—μµλ‹λ‹¤.</p>
<p>μ¶”κ°€ν• μ½”λ“μ— λ¬Έμ κ°€ μ—†μ—λ‹¤λ©΄, λ‹¤μ‹ <code>cargo run</code>μ„ μ‹¤ν–‰ν•΄λ„ μμ „μ²λΌ β€It did not crashβ€λΌλ” λ©”μ‹μ§€κ°€ μ¶λ ¥λ  κ²ƒμ…λ‹λ‹¤.</p>
<h2 id="inteoreobteu-hwalsseonhwahagi"><a class="zola-anchor" href="index.html#inteoreobteu-hwalsseonhwahagi" aria-label="Anchor link for: inteoreobteu-hwalsseonhwahagi">π”—</a>μΈν„°λ½νΈ ν™μ„±ν™”ν•κΈ°</h2>
<p>CPU μ„¤μ •μ—μ„ μΈν„°λ½νΈ μ‚¬μ©μ΄ ν•΄μ λμ–΄ μμ—κΈ°μ— μ•„μ§ μ•„λ¬΄ μΌλ„ μΌμ–΄λ‚μ§€ μ•μ•μµλ‹λ‹¤. μΈν„°λ½νΈ μ‚¬μ©μ΄ ν•΄μ λμ–΄ μμΌλ©΄ CPUλ” μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬λ¶€ν„° μ¤λ” μ‹ νΈλ¥Ό μ „ν€ λ°›μ§€ μ•κ³ , λ”°λΌμ„ μ–΄λ–¤ μΈν„°λ½νΈλ„ CPUμ— λ„λ‹¬ν•  μ μ—†μµλ‹λ‹¤. CPU μ„¤μ •μ„ λ°”κΏ”λ³΄κ² μµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>init() {
</span><span>    gdt::init();
</span><span>    interrupts::init_idt();
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{ interrupts::</span><span style="color:#b4cea8;">PICS</span><span>.lock().initialize() };
</span><span>    x86_64::instructions::interrupts::enable();     </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>}
</span></code></pre>
<p><code>x86_64</code> ν¬λ μ΄νΈμ <code>interrupts::enable</code> ν•¨μλ” <code>sti</code> λ…λ Ήμ–΄ (β€set interruptsβ€)λ¥Ό μ‹¤ν–‰ν•΄ μ™Έλ¶€ μΈν„°λ½νΈλ¥Ό μ‚¬μ©ν•λ„λ΅ μ„¤μ •ν•©λ‹λ‹¤. μ΄μ  <code>cargo run</code>μ„ μ‹¤ν–‰ν•λ©΄ λ”λΈ” ν΄νΈκ°€ λ°μƒν•λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.</p>
<p><img src="qemu-hardware-timer-double-fault.png" alt="QEMU printing EXCEPTION: DOUBLE FAULT because of hardware timer" /></p>
<p>λ”λΈ” ν΄νΈκ°€ λ°μƒν•λ” μ΄μ λ”, <a href="https://en.wikipedia.org/wiki/Intel_8253">Intel 8253</a> μ¥μΉμ—μ„ κΈ°λ³Έμ μΌλ΅ ν•λ“μ›¨μ–΄ νƒ€μ΄λ¨Έλ¥Ό μ‚¬μ©ν•λ„λ΅ μ„¤μ •μ΄ λμ–΄ μκ³ , CPUμ—μ„ μΈν„°λ½νΈ μ‚¬μ©μ„ ν™μ„±ν™”ν• μ§ν›„λ¶€ν„° νƒ€μ΄λ¨Έ μΈν„°λ½νΈκ°€ CPUλ΅ μ „μ†΅λκΈ° λ•λ¬Έμ…λ‹λ‹¤. μ°λ¦¬κ°€ μ•„μ§ νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μλ¥Ό μ •μν•μ§€ μ•μ•κΈ° λ•λ¬Έμ— λ”λΈ” ν΄νΈ μ²λ¦¬ ν•¨μκ°€ νΈμ¶λ©λ‹λ‹¤.</p>
<h2 id="taimeo-inteoreobteu-ceorihagi"><a class="zola-anchor" href="index.html#taimeo-inteoreobteu-ceorihagi" aria-label="Anchor link for: taimeo-inteoreobteu-ceorihagi">π”—</a>νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ν•κΈ°</h2>
<p><a href="index.html#8259-pic">μ„ λ„ν‘</a>λ¥Ό λ³΄λ©΄ νƒ€μ΄λ¨Έλ” μ£Ό PICμ 0λ² ν†µμ‹ μ„ μ„ μ‚¬μ©ν•©λ‹λ‹¤. μ΄λ” μ¦‰ νƒ€μ΄λ¨Έ μΈν„°λ½νΈκ°€ CPUμ— μΈν„°λ½νΈ λ²΅ν„° λ²νΈκ°€ 32 (0 + μ¤ν”„μ…‹ 32)μΈ μΈν„°λ½νΈλ΅ μ „μ†΅λλ‹¤λ” κ²ƒμ„ λ»ν•©λ‹λ‹¤. μ½”λ“μ— λ²νΈ 32λ¥Ό κ·Έλ€λ΅ μ μ§€ μ•κ³  <code>InterruptIndex</code> enumμ— μ €μ¥ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span>#[derive(Debug, Clone, Copy)]
</span><span>#[repr(u8)]
</span><span style="color:#569cd6;">pub enum </span><span>InterruptIndex {
</span><span>    Timer = </span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>,
</span><span>}
</span><span>
</span><span style="color:#569cd6;">impl </span><span>InterruptIndex {
</span><span>    </span><span style="color:#569cd6;">fn </span><span>as_u8(self) -&gt; </span><span style="color:#569cd6;">u8 </span><span>{
</span><span>        self </span><span style="color:#569cd6;">as u8
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">fn </span><span>as_usize(self) -&gt; </span><span style="color:#569cd6;">usize </span><span>{
</span><span>        </span><span style="color:#569cd6;">usize</span><span>::from(self.as_u8())
</span><span>    }
</span><span>}
</span></code></pre>
<p><a href="https://doc.rust-lang.org/reference/items/enumerations.html#custom-discriminant-values-for-fieldless-enumerations">Cμ–Έμ–΄μ enum</a>μ²λΌ μ΄ enumμ€ κ° λ¶„λ¥μ— μ‚¬μ©ν•  μΈλ±μ¤ κ°’μ„ μ§€μ •ν•  μ μμµλ‹λ‹¤. <code>repr(u8)</code> μ†μ„±μ€ ν•΄λ‹Ή enumμ„ <code>u8</code> νƒ€μ…μΌλ΅μ„ μ €μ¥ λ° ν‘ν„λλ„λ΅ ν•©λ‹λ‹¤. ν–¥ν›„μ— μƒλ΅μ΄ μΈν„°λ½νΈλ“¤μ„ μ§€μ›ν•΄μ•Ό ν•  λ• μ΄ enumμ— μƒλ΅μ΄ λ¶„λ¥λ¥Ό μ¶”κ°€ν•  κ²ƒμ…λ‹λ‹¤.</p>
<p>μ΄μ  νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•  ν•¨μλ¥Ό μ‘μ„±ν•  μ μμµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">use crate</span><span>::print;
</span><span>
</span><span>lazy_static! {
</span><span>    </span><span style="color:#569cd6;">static ref </span><span style="color:#b4cea8;">IDT</span><span>: InterruptDescriptorTable = {
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> idt = InterruptDescriptorTable::new();
</span><span>        idt.breakpoint.set_handler_fn(breakpoint_handler);
</span><span>        [β€¦]
</span><span>        idt[InterruptIndex::Timer.as_usize()]
</span><span>            .set_handler_fn(timer_interrupt_handler); </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>
</span><span>        idt
</span><span>    };
</span><span>}
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>timer_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    print!(</span><span style="color:#d69d85;">&quot;.&quot;</span><span>);
</span><span>}
</span></code></pre>
<p><code>timer_interrupt_handler</code> ν•¨μλ” μ°λ¦¬κ°€ κ°€μ§„ λ‹¤λ¥Έ μμ™Έ μ²λ¦¬ ν•¨μλ“¤κ³Ό κ°™μ€ ν•¨μ μ›ν•μ„ κ°€μ§€λ”λ°, κ·Έ μ΄μ λ” CPUκ°€ μμ™Έμ™€ μΈν„°λ½νΈμ— κ°™μ€ λ°©μ‹μΌλ΅ λ€μ‘ν•κΈ° λ•λ¬Έμ…λ‹λ‹¤ (μ μΌν• μ°¨μ΄μ μ€ μΌλ¶€ μμ™Έλ“¤μ΄ μ¤λ¥ μ½”λ“λ¥Ό μ¶”κ°€λ΅ pushν•λ‹¤λ” κ²ƒ). <a href="https://docs.rs/x86_64/0.14.2/x86_64/structures/idt/struct.InterruptDescriptorTable.html"><code>InterruptDescriptorTable</code></a> κµ¬μ΅°μ²΄λ” <a href="https://doc.rust-lang.org/core/ops/trait.IndexMut.html"><code>IndexMut</code></a> νΈλ μ΄νΈλ¥Ό κµ¬ν„ν•΄μ„ λ°°μ—΄μ„ μƒ‰μΈν•λ” κ²ƒκ³Ό λ™μΌν• λ¬Έλ²•μ„ μ¨μ„ ν…μ΄λΈ”μ κ° μ—”νΈλ¦¬μ— μ ‘κ·Όν•  μ μμµλ‹λ‹¤.</p>
<p>μ°λ¦¬κ°€ μ‘μ„±ν• νƒ€μ΄λ¨Έ μΈνΈλ½νΈ μ²λ¦¬ ν•¨μλ” ν™”λ©΄μ— μ μ„ μ¶λ ¥ν•©λ‹λ‹¤. νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ” μ£ΌκΈ°μ μΌλ΅ λ°μƒν•λ―€λ΅, νƒ€μ΄λ¨Έ μ£ΌκΈ°λ§λ‹¤ ν™”λ©΄μ— μƒλ΅μ΄ μ μ΄ μ¶λ ¥λκΈ°λ¥Ό κΈ°λ€ν•λ” κ²ƒμ΄ μμ—°μ¤λ½μµλ‹λ‹¤. ν•μ§€λ§ μ»¤λ„μ„ μ‹¤ν–‰ν•΄ λ³΄λ©΄ ν™”λ©΄μ— μ μ΄ λ‹¨ 1κ°λ§ μ¶λ ¥λ  κ²ƒμ…λ‹λ‹¤.</p>
<p><img src="qemu-single-dot-printed.png" alt="QEMU printing only a single dot for hardware timer" /></p>
<h3 id="end-of-interrupt"><a class="zola-anchor" href="index.html#end-of-interrupt" aria-label="Anchor link for: end-of-interrupt">π”—</a>End of Interrupt</h3>
<p>μ μ΄ 1κ°λ§ μ¶λ ¥λλ” μ΄μ λ” PICκ°€ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μλ΅λ¶€ν„° λ…μ‹μ μΌλ΅ β€end of interruptβ€ (EOI) μ‹ νΈκ°€ μ „μ†΅λμ–΄ μ¤κΈ°λ¥Ό κΈ°λ‹¤λ¦¬κΈ° λ•λ¬Έμ…λ‹λ‹¤. μ΄ μ‹ νΈλ” PICμ— ν•΄λ‹Ή μΈν„°λ½νΈκ°€ μ²λ¦¬λμ—μΌλ©° μ‹μ¤ν…μ΄ λ‹¤μ μΈν„°λ½νΈλ¥Ό λ°›μ„ μ¤€λΉ„κ°€ λ κ²ƒμ„ μ•λ¦½λ‹λ‹¤. μ‹ νΈλ¥Ό λ°›μ§€ λ»ν• PICλ” μ‹μ¤ν…μ΄ μ•„μ§ μ²« νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ μ¤‘μ΄λΌ μƒκ°ν•κ³  EOI μ‹ νΈκ°€ μ¬ λ•κΉμ§€ λ‹¤μ μΈν„°λ½νΈλ¥Ό λ³΄λ‚΄μ§€ μ•κ³  κΈ°λ‹¤λ¦¬λ” κ²ƒμ…λ‹λ‹¤.</p>
<p>staticμΌλ΅ μ„ μ–Έλ <code>PICS</code> κµ¬μ΅°μ²΄λ¥Ό λ‹¤μ‹ μ‚¬μ©ν•΄ EOI μ‹ νΈλ¥Ό λ³΄λƒ…λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>timer_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    print!(</span><span style="color:#d69d85;">&quot;.&quot;</span><span>);
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Timer.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p><code>notify_end_of_interrupt</code> ν•¨μλ” μ£Ό PICμ™€ λ¶€ PIC μ¤‘ λ„κ°€ μΈν„°λ½νΈλ¥Ό λ³΄λƒμ—λ”μ§€ νμ•…ν•κ³ , κ·Έ ν›„ <code>command</code> ν¬νΈμ™€ <code>data</code> ν¬νΈλ¥Ό μ‚¬μ©ν•΄ μΈν„°λ½νΈλ¥Ό μ „μ†΅ν–λ PICλ΅ EOI μ‹ νΈλ¥Ό λ³΄λƒ…λ‹λ‹¤. λ¶€ PICκ°€ μΈν„°λ½νΈλ¥Ό λ³΄λƒμ—λ‹¤λ©΄, λ¶€ PICκ°€ μ£Ό PICμ μ…λ ¥ ν†µμ‹ μ„ μ— μ—°κ²°λμ–΄ μλ‹¤ λ³΄λ‹ λ‘ PIC λ¨λ‘ EOI μ‹ νΈλ¥Ό λ°›κ² λ©λ‹λ‹¤.</p>
<p>μ—¬κΈ°μ„ μ°λ¦¬λ” μ¬λ°”λ¥Έ μΈν„°λ½νΈ λ²΅ν„° λ²νΈλ¥Ό μ‚¬μ©ν•λ„λ΅ μ£Όμν•΄μ•Ό ν•©λ‹λ‹¤. μλ»λ λ²νΈλ¥Ό μ“°λ©΄, μ•„μ§ CPUλ΅ μ „μ†΅ν•μ§€ μ•μ€ μ¤‘μ”ν• μΈν„°λ½νΈκ°€ μ†μ‹¤λκ±°λ‚ μ‹μ¤ν…μ΄ μ•„λ¬΄ λ°μ‘λ„ ν•μ§€ μ•κ² λ  μ μμµλ‹λ‹¤. μ΄λ° μ΄μ λ΅ <code>notify_end_of_interrupt</code> ν•¨μκ°€ <code>unsafe</code>λ΅ μ„ μ–Έλ κ²ƒμ…λ‹λ‹¤.</p>
<p>λ‹¤μ‹ <code>cargo run</code>μ„ μ‹¤ν–‰ν•λ©΄ ν™”λ©΄μ— μ£ΌκΈ°μ μΌλ΅ μ μ΄ μ°νλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.</p>
<p><img src="qemu-hardware-timer-dots.gif" alt="QEMU printing consecutive dots showing the hardware timer" /></p>
<h3 id="taimeo-sseojjeonhagi"><a class="zola-anchor" href="index.html#taimeo-sseojjeonhagi" aria-label="Anchor link for: taimeo-sseojjeonhagi">π”—</a>νƒ€μ΄λ¨Έ μ„¤μ •ν•κΈ°</h3>
<p>μ°λ¦¬κ°€ μ“°λ” ν•λ“μ›¨μ–΄ νƒ€μ΄λ¨Έλ” <em>Programmable Interval Timer</em>, λλ” μ¤„μ—¬μ„ PITλΌκ³  λ¶€λ¦…λ‹λ‹¤. μ΄λ¦„μ—μ„ μ• μ μλ“―μ΄, ν”„λ΅κ·Έλλ°μ„ ν†µν•΄ μΈν„°λ½νΈ μ‚¬μ΄ μ‹κ°„ κ°„κ²©μ„ μ΅°μ •ν•  μ μμµλ‹λ‹¤. κ³§ <a href="https://wiki.osdev.org/APIC_timer">APIC νƒ€μ΄λ¨Έ</a>λ΅ κµμ²΄ν•΄ μ‚¬μ©ν•  κ²ƒμ΄κΈ° λ•λ¬Έμ— PITμ— λ€ν•΄ μμ„Έν λ‹¤λ£¨μ§€λ” μ•κ² μµλ‹λ‹¤λ§, OSDev μ„ν‚¤μ— <a href="https://wiki.osdev.org/Programmable_Interval_Timer">PITλ¥Ό μ„¤μ •ν•λ” λ°©λ²•</a>μ— λ€ν• μμ„Έν• κΈ€μ΄ μμΌλ‹ μ°Έκ³ ν•μ‹κΈ° λ°”λλ‹λ‹¤.</p>
<h2 id="ggycag-ssantae-deadlock"><a class="zola-anchor" href="index.html#ggycag-ssantae-deadlock" aria-label="Anchor link for: ggycag-ssantae-deadlock">π”—</a>κµμ°© μƒνƒ (Deadlock)</h2>
<p>μ΄μ  μ°λ¦¬μ μ»¤λ„μ— λ™μ‹μ„±μ κ°λ…μ΄ λ“±μ¥ν–μµλ‹λ‹¤. νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ” λΉ„λ™κΈ°μ μΌλ΅ λ°μƒν•κΈ°μ— <code>_start</code> ν•¨μ μ‹¤ν–‰ μ¤‘ μ–Έμ λ“  λ°μƒν•  μ μμµλ‹λ‹¤. Rustμ μ†μ κ¶ (ownership) μ‹μ¤ν…μ΄ λ‹¤μ–‘ν• λ™μ‹μ„± κ΄€λ ¨ λ²„κ·Έλ¥Ό μ»΄νμΌ μ‹κ°„μ— λ°©μ§€ν•μ§€λ§, κµμ°© μƒνƒλ” λ§‰μ§€ λ»ν•©λ‹λ‹¤. μ¤λ λ“(thread)κ°€ ν•΄μ λμ§€ μ•μ„ lockμ„ μ–»μΌλ ¤κ³  ν•  λ• κµμ°© μƒνƒκ°€ μΌμ–΄λ‚λ©°, ν•΄λ‹Ή μ¤λ λ“λ” μμ›ν λ€κΈ° μƒνƒμ— κ°‡νκ² λ©λ‹λ‹¤.</p>
<p>ν„μ¬ μ°λ¦¬μ μ»¤λ„μ—μ„ κµμ°© μƒνƒλ¥Ό μΌμΌν‚¬ μ μμµλ‹λ‹¤. μ°λ¦¬κ°€ μ“°λ” <code>println</code> λ§¤ν¬λ΅κ°€ νΈμ¶ν•λ” <code>vga_buffer::_print</code> ν•¨μλ” μ¤ν•€ λ½(spinlock)μ„ ν†µν•΄ <a href="../../vga-text-mode/index.html#spinlocks">μ „μ—­ λ³€μ <code>WRITER</code>μ— λ€ν• lockμ„ μ κΈ‰λ‹λ‹¤</a>.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>[β€¦]
</span><span>
</span><span>#[doc(hidden)]
</span><span style="color:#569cd6;">pub fn </span><span>_print(args: fmt::Arguments) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#b4cea8;">WRITER</span><span>.lock().write_fmt(args).unwrap();
</span><span>}
</span></code></pre>
<p>μ„ ν•¨μλ” <code>WRITER</code>μ— λ€ν• lockμ„ μ κ·Έκ³  <code>write_fmt</code>λ¥Ό νΈμ¶ν•λ©°, μ„ ν•¨μμ λ°ν™ μ§μ „μ— <code>WRITER</code>μ— λ€ν• lockμ„ μ•”λ¬µμ μΌλ΅ ν•΄μ ν•©λ‹λ‹¤. <code>WRITER</code>μ— λ€ν• lockμ΄ μ κΈ΄ μƒνƒμ—μ„ μΈν„°λ½νΈκ°€ λ°μƒν•κ³ , ν•΄λ‹Ή μΈν„°λ½νΈμ μ²λ¦¬ ν•¨μκ°€ ν™”λ©΄μ— λ­”κ°€ μ¶λ ¥ν•λ ¤ ν•λ‹¤κ³  κ°€μ •ν•΄λ΄…μ‹λ‹¤.</p>
<table><thead><tr><th>μ‹κ°„ μμ„</th><th>_start</th><th>μΈν„°λ½νΈ μ²λ¦¬ ν•¨μ</th></tr></thead><tbody>
<tr><td>0</td><td><code>println!</code> νΈμ¶</td><td>Β </td></tr>
<tr><td>1</td><td><code>print</code>κ°€ <code>WRITER</code>λ¥Ό μ κΈ</td><td>Β </td></tr>
<tr><td>2</td><td></td><td><strong>μΈν„°λ½νΈ λ°μƒ</strong>, μΈν„°λ½νΈ μ²λ¦¬ ν•¨μ μ‹¤ν–‰ μ‹μ‘</td></tr>
<tr><td>3</td><td></td><td><code>println!</code> νΈμ¶</td></tr>
<tr><td>4</td><td></td><td><code>print</code>κ°€ μ΄λ―Έ μ κΈ΄ <code>WRITER</code>λ¥Ό λ μ κ·Έλ ¤κ³  ν•¨</td></tr>
<tr><td>5</td><td></td><td><code>print</code>κ°€ μ΄λ―Έ μ κΈ΄ <code>WRITER</code>λ¥Ό λ μ κ·Έλ ¤κ³  ν•¨</td></tr>
<tr><td>β€¦</td><td></td><td>β€¦</td></tr>
<tr><td><em>never</em></td><td><em><code>WRITER</code> μ κΈ ν•΄μ </em></td><td></td></tr>
</tbody></table>
<p><code>WRITER</code>μ— λ€ν• lockμ΄ μ κ²¨ μμΌλ‹, μΈν„°λ½νΈ μ²λ¦¬ ν•¨μλ” ν•΄λ‹Ή lockμ΄ ν’€λ¦΄ λ•κΉμ§€ κΈ°λ‹¤λ¦½λ‹λ‹¤. ν•μ§€λ§ <code>_start</code> ν•¨μλ” μΈν„°λ½νΈ μ²λ¦¬ ν•¨μκ°€ λ°ν™ν• ν›„μ— μ‹¤ν–‰μ„ μ¬κ°ν•κΈ° λ•λ¬Έμ— lockμ΄ ν’€λ¦¬μ§€ μ•μµλ‹λ‹¤. κ·Έ κ²°κ³Ό, μ‹μ¤ν… μ „μ²΄κ°€ μ‘λ‹µ λ¶κ°€ μƒνƒκ°€ λ©λ‹λ‹¤.</p>
<h3 id="ggycag-ssantae-ileukigi"><a class="zola-anchor" href="index.html#ggycag-ssantae-ileukigi" aria-label="Anchor link for: ggycag-ssantae-ileukigi">π”—</a>κµμ°© μƒνƒ μΌμΌν‚¤κΈ°</h3>
<p><code>_start</code> ν•¨μμ λ§¨ λ§μ§€λ§‰ loop μ•μ—μ„ ν™”λ©΄μ— μ¶λ ¥μ„ μ‹λ„ν•λ©΄ μ‰½κ² μ»¤λ„μ— κµμ°© μƒνƒλ¥Ό μΌμΌν‚¬ μ μμµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    [β€¦]
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{
</span><span>        </span><span style="color:#569cd6;">use </span><span>blog_os::print;
</span><span>        print!(</span><span style="color:#d69d85;">&quot;-&quot;</span><span>);        </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>    }
</span><span>}
</span></code></pre>
<p>QEMUμ—μ„ μ‹¤ν–‰ν•λ©΄ μ•„λμ™€ κ°™μ€ μ¶λ ¥μ„ μ–»κ² λ©λ‹λ‹¤.</p>
<p><img src="qemu-deadlock.png" alt="QEMU output with many rows of hyphens and no dots" /></p>
<p>μ²« νƒ€μ΄λ¨Έ μΈν„°λ½νΈ λ°μƒ μ „κΉμ§€λ” μ ν•λ μμ λ¶™μ„ν‘(<code>-</code>)κ°€ μ¶λ ¥λ©λ‹λ‹¤. μ²« νƒ€μ΄λ¨Έ μΈν„°λ½νΈ ν›„, νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μκ°€ μ¨μ (<code>.</code>)μ„ μ¶λ ¥ν•λ ¤λ‹¤ κµμ°© μƒνƒμ— λΉ μ§€κ³  μ‹μ¤ν…μ€ μ•„λ¬΄ λ°μ‘μ„ ν•μ§€ μ•μµλ‹λ‹¤. μ΄κ²ƒμ΄ μ¶λ ¥ λ‚΄μ©μ— μ¨μ μ΄ μ „ν€ μ—†λ” μ΄μ μ…λ‹λ‹¤.</p>
<p>νƒ€μ΄λ¨Έ μΈν„°λ½νΈκ°€ λΉ„λ™κΈ°μ μΌλ΅ λ°μƒν•λ‹¤λ³΄λ‹ μ»¤λ„μ„ μ‹¤ν–‰ν•  λ•λ§λ‹¤ μ¶λ ¥λλ” λ¶™μ„ν‘μ μκ°€ λ‹¤λ¥Ό μ μμµλ‹λ‹¤. λ™μ‹μ„± κ΄€λ ¨ λ²„κ·Έλ“¤μ€ μ‹¤ν–‰ κ²°κ³Όκ°€ μ΄λ ‡κ² λΉ„κ²°μ •λ΅ μ (non-deterministic)μΈ κ²½μ°κ°€ λ§μ•„ λ””λ²„κΉ…ν•κΈ° μ‰½μ§€ μ•μµλ‹λ‹¤.</p>
<h3 id="ggycag-ssantae-bbanjihagi"><a class="zola-anchor" href="index.html#ggycag-ssantae-bbanjihagi" aria-label="Anchor link for: ggycag-ssantae-bbanjihagi">π”—</a>κµμ°© μƒνƒ λ°©μ§€ν•κΈ°</h3>
<p><code>Mutex</code>κ°€ μ κΈ΄ λ™μ• μΈν„°λ½νΈλ¥Ό ν•΄μ ν•λ©΄ κµμ°© μƒνƒλ¥Ό λ°©μ§€ν•  μ μμµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#608b4e;">/// Prints the given formatted string to the VGA text buffer
</span><span style="color:#608b4e;">/// through the global `WRITER` instance.
</span><span>#[doc(hidden)]
</span><span style="color:#569cd6;">pub fn </span><span>_print(args: fmt::Arguments) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::interrupts;   </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>
</span><span>    interrupts::without_interrupts(|| {     </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>        </span><span style="color:#b4cea8;">WRITER</span><span>.lock().write_fmt(args).unwrap();
</span><span>    });
</span><span>}
</span></code></pre>
<p><a href="https://docs.rs/x86_64/0.14.2/x86_64/instructions/interrupts/fn.without_interrupts.html"><code>without_interrupts</code></a> ν•¨μλ” μΈμλ΅ λ°›μ€ <a href="https://doc.rust-lang.org/book/ch13-01-closures.html">ν΄λ΅μ €(closure)</a>λ¥Ό μΈν„°λ½νΈκ°€ μ—†λ” ν™κ²½μ—μ„ μ‹¤ν–‰ν•©λ‹λ‹¤. μ΄ ν•¨μλ¥Ό ν†µν•΄ <code>Mutex</code>κ°€ μ κΈ΄ λ™μ• μΈν„°λ½νΈκ°€ λ°μƒν•μ§€ μ•κ² λ³΄μ¥ν•©λ‹λ‹¤. μ»¤λ„μ„ λ‹¤μ‹ μ‹¤ν–‰ν•λ©΄ μ»¤λ„μ΄ μ‘λ‹µ λ¶κ°€ μƒνƒμ— λΉ μ§€μ§€ μ•κ³  κ³„μ† μ‹¤ν–‰λλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤. (ν™”λ©΄ μ¤ν¬λ΅¤μ΄ λ„λ¬΄ λΉ λ¥΄κ² λ‚΄λ ¤κ°€λ‹¤ λ³΄λ‹ ν™”λ©΄μ— μ μ΄ μ¶λ ¥λλ” κ²ƒμ„ ν™•μΈν•κΈ° μ–΄λ ¤μΈ μ μμµλ‹λ‹¤. <code>_start</code> ν•¨μμ loop μ•μ— <code>for _ in 0..10000 {}</code>λ¥Ό μ‚½μ…ν•λ” λ“±μ λ°©λ²•μΌλ΅ μ¶λ ¥ μ†λ„λ¥Ό λ¦μ¶° λ³΄μ„Έμ”.)</p>
<p>μ§λ ¬ ν¬νΈλ¥Ό μ΄μ©ν• μ¶λ ¥ ν•¨μ μ½”λ“ μ—­μ‹ κ°™μ€ λ°©μ‹μΌλ΅ μμ •ν•μ—¬ κµμ°© μƒνƒλ¥Ό λ°©μ§€ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/serial.rs
</span><span>
</span><span>#[doc(hidden)]
</span><span style="color:#569cd6;">pub fn </span><span>_print(args: ::core::fmt::Arguments) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::interrupts;       </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>
</span><span>    interrupts::without_interrupts(|| {         </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>        </span><span style="color:#b4cea8;">SERIAL1
</span><span>            .lock()
</span><span>            .write_fmt(args)
</span><span>            .expect(</span><span style="color:#d69d85;">&quot;Printing to serial failed&quot;</span><span>);
</span><span>    });
</span><span>}
</span></code></pre>
<p>μΈν„°λ½νΈλ¥Ό ν•΄μ ν•λ” κ²ƒμ΄ μΌλ°μ μΌλ΅ μ‚¬μ©ν•  ν•΄κ²° λ°©μ‹μ΄ μ•„λ‹λΌλ” κ²ƒμ„ μ•„μ…”μ•Ό ν•©λ‹λ‹¤. μΈν„°λ½νΈλ¥Ό ν•΄μ ν•λ©΄ μΈν„°λ½νΈκ°€ μµλ€λ΅ λ§μ΄ λ°λ Έμ„ λ• μ‹μ¤ν…μ΄ μΈν„°λ½νΈμ— λ°μ‘ν•  μ μλ” μ‹κ°„ (worst-case interrupt latency)μ΄ λ¦μ–΄μ§‘λ‹λ‹¤. λ”°λΌμ„ μΈν„°λ½νΈλ¥Ό ν•΄μ ν•λ ¤λ©΄ μ•„μ£Ό μ§§μ€ μ‹κ°„ λ™μ•λ§ ν•΄μ•Ό ν•©λ‹λ‹¤.</p>
<h2 id="ggyeonjjaen-ssantae-race-condition-yebbanhagi"><a class="zola-anchor" href="index.html#ggyeonjjaen-ssantae-race-condition-yebbanhagi" aria-label="Anchor link for: ggyeonjjaen-ssantae-race-condition-yebbanhagi">π”—</a>κ²½μ μƒνƒ (Race Condition) μλ°©ν•κΈ°</h2>
<p><code>cargo test</code>λ¥Ό μ‹¤ν–‰ν•λ©΄ ν…μ¤νΈ <code>test_println_output</code>κ°€ λ•λ•λ΅ μ‹¤ν¨ν•λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>&gt; cargo test --lib
</span><span>[β€¦]
</span><span>Running 4 tests
</span><span>test_breakpoint_exception...[ok]
</span><span>test_println... [ok]
</span><span>test_println_many... [ok]
</span><span>test_println_output... [failed]
</span><span>
</span><span>Error: panicked at &#39;assertion failed: `(left == right)`
</span><span>  left: `&#39;.&#39;`,
</span><span> right: `&#39;S&#39;`&#39;, src/vga_buffer.rs:205:9
</span></code></pre>
<p>μ΄ ν…μ¤νΈκ°€ λ•λ•λ΅ μ‹¤ν¨ν•λ” κ²ƒμ€ μ΄ ν…μ¤νΈμ™€ μ°λ¦¬κ°€ μ‘μ„±ν• νƒ€μ΄λ¨Έ μ²λ¦¬ ν•¨μ κ°„ <em>κ²½μ μƒνƒ (race condition)</em> λ•λ¬Έμ…λ‹λ‹¤. μμ „μ— μ‘μ„±ν–λ μ΄ ν…μ¤νΈμ μ½”λ“λ¥Ό λ‹¤μ‹ μ‚΄ν΄λ³΄κ² μµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println_output() {
</span><span>    </span><span style="color:#569cd6;">let</span><span> s = </span><span style="color:#d69d85;">&quot;Some test string that fits on a single line&quot;</span><span>;
</span><span>    println!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, s);
</span><span>    </span><span style="color:#569cd6;">for </span><span>(i, c) </span><span style="color:#569cd6;">in</span><span> s.chars().enumerate() {
</span><span>        </span><span style="color:#569cd6;">let</span><span> screen_char = </span><span style="color:#b4cea8;">WRITER</span><span>.lock().buffer.chars[</span><span style="color:#b4cea8;">BUFFER_HEIGHT </span><span>- </span><span style="color:#b5cea8;">2</span><span>][i].read();
</span><span>        assert_eq!(</span><span style="color:#569cd6;">char</span><span>::from(screen_char.ascii_character), c);
</span><span>    }
</span><span>}
</span></code></pre>
<p>μ΄ ν…μ¤νΈλ” VGA λ²„νΌμ— λ¬Έμμ—΄μ— μ¶λ ¥ν• ν›„ <code>buffer_chars</code> λ°°μ—΄μ„ μ§μ ‘ μνν•μ—¬ μ¶λ ¥λ λ‚΄μ©μ„ ν™•μΈν•©λ‹λ‹¤. κ²½μ μƒνƒκ°€ μƒκΈ°λ” μ΄μ λ”, <code>println</code>κ³Ό <code>screen_char</code>λ¥Ό μ½λ” μ½”λ“ μ‚¬μ΄μ— νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μκ°€ νΈμ¶λ  μ μκΈ° λ•λ¬Έμ…λ‹λ‹¤. μ΄λ” μ»΄νμΌ μ‹κ°„μ— Rustκ°€ λ§‰μ•„μ£Όλ” μ„ν—ν• <em>λ°μ΄ν„° λ μ΄μ¤ (data race)</em> μ™€λ” λ‹¤λ¦…λ‹λ‹¤. μμ„Έν• λ‚΄μ©μ€ <a href="https://doc.rust-lang.org/nomicon/races.html"><em>Rustonomicon</em></a>μ„ μ°Έκ³ ν•΄μ£Όμ„Έμ”.</p>
<p>μ΄ λ¬Έμ λ¥Ό κ³ μΉλ ¤λ©΄ μ„ ν…μ¤νΈκ°€ μ‹¤ν–‰ μ¤‘μ— <code>WRITER</code>μ— λ€ν• lockμ„ κ³„μ† μ κ·Έκ³  μμ–΄μ•Ό ν•©λ‹λ‹¤. κ·Έλ ‡κ² ν•΄μ•Ό νƒ€μ΄λ¨Έ μ²λ¦¬ ν•¨μκ°€ κ·Έ μ‚¬μ΄μ— <code>.</code>μ„ μ¶λ ¥ν•μ§€ λ»ν•©λ‹λ‹¤. μ•„λμ™€ κ°™μ΄ ν…μ¤νΈλ¥Ό μμ •ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println_output() {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::interrupts;
</span><span>
</span><span>    </span><span style="color:#569cd6;">let</span><span> s = </span><span style="color:#d69d85;">&quot;Some test string that fits on a single line&quot;</span><span>;
</span><span>    interrupts::without_interrupts(|| {
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> writer = </span><span style="color:#b4cea8;">WRITER</span><span>.lock();
</span><span>        writeln!(writer, </span><span style="color:#d69d85;">&quot;</span><span style="color:#e3bbab;">\n</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, s).expect(</span><span style="color:#d69d85;">&quot;writeln failed&quot;</span><span>);
</span><span>        </span><span style="color:#569cd6;">for </span><span>(i, c) </span><span style="color:#569cd6;">in</span><span> s.chars().enumerate() {
</span><span>            </span><span style="color:#569cd6;">let</span><span> screen_char = writer.buffer.chars[</span><span style="color:#b4cea8;">BUFFER_HEIGHT </span><span>- </span><span style="color:#b5cea8;">2</span><span>][i].read();
</span><span>            assert_eq!(</span><span style="color:#569cd6;">char</span><span>::from(screen_char.ascii_character), c);
</span><span>        }
</span><span>    });
</span><span>}
</span></code></pre>
<p>λ³€κ²½ μ‚¬ν•­λ“¤μ„ μ •λ¦¬ν•λ©΄ μ•„λμ™€ κ°™μµλ‹λ‹¤.</p>
<ul>
<li>ν…μ¤νΈ μ‹¤ν–‰ μ¤‘μ—λ” <code>lock()</code> ν•¨μλ¥Ό μ‚¬μ©ν•΄ WRITERλ¥Ό μ κ°€ λ†“μµλ‹λ‹¤. <code>println</code> λ€μ‹  <a href="https://doc.rust-lang.org/core/macro.writeln.html"><code>writeln</code></a> λ§¤ν¬λ΅λ¥Ό μ¨μ„ μ΄λ―Έ μ κΈ΄ WRITERλ¥Ό μ΄μ©ν•΄ λ©”μ‹μ§€λ¥Ό μ¶λ ¥ν•©λ‹λ‹¤.</li>
<li>λ λ‹¤λ¥Έ κµμ°© μƒνƒλ¥Ό ν”Όν•λ ¤κ³  ν…μ¤νΈ μ¤‘μ—λ” μΈν„°λ½νΈμ μ‚¬μ©μ„ ν•΄μ ν•©λ‹λ‹¤. κ·Έλ ‡κ² ν•μ§€ μ•μΌλ©΄ ν…μ¤νΈ μ‹¤ν–‰ μ¤‘ WRITERκ°€ μ κΈ΄ μƒνƒμ—μ„ λ°μƒν• λ‹¤λ¥Έ μΈν„°λ½νΈκ°€ ν…μ¤νΈ μ‹¤ν–‰μ„ λ°©ν•΄ν•  μ μμµλ‹λ‹¤.</li>
<li>ν…μ¤νΈ μ‹¤ν–‰ μ‹μ‘ μ „μ— νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μκ°€ μ‹¤ν–‰λ  μ μμΌλ‹ λ¬Έμμ—΄ <code>s</code> μ¶λ ¥ μ „μ— κ°ν–‰ λ¬Έμ <code>\n</code>μ„ μ¶λ ¥ν•©λ‹λ‹¤. μ΄λ ‡κ² ν•λ©΄ νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μκ°€ ν„μ¬ ν–‰μ— μ΄λ―Έ <code>.</code> λ¬Έμλ¥Ό μ—¬λΏ μ¶λ ¥ν–λ”λΌλ„ μ΄ ν…μ¤νΈκ°€ μ‹¤ν¨ν•μ§€ μ•μ„ κ²ƒμ…λ‹λ‹¤.</li>
</ul>
<p>μ΄μ  λ‹¤μ‹ <code>cargo test</code>λ¥Ό μ‹¤ν–‰ν•λ©΄ ν•­μƒ μ„±κ³µν•λ” κ²ƒμ„ ν™•μΈν•μ‹¤ μ μμµλ‹λ‹¤.</p>
<p>μ„μ—μ„ λ‹¤λ£¬ κ²½μ μƒνƒ (race condition)λ” ν…μ¤νΈ μ‹¤ν¨λ¥Ό μΌμΌν‚¤λ” κ²ƒ μ™Έμ— ν° ν•΄λ¥Ό λΌμΉμ§€λ” μ•μ•μµλ‹λ‹¤. ν•μ§€λ§ λΉ„κ²°μ •λ΅ μ μΈ κ²°κ³Όλ¥Ό λ‚³λ”λ‹¤λ” λ³Έμ§μ μΈ νΉμ„± λ•λ¬Έμ— μ΄λ³΄λ‹¤ λ””λ²„κΉ…ν•κΈ° λ” κΉλ‹¤λ΅μ΄ κ²½μ μƒνƒ μ—­μ‹ μ΅΄μ¬ν•  μ μμµλ‹λ‹¤. λ°μ΄ν„° λ μ΄μ¤(data race)λΌλ” κ°€μ¥ μ„ν—ν• μΆ…λ¥μ κ²½μ μƒνƒλ” μ‹μ¤ν… ν¬λμ‹λ‚ λ©”λ¨λ¦¬ μ»¤λ½μ… (memory corruption) λ“± μ¨κ°– undefined behaviorλ¥Ό μΌμΌν‚¬ μ μμ§€λ§, λ‹¤ν–‰ν Rustκ°€ μ°λ¦¬λ¥Ό λ°μ΄ν„° λ μ΄μ¤λ΅λ¶€ν„° μ§€μΌμ¤λ‹λ‹¤.</p>
<h2 id="hlt-myeongryeongeo"><a class="zola-anchor" href="index.html#hlt-myeongryeongeo" aria-label="Anchor link for: hlt-myeongryeongeo">π”—</a><code>hlt</code> λ…λ Ήμ–΄</h2>
<p>μ—¬νƒκΉμ§€λ” <code>_start</code> λ° <code>panic</code> ν•¨μλ“¤μ λ§¨ λ§μ§€λ§‰μ— κ°„λ‹¨ν• λΉ loopλ¥Ό μ‚¬μ©ν–μµλ‹λ‹¤. μ΄ loop λ•λ¬Έμ— CPUλ” μ‹¤ν–‰μ„ μΆ…λ£ν•μ§€ μ•λ”λ°, CPUκ°€ λ”±ν ν•  μΌμ΄ μ—†λ”λ° CPUλ¥Ό μµκ³  μ†λ„λ΅ κ°€λ™ν•λ” κ²ƒμ€ μ—λ„μ§€ ν¨μ¨μ„± μΈ΅λ©΄μ—μ„ λ§¤μ° λΉ„ν¨μ¨μ μ…λ‹λ‹¤. μ»¤λ„ μ‹¤ν–‰ ν›„ νƒμ¤ν¬ λ§¤λ‹μ €λ¥Ό λ³΄μ‹λ©΄ QEMU ν”„λ΅μ„Έμ¤κ°€ ν•­μƒ CPU μ‹κ°„μ„ 100% κ°€κΉμ΄ μ‚¬μ©ν•κ³  μμ„ κ²ƒμ…λ‹λ‹¤.</p>
<p>μ°λ¦¬κ°€ μ •λ§ ν•΄μ•Ό ν•  μΌμ€ λ‹¤μ μΈν„°λ½νΈ μ „κΉμ§€ CPUκ°€ μ •μ§€ν•λ„λ΅ ν•λ” κ²ƒμ…λ‹λ‹¤. CPUλ” μ €μ „λ ¥ μƒνƒμ λ€κΈ° λ¨λ“μ—μ„ μ‹¤ν–‰μ„ μ •μ§€ν•κ³  λ€κΈ°ν•  μ μμµλ‹λ‹¤. <code>hlt</code> λ…λ Ήμ–΄λ¥Ό μ“°λ©΄ CPUκ°€ μ €μ „λ ¥ λ€κΈ° μƒνƒμ— λ“¤μ–΄κ°€κ² ν•  μ μμµλ‹λ‹¤. μ΄ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄ μ—λ„μ§€λ¥Ό ν¨μ¨μ μΌλ΅ μ‚¬μ©ν•λ” λ¬΄ν• λ£¨ν”„λ¥Ό μ‘μ„±ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>hlt_loop() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{
</span><span>        x86_64::instructions::hlt();
</span><span>    }
</span><span>}
</span></code></pre>
<p>ν•¨μ <code>instructions::hlt</code>λ” κ·Έμ € hlt μ–΄μ…λΈ”λ¦¬ λ…λ Ήμ–΄λ¥Ό <a href="https://github.com/rust-osdev/x86_64/blob/5e8e218381c5205f5777cb50da3ecac5d7e3b1ab/src/instructions/mod.rs#L16-L22">μ–‡κ² κ°μ‹Έ ν¬μ¥</a>ν•©λ‹λ‹¤. μ΄ λ…λ Ήμ–΄λ΅λ” λ©”λ¨λ¦¬ μ•μ „μ„±μ„ ν•΄μΉ  λ°©λ²•μ΄ μ—†μ–΄ μ•μ „ν•©λ‹λ‹¤.</p>
<p><code>_start</code> λ° <code>panic</code> ν•¨μμ—μ„ μ‚¬μ©ν•λ λ¬΄ν• λ£¨ν”„λ¥Ό λ°©κΈ μ‘μ„±ν• <code>hlt_loop</code>λ΅ κµμ²΄ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    [β€¦]
</span><span>
</span><span>    println!(</span><span style="color:#d69d85;">&quot;It did not crash!&quot;</span><span>);
</span><span>    blog_os::hlt_loop();            </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>}
</span><span>
</span><span>
</span><span>#[cfg(not(test))]
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    println!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    blog_os::hlt_loop();            </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>}
</span><span>
</span></code></pre>
<p><code>lib.rs</code> λν• λ§μ°¬κ°€μ§€λ΅ μμ •ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#608b4e;">/// `cargo test`μ μ‹¤ν–‰ μ‹μ‘ μ§€μ 
</span><span>#[cfg(test)]
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    init();
</span><span>    test_main();
</span><span>    hlt_loop();         </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>}
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>test_panic_handler(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[failed]</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>);
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Error: {}</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    exit_qemu(QemuExitCode::Failed);
</span><span>    hlt_loop();         </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>}
</span></code></pre>
<p>μ΄μ  QEMUμ—μ„ μ»¤λ„μ„ μ‹¤ν–‰ν•λ©΄ CPU μ‚¬μ©λ‰μ΄ ν›¨μ”¬ κ°μ†ν• κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.</p>
<h2 id="kibodde-ibryeog"><a class="zola-anchor" href="index.html#kibodde-ibryeog" aria-label="Anchor link for: kibodde-ibryeog">π”—</a>ν‚¤λ³΄λ“ μ…λ ¥</h2>
<p>μ™Έλ¶€ μ¥μΉλ΅λ¶€ν„° μ¤λ” μΈν„°λ½νΈλ¥Ό μ»¤λ„μ—μ„ μ²λ¦¬ν•  μ μκ² λμ—μΌλ‹, μ΄μ  λ“λ””μ–΄ μ»¤λ„μ΄ ν‚¤λ³΄λ“ μ…λ ¥μ„ μ§€μ›ν•λ„λ΅ λ§λ“¤ μ°¨λ΅€μ…λ‹λ‹¤. ν‚¤λ³΄λ“ μ…λ ¥μ„ μ§€μ›ν•¨μΌλ΅μ¨ μ»¤λ„κ³Ό μƒνΈμ‘μ©ν•  μ μκ² λ  κ²ƒμ…λ‹λ‹¤.</p>
<aside class="post_aside">
<p>μ΄ κΈ€μ—μ„λ” <a href="https://en.wikipedia.org/wiki/PS/2_port">PS/2</a> ν‚¤λ³΄λ“μ— λ€ν•΄μ„λ§ λ‹¤λ£¨κ³  USB ν‚¤λ³΄λ“λ” λ‹¤λ£¨μ§€ μ•μµλ‹λ‹¤. ν•μ§€λ§ λ©”μΈλ³΄λ“κ°€ κµ¬μ‹ μ†ν”„νΈμ›¨μ–΄λ¥Ό μ§€μ›ν•κΈ° μ„ν•΄ USB ν‚¤λ³΄λ“λ¥Ό PS/2 μ¥μΉλ΅ μ—λ®¬λ μ΄ν…ν•κΈ° λ•λ¬Έμ—, μ¶”ν›„ μ»¤λ„μ— μ •μ‹μΌλ΅ USB μ§€μ›μ„ μ¶”κ°€ν•κΈ° μ „κΉμ§€λ” USB ν‚¤λ³΄λ“μ— λ€ν•΄ κ³ λ―Όν•μ§€ μ•μ•„λ„ λ©λ‹λ‹¤.</p>
</aside>
<p>ν•λ“μ›¨μ–΄ νƒ€μ΄λ¨Έμ™€ λ§μ°¬κ°€μ§€λ΅, ν‚¤λ³΄λ“ μ»¨νΈλ΅¤λ¬μ μΈν„°λ½νΈλ„ κΈ°λ³Έμ μΌλ΅ μ‚¬μ©μ΄ ν™μ„±ν™”λμ–΄ μμµλ‹λ‹¤. ν‚¤λ³΄λ“ ν‚¤λ¥Ό λ„λ¥΄λ©΄ ν‚¤λ³΄λ“ μ»¨νΈλ΅¤λ¬λ” PICλ΅ μΈν„°λ½νΈλ¥Ό λ³΄λ‚΄κ³ , PICλ” λ‹¤μ‹ κ·Έ μΈν„°λ½νΈλ¥Ό CPUλ΅ μ „λ‹¬ν•©λ‹λ‹¤. CPUλ” IDTμ—μ„ ν‚¤λ³΄λ“ μΈν„°λ½νΈμ μ—”νΈλ¦¬λ¥Ό μ΅°νν•μ§€λ§, λ“±λ΅λ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μκ°€ μ—†μ–΄ λ”λΈ” ν΄νΈκ°€ λ°μƒν•©λ‹λ‹¤.</p>
<p>ν‚¤λ³΄λ“ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•λ” ν•¨μλ¥Ό μ¶”κ°€ν•©λ‹λ‹¤. λ‹¤λ¥Έ μΈν„°λ½νΈ λ²νΈλ¥Ό μ‚¬μ©ν•λ‹¤λ” μ μ„ λΉΌλ©΄, μ΄μ „μ— νƒ€μ΄λ¨Έ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μλ¥Ό μ‘μ„±ν–λ κ²ƒκ³Ό λ§¤μ° μ μ‚¬ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span>#[derive(Debug, Clone, Copy)]
</span><span>#[repr(u8)]
</span><span style="color:#569cd6;">pub enum </span><span>InterruptIndex {
</span><span>    Timer = </span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>,
</span><span>    Keyboard, </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>}
</span><span>
</span><span>lazy_static! {
</span><span>    </span><span style="color:#569cd6;">static ref </span><span style="color:#b4cea8;">IDT</span><span>: InterruptDescriptorTable = {
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> idt = InterruptDescriptorTable::new();
</span><span>        idt.breakpoint.set_handler_fn(breakpoint_handler);
</span><span>        [β€¦]
</span><span>        </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>        idt[InterruptIndex::Keyboard.as_usize()]
</span><span>            .set_handler_fn(keyboard_interrupt_handler);
</span><span>
</span><span>        idt
</span><span>    };
</span><span>}
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    print!(</span><span style="color:#d69d85;">&quot;k&quot;</span><span>);
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p><a href="index.html#8259-pic">μ„ λ„ν‘</a>λ¥Ό λ³΄λ©΄ ν‚¤λ³΄λ“λ” μ£Ό PICμ 1λ² ν†µμ‹ μ„ μ„ μ‚¬μ©ν•©λ‹λ‹¤. μ¦‰ CPUμ— μ „λ‹¬λ ν‚¤λ³΄λ“ μΈν„°λ½νΈμ λ²΅ν„° λ²νΈλ” 33 (1 + μ¤ν”„μ…‹ 32)μ΄ λ©λ‹λ‹¤. ν•΄λ‹Ή λ²νΈλ¥Ό <code>InterruptIndex</code> enumμ μƒ λ¶„λ¥ <code>Keyboard</code>μ— λ°°μ •ν•©λ‹λ‹¤. <code>Keyboard</code>μ κ°’μ„ λ…μ‹μ μΌλ΅ μ •ν•΄μ£Όμ§€ μ•μ•„λ„ λ°”λ΅ μ΄μ „ λ¶„λ¥μ κ°’μ— 1μ„ λ”ν• κ°’(=33)μ΄ λ°°μ •λ©λ‹λ‹¤. μΈν„°λ½νΈ μ²λ¦¬ ν•¨μλ” <code>k</code>λ¥Ό μ¶λ ¥ν• ν›„ μΈν„°λ½νΈ μ»¨νΈλ΅¤λ¬μ— EOI μ‹ νΈλ¥Ό μ „μ†΅ν•©λ‹λ‹¤.</p>
<p>μ΄μ  μ•„λ¬΄ ν‚¤λ¥Ό ν•λ‚ μ…λ ¥ν•λ©΄ ν™”λ©΄μ— <code>k</code>κ°€ μ¶λ ¥λ©λ‹λ‹¤. ν•μ§€λ§ μ•„λ¬΄ ν‚¤λ¥Ό ν•λ‚ μƒλ΅ μ…λ ¥ν•λ©΄ ν™”λ©΄μ— <code>k</code>κ°€ μƒλ΅ μ¶λ ¥λμ§€ μ•μµλ‹λ‹¤. κ·Έ μ΄μ λ” κΈ°μ΅΄μ— μ…λ ¥λ ν‚¤μ <em>μ¤μΊ” μ½”λ“ (scancode)</em> λ¥Ό μ°λ¦¬κ°€ μ½μ–΄ κ°€μ§€ μ•λ” ν• ν‚¤λ³΄λ“ μ»¨νΈλ΅¤λ¬κ°€ μƒ μΈν„°λ½νΈλ¥Ό λ³΄λ‚΄μ§€ μ•κΈ° λ•λ¬Έμ…λ‹λ‹¤.</p>
<h3 id="ssekaen-kodde-hilgi"><a class="zola-anchor" href="index.html#ssekaen-kodde-hilgi" aria-label="Anchor link for: ssekaen-kodde-hilgi">π”—</a>μ¤μΊ” μ½”λ“ μ½κΈ°</h3>
<p><em>μ–΄λ–¤</em> ν‚¤κ°€ μ…λ ¥λλ”μ§€ ν™•μΈν•λ ¤λ©΄ ν‚¤λ³΄λ“ μ»¨νΈλ΅¤λ¬μ— μ €μ¥λ μ •λ³΄λ¥Ό ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤. PS/2 μ»¨νΈλ΅¤λ¬μ λ°μ΄ν„° ν¬νΈ, μ¦‰ <code>0x60</code>λ² <a href="../../testing/index.html#i-o-ports">μ…μ¶λ ¥ ν¬νΈ (I/O port)</a>λ¥Ό μ½μ–΄ λ“¤μ—¬ μ–΄λ–¤ ν‚¤κ°€ μ…λ ¥λλ”μ§€ ν™•μΈν•  μ μμµλ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0x60</span><span>);
</span><span>    </span><span style="color:#569cd6;">let</span><span> scancode: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#569cd6;">unsafe </span><span>{ port.read() };
</span><span>    print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, scancode);
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p><code>x86_64</code> ν¬λ μ΄νΈμ <a href="https://docs.rs/x86_64/0.14.2/x86_64/instructions/port/struct.Port.html"><code>Port</code></a> νƒ€μ…μ„ μ‚¬μ©ν•΄ ν‚¤λ³΄λ“μ λ°μ΄ν„° ν¬νΈλ΅λ¶€ν„° 1λ°”μ΄νΈλ¥Ό μ½μ–΄μµλ‹λ‹¤. μ΄ 1λ°”μ΄νΈμ λ°μ΄ν„°λ¥Ό <a href="https://en.wikipedia.org/wiki/Scancode"><em>μ¤μΊ” μ½”λ“ (scancode)</em></a>λΌκ³  λ¶€λ¥΄λ©°, λ„λ¥Έ ν‚¤ λλ” λ„λ¥Έ μƒνƒμ—μ„ λ—€ ν‚¤μ μ •λ³΄λ¥Ό κ°€μ§‘λ‹λ‹¤. μΌλ‹¨μ€ μ¤μΊ” μ½”λ“λ¥Ό μ¶λ ¥ν•κΈ°λ§ ν•  λΏ, μ½μ€ μ¤μΊ” μ½”λ“ κ°’μ„ μ΄μ©ν• μ‘μ—…μ€ ν•μ§€ μ•μµλ‹λ‹¤.</p>
<p><img src="qemu-printing-scancodes.gif" alt="QEMU printing scancodes to the screen when keys are pressed" /></p>
<p>μ„ μ΄λ―Έμ§€λ” μ κ°€ ν‚¤λ³΄λ“λ΅ μ²μ²ν β€123β€μ„ μ…λ ¥ν–μ„ λ•μ ν™”λ©΄μ„ λ³΄μ—¬μ¤λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ μΈμ ‘ν• ν‚¤λ“¤μ€ μΈμ ‘ν• κ°’μ μ¤μΊ” μ½”λ“λ¥Ό κ°€μ§„λ‹¤λ” κ²ƒ, κ·Έλ¦¬κ³  ν‚¤λ¥Ό λ„λ¥Ό λ•μ™€ λ„λ¥Έ ν‚¤λ¥Ό λ—„ λ• μ„λ΅ λ‹¤λ¥Έ μ¤μΊ” μ½”λ“κ°€ λ°μƒν•λ‹¤λ” κ²ƒμ„ μ• μ μμµλ‹λ‹¤. κ·Όλ° κ° μ¤μΊ” μ½”λ“λ” μ‹¤μ  ν‚¤ λ„λ¦„/λ—μ— μ–΄λ–¤ κΈ°μ¤€μΌλ΅ λ°°μ •λ κ²ƒμΌκΉμ”?</p>
<h3 id="ssekaen-kodde-haesseohagi"><a class="zola-anchor" href="index.html#ssekaen-kodde-haesseohagi" aria-label="Anchor link for: ssekaen-kodde-haesseohagi">π”—</a>μ¤μΊ” μ½”λ“ ν•΄μ„ν•κΈ°</h3>
<p>μ¤μΊ” μ½”λ“λ¥Ό ν‚¤λ³΄λ“ ν‚¤μ— λ°°μ •ν•λ” ν‘μ¤€μ„ <em>μ¤μΊ”μ½”λ“ μ…‹ (scancode set)</em> μ΄λΌ λ¶€λ¥΄λ©°, μ„λ΅ λ‹¤λ¥Έ 3κ°€μ§€ ν‘μ¤€μ΄ μ΅΄μ¬ν•©λ‹λ‹¤. μ…‹ λ¨λ‘ μ΄κΈ°μ IBM μ»΄ν“¨ν„°λ“¤ (<a href="https://en.wikipedia.org/wiki/IBM_Personal_Computer_XT">IBM XT</a>, <a href="https://en.wikipedia.org/wiki/IBM_3270_PC">IBM 3270 PC</a>, <a href="https://en.wikipedia.org/wiki/IBM_Personal_Computer/AT">IBM AT</a>)λ΅λ¶€ν„° κΈ°μ›ν•©λ‹λ‹¤. μ΄ν›„μ μ»΄ν“¨ν„°λ“¤μ€ μƒλ΅μ΄ μ¤μΊ”μ½”λ“ μ…‹μ„ μ •μν•λ” λ€μ‹  κΈ°μ΅΄μ κ²ƒλ“¤μ„ μ§€μ›ν•κ±°λ‚ ν™•μ¥ν•΄ μ‚¬μ©ν–μµλ‹λ‹¤. μ¤λλ‚  λ€λ¶€λ¶„μ ν‚¤λ³΄λ“λ” μ—λ®¬λ μ΄ν…μ„ ν†µν•΄ μ΄ 3κ°€μ§€ μ…‹ μ¤‘ μ–΄λ κ²ƒμ΄λ“  μ‚¬μ©ν•  μ μμµλ‹λ‹¤.</p>
<p>PS/2 ν‚¤λ³΄λ“λ” κΈ°λ³Έμ μΌλ΅ 1λ² μ¤μΊ” μ½”λ“ μ…‹ (β€XTβ€)λ¥Ό μ‚¬μ©ν•κ² λμ–΄ μμµλ‹λ‹¤. μ΄ μ…‹μ—μ„ μ¤μΊ” μ½”λ“μ ν•μ„ 7λΉ„νΈλ” μ…λ ¥λ ν‚¤λ¥Ό ν‘ν„ν•κ³ , μµμƒμ„ λΉ„νΈλ” ν‚¤λ¥Ό λ„λ¥Έ κ²ƒμΈμ§€ (β€0β€) νΉμ€ ν‚¤μ—μ„ μ†μ„ λ—€ κ²ƒμΈμ§€ (β€1β€) ν‘ν„ν•©λ‹λ‹¤. μ—”ν„° ν‚¤μ²λΌ <a href="https://en.wikipedia.org/wiki/IBM_Personal_Computer_XT">IBM XT</a> ν‚¤λ³΄λ“μ— μ—†μ—λ ν‚¤λ“¤μ€ 2κ°μ μ¤μΊ” μ½”λ“ (<code>0xe0</code> κ·Έλ¦¬κ³  κ·Έ ν›„ ν‚¤λ¥Ό λ‚νƒ€λ‚΄λ” 1λ°”μ΄νΈ)λ¥Ό μ—°μ΄μ–΄ μƒμ„±ν•©λ‹λ‹¤. <a href="https://wiki.osdev.org/Keyboard#Scan_Code_Set_1">OSDev Wiki</a>λ¥Ό λ³΄μ‹λ©΄ 1λ² μ¤μΊ”μ½”λ“ μ…‹μ λ¨λ“  μ¤μΊ” μ½”λ“μ™€ κ·Έμ— λ€μ‘ν•λ” ν‚¤λ¥Ό ν™•μΈν•μ‹¤ μ μμµλ‹λ‹¤.</p>
<p><code>match</code>λ¬Έμ„ μ‚¬μ©ν•΄ μ¤μΊ” μ½”λ“λ¥Ό μ•λ§λ” ν‚¤μ— λ€μ‘μ‹μΌ ν•΄μ„ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0x60</span><span>);
</span><span>    </span><span style="color:#569cd6;">let</span><span> scancode: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#569cd6;">unsafe </span><span>{ port.read() };
</span><span>
</span><span>    </span><span style="color:#608b4e;">// μƒλ΅ μ¶”κ°€ν•¨
</span><span>    </span><span style="color:#569cd6;">let</span><span> key = </span><span style="color:#569cd6;">match</span><span> scancode {
</span><span>        </span><span style="color:#b5cea8;">0x02 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;1&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x03 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;2&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x04 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;3&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x05 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;4&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x06 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;5&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x07 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;6&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x08 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;7&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x09 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;8&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x0a </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;9&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x0b </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;0&#39;</span><span>),
</span><span>        </span><span style="color:#569cd6;">_ =&gt; </span><span>None,
</span><span>    };
</span><span>    </span><span style="color:#569cd6;">if let </span><span>Some(key) = key {
</span><span>        print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, key);
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p>μ„ μ½”λ“λ” 0-9μ μ«μ ν‚¤ λ„λ¦„μ„ μΈμ‹ν•κ³  μ¶λ ¥ν•λ©°, λ‹¤λ¥Έ ν‚¤λ” λ¬΄μ‹ν•©λ‹λ‹¤. <a href="https://doc.rust-lang.org/book/ch06-02-match.html">match</a>λ¬Έμ„ μ‚¬μ©ν•΄ κ° μ¤μΊ”μ½”λ“μ— λ¬Έμ λλ” <code>None</code>μ„ λ°°μ •ν•©λ‹λ‹¤. κ·Έ ν›„ <a href="https://doc.rust-lang.org/book/ch18-01-all-the-places-for-patterns.html#conditional-if-let-expressions"><code>if let</code></a>μ„ μ‚¬μ©ν•΄ μ¤μΊ” μ½”λ“μ— λ°°μ •λ λ¬Έμ <code>key</code>λ¥Ό μ¶”μ¶ν•©λ‹λ‹¤. μ΄λ―Έ μ΅΄μ¬ν•λ λ³€μ <code>key</code>μ™€ κ°™μ€ μ΄λ¦„μ„ ν¨ν„΄μ—μ„ μ‚¬μ©ν•΄ κΈ°μ΅΄ λ³€μμ μ •μλ¥Ό <a href="https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html#shadowing">shadow</a>ν•λ”λ°, μ΄λ” Rustμ—μ„ <code>Option</code> νƒ€μ… μ•μ κ°’μ„ μ¶”μ¶ν•  λ• μμ£Ό μ‚¬μ©λλ” λ°©μ‹μ…λ‹λ‹¤.</p>
<p>μ΄μ  ν‚¤λ³΄λ“λ΅ μ«μλ¥Ό μ…λ ¥ν•  μ μμµλ‹λ‹¤.</p>
<p><img src="qemu-printing-numbers.gif" alt="QEMU printing numbers to the screen" /></p>
<p>λ‚λ¨Έμ§€ ν‚¤λ¥Ό μΈμ‹ν•λ” κ²ƒλ„ μ„μ™€ λ§μ°¬κ°€μ§€ λ°©λ²•μΌλ΅ μ§„ν–‰ν•λ©΄ λ©λ‹λ‹¤. λ‹¤ν–‰νλ„, <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/"><code>pc-keyboard</code></a> ν¬λ μ΄νΈκ°€ 1λ²/2λ² μ¤μΊ”μ½”λ“ μ…‹μ„ ν•΄μ„ν•λ” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. <code>Cargo.toml</code>μ— μ΄ ν¬λ μ΄νΈλ¥Ό μ¶”κ°€ν•κ³  <code>lib.rs</code>μ—μ„ λ¶λ¬μ™€ μ‚¬μ©ν•©λ‹λ‹¤.</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">dependencies</span><span>]
</span><span style="color:#569cd6;">pc-keyboard </span><span>= </span><span style="color:#d69d85;">&quot;0.5.0&quot;
</span></code></pre>
<p><code>pc-keyboard</code> ν¬λ μ΄νΈλ¥Ό μ‚¬μ©ν•΄ <code>keyboard_interrupt_handler</code> ν•¨μλ¥Ό μƒλ΅ μ‘μ„±ν•©λ‹λ‹¤.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in/src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    </span><span style="color:#569cd6;">use </span><span>pc_keyboard::{layouts, DecodedKey, HandleControl, Keyboard, ScancodeSet1};
</span><span>    </span><span style="color:#569cd6;">use </span><span>spin::Mutex;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    lazy_static! {
</span><span>        </span><span style="color:#569cd6;">static ref </span><span style="color:#b4cea8;">KEYBOARD</span><span>: Mutex&lt;Keyboard&lt;layouts::Us104Key, ScancodeSet1&gt;&gt; =
</span><span>            Mutex::new(Keyboard::new(layouts::Us104Key, ScancodeSet1,
</span><span>                HandleControl::Ignore)
</span><span>            );
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> keyboard = </span><span style="color:#b4cea8;">KEYBOARD</span><span>.lock();
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0x60</span><span>);
</span><span>
</span><span>    </span><span style="color:#569cd6;">let</span><span> scancode: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#569cd6;">unsafe </span><span>{ port.read() };
</span><span>    </span><span style="color:#569cd6;">if let </span><span>Ok(Some(key_event)) = keyboard.add_byte(scancode) {
</span><span>        </span><span style="color:#569cd6;">if let </span><span>Some(key) = keyboard.process_keyevent(key_event) {
</span><span>            </span><span style="color:#569cd6;">match</span><span> key {
</span><span>                DecodedKey::Unicode(character) </span><span style="color:#569cd6;">=&gt; </span><span>print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, character),
</span><span>                DecodedKey::RawKey(key) </span><span style="color:#569cd6;">=&gt; </span><span>print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{:?}</span><span style="color:#d69d85;">&quot;</span><span>, key),
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p><code>lazy_static</code> λ§¤ν¬λ΅λ¥Ό μ‚¬μ©ν•΄ Mutexλ΅ κ°μ‹Ό <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.Keyboard.html"><code>Keyboard</code></a> νƒ€μ…μ static μ¤λΈμ νΈλ¥Ό μ–»μµλ‹λ‹¤. <code>Keyboard</code>κ°€ λ―Έκµ­ ν‚¤λ³΄λ“ λ μ΄μ•„μ›ƒκ³Ό 1λ² μ¤μΊ”μ½”λ“ μ…‹μ„ μ‚¬μ©ν•λ„λ΅ μ΄κΈ°ν™”ν•©λ‹λ‹¤. <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/enum.HandleControl.html"><code>HandleControl</code></a> λ§¤κ°λ³€μλ¥Ό μ‚¬μ©ν•λ©΄ <code>ctrl+[a-z]</code> ν‚¤ μ…λ ¥μ„ μ λ‹μ½”λ“ <code>U+0001</code>μ—μ„ <code>U+001A</code>κΉμ§€ κ°’μ— λ€μ‘μ‹ν‚¬ μ μμµλ‹λ‹¤. μ°λ¦¬λ” κ·Έλ ‡κ² ν•μ§€ μ•κΈ° μ„ν•΄ ν•΄λ‹Ή λ§¤κ°λ³€μμ— <code>Ignore</code> μµμ…μ„ μ£Όκ³  <code>ctrl</code> ν‚¤λ¥Ό μΌλ° ν‚¤λ΅μ„ μ·¨κΈ‰ν•©λ‹λ‹¤.</p>
<p>μΈν„°λ½νΈλ§λ‹¤ μ°λ¦¬λ” Mutexλ¥Ό μ κ·Έκ³  ν‚¤λ³΄λ“ μ»¨νΈλ΅¤λ¬λ΅λ¶€ν„° μ¤μΊ” μ½”λ“λ¥Ό μ½μ–΄μ¨ ν›„, κ·Έ μ¤μΊ” μ½”λ“λ¥Ό <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.Keyboard.html#method.add_byte"><code>add_byte</code></a> ν•¨μμ— μ „λ‹¬ν•©λ‹λ‹¤. μ΄ ν•¨μλ” μ¤μΊ” μ½”λ“λ¥Ό <code>Option&lt;KeyEvent&gt;</code>μΌλ΅ λ³€ν™ν•©λ‹λ‹¤. <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.KeyEvent.html"><code>KeyEvent</code></a> νƒ€μ…μ€ μ…λ ¥λ ν‚¤μ μ •λ³΄μ™€ ν‚¤μ λ„λ¦„/λ— μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤.</p>
<p><a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.Keyboard.html#method.process_keyevent"><code>process_keyevent</code></a> ν•¨μκ°€ μΈμλ΅ λ°›μ€ <code>KeyEvent</code>λ¥Ό λ³€ν™ν•μ—¬ μ…λ ¥λ ν‚¤μ λ¬Έμλ¥Ό λ°ν™ν•©λ‹λ‹¤ (λ³€ν™ λ¶κ°€ν• κ²½μ° <code>None</code> λ°ν™). μλ¥Ό λ“¤μ–΄, <code>A</code>ν‚¤ μ…λ ¥ μ‹ shiftν‚¤ μ…λ ¥ μ—¬λ¶€μ— λ”°λΌ μ†λ¬Έμ <code>a</code> λλ” λ€λ¬Έμ <code>A</code>λ¥Ό μ–»μµλ‹λ‹¤.</p>
<p>μμ •ν• μΈν„°λ½νΈ μ²λ¦¬ ν•¨μλ¥Ό ν†µν•΄ ν…μ¤νΈλ¥Ό μ…λ ¥ν• λ€λ΅ ν™”λ©΄μ— μ¶λ ¥ν•  μ μμµλ‹λ‹¤.</p>
<p><img src="qemu-typing.gif" alt="Typing β€Hello Worldβ€ in QEMU" /></p>
<h3 id="kibodde-sseojjeonhagi"><a class="zola-anchor" href="index.html#kibodde-sseojjeonhagi" aria-label="Anchor link for: kibodde-sseojjeonhagi">π”—</a>ν‚¤λ³΄λ“ μ„¤μ •ν•κΈ°</h3>
<p>PS/2 ν‚¤λ³΄λ“μ μΌλ¶€ μ„¤μ •μ„ λ³€κ²½ν•λ” κ²ƒμ΄ κ°€λ¥ν•λ°, μλ¥Ό λ“¤λ©΄ μ–΄λ–¤ μ¤μΊ” μ½”λ“ μ§‘ν•©μ„ μ‚¬μ©ν• μ§€ μ§€μ •ν•  μ μμµλ‹λ‹¤. λ³Έλ¬Έμ΄ λ„λ¬΄ κΈΈμ–΄μ§€λ‹ ν•΄λ‹Ή λ‚΄μ©κΉμ§€ λ‹¤λ£¨μ§€λ” μ•κ² μ§€λ§, OSDev μ„ν‚¤λ¥Ό ν™•μΈν•μ‹λ©΄ <a href="https://wiki.osdev.org/PS/2_Keyboard#Commands">ν‚¤λ³΄λ“ μ„¤μ •μ„ λ³€κ²½ν•  λ• μ‚¬μ©ν•  μ μλ” λ…λ Ήμ–΄</a>λ“¤μ λ©λ΅μ„ λ³΄μ‹¤ μ μμµλ‹λ‹¤.</p>
<h2 id="jjeonri"><a class="zola-anchor" href="index.html#jjeonri" aria-label="Anchor link for: jjeonri">π”—</a>μ •λ¦¬</h2>
<p>μ΄ κΈ€μ—μ„λ” μΈν„°λ½νΈλ¥Ό ν™μ„±ν™”ν•κ³  μ™Έλ¶€ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•λ” λ°©λ²•μ— λ€ν•΄ μ„¤λ…ν–μµλ‹λ‹¤. μ°λ¦¬λ” 8259 PIC μ¥μΉ, μ£Ό PICμ™€ λ¶€ PICλ¥Ό μ—°κ²°ν•λ” λ°©μ‹, μΈν„°λ½νΈ λ²νΈλ¥Ό μ¬λ°°μ •ν•λ” λ°©λ²•, κ·Έλ¦¬κ³  β€end of interruptβ€ μ‹ νΈ λ“±μ— λ€ν•΄ λ°°μ› μµλ‹λ‹¤. μ°λ¦¬λ” ν•λ“μ›¨μ–΄ νƒ€μ΄λ¨Έμ™€ ν‚¤λ³΄λ“μ μΈν„°λ½νΈ μ²λ¦¬ ν•¨μλ¥Ό κµ¬ν„ν–κ³ , CPUλ¥Ό λ‹¤μ μΈν„°λ½νΈκΉμ§€ λ©μ¶”λ” <code>hlt</code> λ…λ Ήμ–΄μ— λ€ν•΄ λ°°μ› μµλ‹λ‹¤.</p>
<p>μ΄μ  μ»¤λ„κ³Ό μƒνΈμ‘μ©ν•  μ μκ² λμ—μΌλ‹, κ°„λ‹¨ν• μ»¤λ§¨λ“ μ‰μ΄λ‚ κ²μ„μ„ μ‘μ„±ν•  κΈ°λ³Έμ μΈ λ„κµ¬λ¥Ό κ°–μ¶ μ…μ…λ‹λ‹¤.</p>
<h2 id="daheu-ddaggyneun-muheoilggayo"><a class="zola-anchor" href="index.html#daheu-ddaggyneun-muheoilggayo" aria-label="Anchor link for: daheu-ddaggyneun-muheoilggayo">π”—</a>λ‹¤μ λ‹¨κ³„λ” λ¬΄μ—‡μΌκΉμ”?</h2>
<p>μ΄μμ²΄μ μ—μ„ νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ” ν•„μμ μΈ μ΅΄μ¬μ…λ‹λ‹¤. κ·Έ μ΄μ λ” νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ¥Ό μ‚¬μ©ν•΄ μ£ΌκΈ°μ μΌλ΅ μ‹¤ν–‰ μ¤‘μΈ ν”„λ΅μ„Έμ¤λ¥Ό λ©μ¶”κ³  μ»¤λ„λ΅ μ μ–΄ νλ¦„μ„ κ°€μ Έμ¬ μ μκΈ° λ•λ¬Έμ…λ‹λ‹¤. κ·Έ ν›„ μ»¤λ„μ€ λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤λ¥Ό μ‹¤ν–‰μ‹ν‚¬ μ μκ³ , μ—¬λ¬ ν”„λ΅μ„Έμ¤κ°€ λ™μ‹μ— μ‹¤ν–‰ μ¤‘μΈ λ“―ν• μ‚¬μ©μ κ²½ν—μ„ μ κ³µν•  μ μμµλ‹λ‹¤.</p>
<p>ν”„λ΅μ„Έμ¤λ‚ μ¤λ λ“λ¥Ό λ§λ“¤λ ¤λ©΄ μ°μ„  κ·Έλ“¤μ΄ μ‚¬μ©ν•  λ©”λ¨λ¦¬λ¥Ό ν• λ‹Ήν•  λ°©λ²•μ΄ ν•„μ”ν•©λ‹λ‹¤. λ‹¤μ λ‡ κΈ€λ“¤μ—μ„λ” λ©”λ¨λ¦¬ ν• λ‹Ή κΈ°λ¥μ„ μ κ³µν•κΈ° μ„ν• λ©”λ¨λ¦¬ κ΄€λ¦¬ (memory management)μ— λ€ν•΄ μ•μ•„λ³΄κ² μµλ‹λ‹¤.</p>

    </div>

    <div class="post-footer-support">
        <h2>Support Me</h2>
        
<p>
    Creating and <a href="../../status-update/index.html">maintaining</a> this blog and the associated libraries is a lot of work, but I really enjoy doing it. By supporting me, you allow me to invest more time in new content, new features, and continuous maintenance.
</p>
<p>
    The best way to support me is to <a href="https://github.com/sponsors/phil-opp"><em>sponsor me on GitHub</em></a>, since they don't charge any fees. If you prefer other platforms, I also have <a href="https://www.patreon.com/phil_opp"><em>Patreon</em></a> and <a href="https://donorbox.org/phil-opp"><em>Donorbox</em></a> accounts. The latter is the most flexible as it supports multiple currencies and one-time contributions.
</p>
<p>
    Thank you!
</p>

    </div>

    <hr>
    <div class="PageNavigation">
        
            <a class="prev" href="../double-fault-exceptions/index.html">&laquo; λ”λΈ” ν΄νΈ (Double Fault)</a>
        
        
    </div>

    <hr>
    <section>
        <h2 id="comments" class="">λ“κΈ€</h2>

        
            
            
            
        
        
    
        
        
    

    
        
        
    

    <p class="comment-note">
        Do you have a problem, want to share feedback, or discuss further ideas? Feel free to leave a comment here! Please stick to English and follow Rust's <a href="https://www.rust-lang.org/policies/code-of-conduct">code of conduct</a>. This comment thread directly maps to a <a href="https://github.com/phil-opp/blog_os/discussions/categories/post-comments-translated?discussions_q=%22Hardware%20Interrupts%20%28ko%29%22"><em>discussion on GitHub</em></a>, so you can also comment there if you prefer.
    </p>

    <div class="giscus"></div>

    <script src="https://giscus.app/client.js"
        data-repo="phil-opp/blog_os"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzOTU3NTEwMQ=="
        data-category="Post Comments (translated)"
        data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDE4OTg1"
    
        data-mapping="specific"
    
        data-term="Hardware Interrupts (ko)"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        crossorigin="anonymous"
        async>
    </script>

    <p class="comment-directly-on-github">
        Instead of authenticating the <a href="https://giscus.app">giscus</a> application, you can also comment directly <a href="https://github.com/phil-opp/blog_os/discussions/categories/post-comments-translated?discussions_q=%22Hardware%20Interrupts%20%28ko%29%22"><em>on GitHub</em></a>.
    </p>

        <p class="">
            λ“κΈ€μ€ κ°€λ¥ν•λ©΄ μμ–΄λ΅ μ‘μ„±ν•΄μ£Όμ„Έμ”.
        </p>
        
    </section>

    <aside class="page-aside-right">
        <div class="block" id="language-selector">
            <h2>Other Languages</h2>
            
            <ul><li data-lang-switch-to="en" class=""><a href="../../hardware-interrupts/index.html">
                        English (original)
                    </a></li><li data-lang-switch-to="zh-CN" class=""><a href="../../zh-CN/hardware-interrupts/index.html">
                        Chinese (simplified)
                    </a></li><li data-lang-switch-to="ja" class=""><a href="../../ja/hardware-interrupts/index.html">
                        Japanese
                    </a></li><li data-lang-switch-to="fa" class=""><a href="../../fa/hardware-interrupts/index.html">
                        Persian
                    </a></li></ul>
        </div>
    </aside>

</main>
        </div>

        <div></div>

        <footer class="footer">
            <hr>
            <small>
                &copy; <time datetime="2022">2022</time>. All rights reserved.
                <a class="spaced" href="https://github.com/phil-opp/blog_os#license">License</a>
                <a class="spaced" href="../../contact/index.html">Contact</a>
            </small>
        </footer>
    </div>
</body>

</html>
