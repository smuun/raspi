<!doctype html>

<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <meta name="description" content="ุงู ูพุณุช ุจู ุจุฑุฑุณ ุชุณุชโูุง ูุงุญุฏ (ุชุฑุฌูู: unit) ู ฺฉูพุงุฑฺู (ุชุฑุฌูู: integration) ุฏุฑ ูุงูโูุง ุงุฌุฑุง โno_std ูโูพุฑุฏุงุฒุฏ. ูุง ุงุฒ ูพุดุชุจุงู Rust ุจุฑุง ูุฑูโูุฑฺฉ ุชุณุชโูุง ุณโฆ">
    <meta name="author" content="Philipp Oppermann">

    
        <link rel="canonical" href="index.html" />
    
    <link href="../../css/edition-2/main.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="RSS feed for os.phil-opp.com" href="../../rss.xml" />

    <script>
        let theme = localStorage.getItem("theme");
        if (theme != null) {
            document.documentElement.setAttribute("data-theme", theme);
        }
    </script>

    <script async src="../../js/edition-2/main.js"></script>

    <title>ุชุณุช ฺฉุฑุฏู | Writing an OS in Rust</title>
</head>

<body>
    <div class="container content">
        <header class="masthead">
            <div style="position:relative">
                <h2 class="masthead-title">
                    <a href="../../index.html" title="Home">Writing an OS in Rust</a>
                </h2>
                <p><small>Philipp&nbsp;Oppermann's&nbsp;blog</small></p>
                
    <aside id="all-posts-link"><a href="https://os.phil-opp.com/fa" title="All Posts">ยซ ููู ูพุณุชโูุง</a></aside>

            </div>
        </header>

        <div class="theme-switch">
            <div class="light-switch" onclick="toggle_lights()" title="Switch between light and dark theme"></div>
            <div class="light-switch-reset" onclick="clear_theme_override()" title="Clear the theme override and go back to the system theme"></div>
        </div>

        <div>
            
<aside id="toc-aside" class="right-to-left">
        <h2>ููุฑุณุช ูุทุงูุจ</h2>
    <ol>
        <li>
            <a href="index.html#nyzmndyh">ูุงุฒููุฏโูุง</a>
            
        </li><li>
            <a href="index.html#tst-khrdn-dr-rust">ุชุณุช ฺฉุฑุฏู ุฏุฑ Rust</a>
            <ol>
                <li>
                    <a href="index.html#frymwrkh-tst-sfrshy">ูุฑูโูุฑฺฉ ุชุณุช ุณูุงุฑุด</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#khrwj-z-qemu">ุฎุฑูุฌ ุงุฒ QEMU</a>
            <ol>
                <li>
                    <a href="index.html#pwrthy-i-o">ูพูุฑุชโูุง I/O</a>
                </li><li>
                    <a href="index.html#stfdh-z-dstgh-khrwj">ุงุณุชูุงุฏู ุงุฒ ุฏุณุชฺฏุงู ุฎุฑูุฌ</a>
                </li><li>
                    <a href="index.html#khd-khrwj-mwfqyt">ฺฉุฏ ุฎุฑูุฌ ููููุช</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#chp-khrdn-dr-khnswl">ฺุงูพ ฺฉุฑุฏู ุฏุฑ ฺฉูุณูู</a>
            <ol>
                <li>
                    <a href="index.html#pwrt-sryl">ูพูุฑุช ุณุฑุงู</a>
                </li><li>
                    <a href="index.html#argwmnhy-qemu">ุขุฑฺฏููุงูโโูุง QEMU</a>
                </li><li>
                    <a href="index.html#chp-khrdn-pym-kht-hngm-pnykh-khrdn">ฺุงูพ ฺฉุฑุฏู ูพุงู ุฎุทุง ููฺฏุงู ูพูฺฉ ฺฉุฑุฏู</a>
                </li><li>
                    <a href="index.html#pnhn-khrdn-qemu">ูพููุงู ฺฉุฑุฏู QEMU</a>
                </li><li>
                    <a href="index.html#timeouts">Timeouts</a>
                </li><li>
                    <a href="index.html#dfh-khrdn-chp-khwdkhr">ุงุถุงูู ฺฉุฑุฏู ฺุงูพ ุฎูุฏฺฉุงุฑ</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#tst-khrdn-bfr-vga">ุชุณุช ฺฉุฑุฏู ุจุงูุฑ VGA</a>
            
        </li><li>
            <a href="index.html#tsthy-ykhprchh">ุชุณุชโูุง ฺฉูพุงุฑฺู</a>
            <ol>
                <li>
                    <a href="index.html#skht-ykh-khtbkhnh">ุณุงุฎุช ฺฉ ฺฉุชุงุจุฎุงูู</a>
                </li><li>
                    <a href="index.html#tmm-khrdn-tst-ykhprchh">ุชูุงู ฺฉุฑุฏู ุชุณุช ฺฉูพุงุฑฺู</a>
                </li><li>
                    <a href="index.html#tsthy-ayndh">ุชุณุชโูุง ุขูุฏู</a>
                </li><li>
                    <a href="index.html#tsthyy-khh-byd-pnykh-khnnd">ุชุณุชโูุง ฺฉู ุจุงุฏ ูพูฺฉ ฺฉููุฏ</a>
                </li><li>
                    <a href="index.html#tst-hy-bdwn-mhr">ุชุณุช ูุง ุจุฏูู ููุงุฑ</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#khlsh">ุฎูุงุตู</a>
            
        </li><li>
            <a href="index.html#mrhlh-b-dy-chyst">ูุฑุญูู ุจุนุฏ ฺุณุชุ</a>
            
        </li>
        <li class="toc-comments-link"><a href="index.html#comments">ูุธุฑุงุช</a></li>
    </ol>
</aside>

            <main>
    <div class="right-to-left">
    <h1>ุชุณุช ฺฉุฑุฏู</h1>
    <time datetime="2019-04-27" class="post-date">
        Apr 27, 2019
        
    </time>
    </div>

    
        <div class="warning right-to-left">
            
            
            <p>
            <b>ูุญุชูุง ุชุฑุฌูู ุดุฏู:</b>
            ุงู ฺฉ ุชุฑุฌูู ุงุฒ ุฌุงูุนู ฺฉุงุฑุจุฑุงู ุจุฑุง ูพุณุช <strong><a href="../../testing/index.html">Testing</a></strong> ุงุณุช. ููฺฉู ุงุณุช ูุงูุตุ ููุณูุฎ ุดุฏู ุง ุฏุงุฑุง ุฎุทุง ุจุงุดุฏ. ูุทูุง ูุฑ ฺฏููู ูุดฺฉู ุฑุง ุฏุฑ <a href="https://github.com/phil-opp/blog_os/issues/908">ุงู ุงุดู</a> ฺฏุฒุงุฑุด ุฏูุฏ!
            </p>
            <p>
                ุชุฑุฌูู ุชูุณุท <a href="https://github.com/hamidrezakp">@hamidrezakp</a> ู <a href="https://github.com/MHBahrampour">@MHBahrampour</a>.</p>
            </div>
    

    <div class="right-to-left">
    <p>ุงู ูพุณุช ุจู ุจุฑุฑุณ ุชุณุชโูุง ูุงุญุฏ (ุชุฑุฌูู: unit) ู ฺฉูพุงุฑฺู (ุชุฑุฌูู: integration) ุฏุฑ ูุงูโูุง ุงุฌุฑุง โ<code>no_std</code> ูโูพุฑุฏุงุฒุฏ. ูุง ุงุฒ ูพุดุชุจุงู Rust ุจุฑุง ูุฑูโูุฑฺฉ ุชุณุชโูุง ุณูุงุฑุด ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุชูุงุจุน ุชุณุช ุฑุง ุฏุฑูู ฺฉุฑููโูุงู ุงุฌุฑุง ฺฉูู. ุจุฑุง ฺฏุฒุงุฑุด ฺฉุฑุฏู ูุชุงุฌ ุฎุงุฑุฌ ุงุฒ QEMUุ ุงุฒ ูฺฺฏโูุง ูุฎุชูู QEMU ู ุงุจุฒุงุฑ <code>bootimage</code> ุงุณุชูุงุฏู ูโฺฉูู.</p>
<span id="continue-reading"></span>
<p>ุงู ุจูุงฺฏ ุจุตูุฑุช ุขุฒุงุฏ ุฑู <a href="https://github.com/phil-opp/blog_os">ฺฏุชโูุงุจ</a> ุชูุณุนู ุฏุงุฏู ุดุฏู ุงุณุช. ุงฺฏุฑ ุดูุง ูุดฺฉู ุง ุณูุงู ุฏุงุฑุฏุ ูุทูุงู ุขูโุฌุง ฺฉ ุงุดู ุจุงุฒ ฺฉูุฏ. ุดูุง ููฺูู ูโุชูุงูุฏ <a href="index.html#comments">ุฏุฑ ุฒุฑ</a> ุงู ูพุณุช ฺฉุงููุช ุจฺฏุฐุงุฑุฏ. ููุจุน ฺฉุฏ ฺฉุงูู ุงู ูพุณุช ุฑุง ูโุชูุงูุฏ ุฏุฑ ุจูุฑููฺ <a href="https://github.com/phil-opp/blog_os/tree/post-04"><code>post-04</code></a> ูพุฏุง ฺฉูุฏ.</p>
<!-- fix for zola anchor checker (target is in template): <a id="comments"> -->

    <details id = "toc-inline">
        <summary><b>ููุฑุณุช ูุทุงูุจ</b></summary>
        <ul>
            <li>
                <a href="index.html#nyzmndyh">ูุงุฒููุฏโูุง</a>
                
            </li><li>
                <a href="index.html#tst-khrdn-dr-rust">ุชุณุช ฺฉุฑุฏู ุฏุฑ Rust</a>
                <ul>
                    <li>
                        <a href="index.html#frymwrkh-tst-sfrshy">ูุฑูโูุฑฺฉ ุชุณุช ุณูุงุฑุด</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#khrwj-z-qemu">ุฎุฑูุฌ ุงุฒ QEMU</a>
                <ul>
                    <li>
                        <a href="index.html#pwrthy-i-o">ูพูุฑุชโูุง I/O</a>
                    </li><li>
                        <a href="index.html#stfdh-z-dstgh-khrwj">ุงุณุชูุงุฏู ุงุฒ ุฏุณุชฺฏุงู ุฎุฑูุฌ</a>
                    </li><li>
                        <a href="index.html#khd-khrwj-mwfqyt">ฺฉุฏ ุฎุฑูุฌ ููููุช</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#chp-khrdn-dr-khnswl">ฺุงูพ ฺฉุฑุฏู ุฏุฑ ฺฉูุณูู</a>
                <ul>
                    <li>
                        <a href="index.html#pwrt-sryl">ูพูุฑุช ุณุฑุงู</a>
                    </li><li>
                        <a href="index.html#argwmnhy-qemu">ุขุฑฺฏููุงูโโูุง QEMU</a>
                    </li><li>
                        <a href="index.html#chp-khrdn-pym-kht-hngm-pnykh-khrdn">ฺุงูพ ฺฉุฑุฏู ูพุงู ุฎุทุง ููฺฏุงู ูพูฺฉ ฺฉุฑุฏู</a>
                    </li><li>
                        <a href="index.html#pnhn-khrdn-qemu">ูพููุงู ฺฉุฑุฏู QEMU</a>
                    </li><li>
                        <a href="index.html#timeouts">Timeouts</a>
                    </li><li>
                        <a href="index.html#dfh-khrdn-chp-khwdkhr">ุงุถุงูู ฺฉุฑุฏู ฺุงูพ ุฎูุฏฺฉุงุฑ</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#tst-khrdn-bfr-vga">ุชุณุช ฺฉุฑุฏู ุจุงูุฑ VGA</a>
                
            </li><li>
                <a href="index.html#tsthy-ykhprchh">ุชุณุชโูุง ฺฉูพุงุฑฺู</a>
                <ul>
                    <li>
                        <a href="index.html#skht-ykh-khtbkhnh">ุณุงุฎุช ฺฉ ฺฉุชุงุจุฎุงูู</a>
                    </li><li>
                        <a href="index.html#tmm-khrdn-tst-ykhprchh">ุชูุงู ฺฉุฑุฏู ุชุณุช ฺฉูพุงุฑฺู</a>
                    </li><li>
                        <a href="index.html#tsthy-ayndh">ุชุณุชโูุง ุขูุฏู</a>
                    </li><li>
                        <a href="index.html#tsthyy-khh-byd-pnykh-khnnd">ุชุณุชโูุง ฺฉู ุจุงุฏ ูพูฺฉ ฺฉููุฏ</a>
                    </li><li>
                        <a href="index.html#tst-hy-bdwn-mhr">ุชุณุช ูุง ุจุฏูู ููุงุฑ</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#khlsh">ุฎูุงุตู</a>
                
            </li><li>
                <a href="index.html#mrhlh-b-dy-chyst">ูุฑุญูู ุจุนุฏ ฺุณุชุ</a>
                
            </li>
            <li class="toc-comments-link"><a href="index.html#comments">ูุธุฑุงุช</a></li>
        </ul>
    </details>

<h2 id="nyzmndyh"><a class="zola-anchor" href="index.html#nyzmndyh" aria-label="Anchor link for: nyzmndyh">๐</a>ูุงุฒููุฏโูุง</h2>
<p>ุงู ูพุณุช ุฌุงฺฏุฒู (ุญุงูุง ููุณูุฎ ุดุฏู) ูพุณุชโูุง <a href="../../unit-testing/index.html"><em>Unit Testing</em></a> ู <a href="../../integration-tests/index.html"><em>Integration Tests</em></a> ูโุดูุฏ. ูุฑุถ ุจุฑ ุงู ุงุณุช ฺฉู ุดูุง ูพุณุช <a href="../../minimal-rust-kernel/index.html"><em>ฺฉ ฺฉุฑูู ูููุงู ุจุง Rust</em></a> ุฑุง ูพุณ ุงุฒ 27-09-2019 ุฏูุจุงู ฺฉุฑุฏูโุงุฏ. ุงุณุงุณุงู ูุงุฒ ุงุณุช ฺฉู ุดูุง ฺฉ ูุงู <code>.cargo/config.toml</code> ุฏุงุดุชู ุจุงุดุฏ ฺฉู <a href="../../minimal-rust-kernel/index.html#set-a-default-target">ฺฉ ูุฏู ูพุดูุฑุถ ูุดุฎุต ูโฺฉูุฏ</a> ู <a href="../../minimal-rust-kernel/index.html#using-cargo-run">ฺฉ ุงุฌุฑุง ฺฉููุฏู ูุงุจู ุงุฌุฑุง ุชุนุฑู ูโฺฉูุฏ</a>.</p>
<h2 id="tst-khrdn-dr-rust"><a class="zola-anchor" href="index.html#tst-khrdn-dr-rust" aria-label="Anchor link for: tst-khrdn-dr-rust">๐</a>ุชุณุช ฺฉุฑุฏู ุฏุฑ Rust</h2>
<p>ุฒุจุงู Rust ฺฉ <a href="https://doc.rust-lang.org/book/second-edition/ch11-00-testing.html">ูุฑูโูุฑฺฉ ุชุณุช ุชูฺฉุงุฑ</a> ุฏุงุฑุฏ ฺฉู ูุงุฏุฑ ุจู ุงุฌุฑุง ุชุณุชโูุง ูุงุญุฏ ุจุฏูู ูุงุฒ ุจู ุชูุธู ูุฑ ฺุฒ ุงุณุช. ููุท ฺฉุงู ุงุณุช ุชุงุจุน ุงุฌุงุฏ ฺฉูุฏ ฺฉู ุจุฑุฎ ูุชุงุฌ ุฑุง ุงุฒ ุทุฑู ุงูุณุฑุดูโูุง (ฺฉููู: assertions) ุจุฑุฑุณ ฺฉูุฏ ู ุตูุช <code>#[test]</code> ุฑุง ุจู ูุฏุฑ ุชุงุจุน (ุชุฑุฌูู: function header) ุงุถุงูู ฺฉูุฏ. ุณูพุณ <code>cargo test</code> ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุงู ุชุงุจุนโูุง ุชุณุช ฺฉุฑุช ุดูุง ุฑุง ูพุฏุง ู ุงุฌุฑุง ูโฺฉูุฏ.</p>
<p>ูุชุฃุณูุงูู ุจุฑุง ุจุฑูุงููโูุง <code>no_std</code> ูุงููุฏ ูุณุชู ูุง ฺฉู ูพฺุฏูโุชุฑ ุงุณุช. ูุณุฆูู ุงู ุงุณุช ฺฉู ูุฑูโูุฑฺฉ ุชุณุช Rust ุจู ุทูุฑ ุถูู ุงุฒ ฺฉุชุงุจุฎุงูู <a href="https://doc.rust-lang.org/test/index.html"><code>test</code></a> ุฏุงุฎู ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู ุจู ฺฉุชุงุจุฎุงูู ุงุณุชุงูุฏุงุฑุฏ ูุงุจุณุชูโ ุงุณุช. ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ูุง ููโุชูุงูู ุงุฒ ูุฑูโูุฑฺฉ ุชุณุช ูพุดูุฑุถ ุจุฑุง ูุณุชู <code>#[no_std]</code> ุฎูุฏ ุงุณุชูุงุฏู ฺฉูู.</p>
<p>ููุช ูโุฎูุงูู <code>cargo test</code> ุฑุง ุฏุฑ ูพุฑูฺู ุฎูุฏ ุงุฌุฑุง ฺฉููุ ฺูู ฺุฒ ูโุจูู:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>&gt; cargo test
</span><span>   Compiling blog_os v0.1.0 (/โฆ/blog_os)
</span><span>error[E0463]: can&#39;t find crate for `test`
</span></code></pre>
<p>ุงุฒ ุขูโุฌุง ฺฉู ฺฉุฑุช <code>test</code> ุจู ฺฉุชุงุจุฎุงูู ุงุณุชุงูุฏุงุฑุฏ ูุงุจุณุชู ุงุณุชุ ุจุฑุง ูุฏู bare metal ูุง ุฏุฑ ุฏุณุชุฑุณ ูุณุช. ุฏุฑ ุญุงู ฺฉู ุงุณุชูุงุฏู ุงุฒ ฺฉุฑุช <code>test</code> ุฏุฑ ฺฉ <code>#[no_std]</code> <a href="https://github.com/japaric/utest">ุงูฺฉุงู ูพุฐุฑ ุงุณุช</a>ุ ุงูุง ุจุณุงุฑ ูุงูพุงุฏุงุฑ ุจูุฏู ู ุจู ุจุฑุฎ ูฺฉโูุง ูุงููุฏ ุชุนุฑู ูุฌุฏุฏ ูุงฺฉุฑู <code>panic</code> ูุงุฒ ุฏุงุฑุฏ.</p>
<h3 id="frymwrkh-tst-sfrshy"><a class="zola-anchor" href="index.html#frymwrkh-tst-sfrshy" aria-label="Anchor link for: frymwrkh-tst-sfrshy">๐</a>ูุฑูโูุฑฺฉ ุชุณุช ุณูุงุฑุด</h3>
<p>ุฎูุดุจุฎุชุงููุ Rust ุงุฒ ุฌุงฺฏุฒู ฺฉุฑุฏู ูุฑูโูุฑฺฉ ุชุณุช ูพุดูุฑุถ ุงุฒ ุทุฑู ูฺฺฏ <a href="https://doc.rust-lang.org/unstable-book/language-features/custom-test-frameworks.html"><code>custom_test_frameworks</code></a> ูุงูพุงุฏุงุฑ ูพุดุชุจุงู ูโฺฉูุฏ. ุงู ูฺฺฏ ุจู ฺฉุชุงุจุฎุงูู ุฎุงุฑุฌ ุงุญุชุงุฌ ูุฏุงุฑุฏ ู ุจูุงุจุฑุงู ุฏุฑ ูุญุทโูุง <code>#[no_std]</code> ูุฒ ฺฉุงุฑ ูโฺฉูุฏ. ุงู ฺฉุงุฑ ุจุง ุฌูุน ุขูุฑ ุชูุงู ุชูุงุจุน ุฏุงุฑุง ุตูุช <code>#[test_case]</code> ู ุณูพุณ ูุฑุงุฎูุงู ฺฉ ุชุงุจุน ุงุฌุฑุง ฺฉููุฏู ูุดุฎุต ุดุฏู ุชูุณุท ฺฉุงุฑุจุฑ ู ุจุง ูุณุช ุชุณุชโูุง ุจู ุนููุงู ุขุฑฺฏููุงู ฺฉุงุฑ ูโฺฉูุฏ. ุจูุงุจุฑุงู ุญุฏุงฺฉุซุฑ ฺฉูุชุฑู ูุฑุขูุฏ ุชุณุช ุฑุง ุจู ูุง ูโุฏูุฏ.</p>
<p>ููุทู ุถุนู ุขู ุฏุฑ ููุงุณู ุจุง ูุฑูโูุฑฺฉ ุชุณุช ูพุดูุฑุถ ุงู ุงุณุช ฺฉู ุจุณุงุฑ ุงุฒ ูฺฺฏโูุง ูพุดุฑูุชู ูุงููุฏ <a href="https://doc.rust-lang.org/book/ch11-01-writing-tests.html#checking-for-panics-with-should_panic">ุชุณุชโูุง <code>should_panic</code></a> ุฏุฑ ุฏุณุชุฑุณ ูุณุช. ุฏุฑ ุนูุถุ ุชูู ุงู ูฺฺฏโูุง ุฏุฑ ุตูุฑุช ูุงุฒ ุจู ูพุงุฏูโุณุงุฒ ูุง ุจุณุชฺฏ ุฏุงุฑุฏ. ุงู ุจุฑุง ูุง ุงุฏู ุขู ุงุณุชุ ุฒุฑุง ูุง ฺฉ ูุญุท ุงุฌุฑุง ุจุณุงุฑ ูฺู ุฏุงุฑู ฺฉู ูพุงุฏู ุณุงุฒ ูพุดูุฑุถ ฺูู ูฺฺฏโูุง ูพุดุฑูุชูโุง ุงุญุชูุงูุงู ฺฉุงุฑุณุงุฒ ูุฎูุงูุฏ ุจูุฏ. ุจู ุนููุงู ูุซุงูโุ ุตูุช <code>#[should_panic]</code> ูุชฺฉ ุจู stack unwinding ุจุฑุง ฺฏุฑูุชู ูพูฺฉโูุง (ฺฉููู: panics) ุงุณุชุ ฺฉู ูุง ุขู ุฑุง ุจุฑุง ูุณุชู ุฎูุฏ ุบุฑูุนุงู ฺฉุฑุฏู.</p>
<p>ุจุฑุง ุงุฌุฑุง ฺฉ ูุฑูโูุฑฺฉ ุชุณุช ุณูุงุฑุด ุจุฑุง ูุณุชู ุฎูุฏุ ููุงุฑุฏ ุฒุฑ ุฑุง ุจู <code>main.rs</code> ุงุถุงูู ูโฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#![feature(custom_test_frameworks)]
</span><span>#![test_runner(crate::test_runner)]
</span><span>
</span><span>#[cfg(test)]
</span><span style="color:#569cd6;">fn </span><span>test_runner(tests: </span><span style="color:#569cd6;">&amp;</span><span>[</span><span style="color:#569cd6;">&amp;</span><span>dyn Fn()]) {
</span><span>    println!(</span><span style="color:#d69d85;">&quot;Running </span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;"> tests&quot;</span><span>, tests.len());
</span><span>    </span><span style="color:#569cd6;">for</span><span> test </span><span style="color:#569cd6;">in</span><span> tests {
</span><span>        test();
</span><span>    }
</span><span>}
</span></code></pre>
<p>ุงุฌุฑุง ฺฉููุฏู ูุง ููุท ฺฉ ูพุงู ฺฉูุชุงู ุงุดฺฉุงู ุฒุฏุง ุฑุง ฺุงูพ ูโฺฉูุฏ ู ุณูพุณ ูุฑ ุชุงุจุน ุชุณุช ุฏุฑูู ูุณุช ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ. ููุน ุขุฑฺฏููุงู <code>&amp;[&amp;dyn Fn()]</code> ฺฉ <a href="https://doc.rust-lang.org/std/primitive.slice.html"><em>slice</em></a> ุงุฒ <a href="https://doc.rust-lang.org/1.30.0/book/first-edition/trait-objects.html"><em>trait object</em></a> ุงุณุช ฺฉู ุขู ูู ุงุฑุฌุงุน ุงุฒ ุชูุฑูุช (ฺฉููู: trait) <a href="https://doc.rust-lang.org/std/ops/trait.Fn.html"><em>Fn()</em></a> ูโุจุงุดุฏ. ุฏุฑ ุงุตู ูุณุช ุงุฒ ุงุฑุฌุงุน ุจู ุงููุงุน ุงุณุช ฺฉู ูโุชูุงู ุขูโูุง ุฑุง ูุงููุฏ ฺฉ ุชุงุจุน ุตุฏุง ุฒุฏ. ุงุฒ ุขูโุฌุง ฺฉู ุงู ุชุงุจุน ุจุฑุง ุงุฌุฑุงูุง ฺฉู ุชุณุช ูุจุงุดูุฏ ุจ ูุงุฏู ุงุณุชุ ุงุฒ ูฺฺฏ <code>#[cfg(test)]</code> ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุขู ุฑุง ููุท ุจุฑุง ุชุณุช ฺฉุฑุฏู ุฏุฑ ุงุถุงูู ฺฉูู.</p>
<p>ุญุงู ููุช ฺฉู <code>cargo test</code> ุฑุง ุงุฌุฑุง ูโฺฉููุ ูโุจูู ฺฉู ุงูุงู ููููุช ุขูุฒ ุงุณุช (ุงฺฏุฑ ุงูุทูุฑ ูุณุช ุงุฏุฏุงุดุช ุฒุฑ ุฑุง ุจุฎูุงูุฏ). ุงฺฏุฑฺูุ ููฺูุงู โHello Worldโ ุฑุง ุจู ุฌุง ูพุงู <code>test_runner</code> ูโุจูู. ุฏููุด ุงู ุงุณุช ฺฉู ุชุงุจุน <code>_start</code> ูููุฒ ุจุนููุงู ููุทู ุดุฑูุน ุงุณุชูุงุฏู ูโุดูุฏ. ูฺฺฏ ูุฑูโูุฑฺฉ ุชุณุช ุณูุงุฑุดุ ฺฉ ุชุงุจุน <code>main</code> ุงุฌุงุฏ ูโฺฉูุฏ ฺฉู <code>test_runner</code> ุฑุง ุตุฏุง ูโุฒูุฏุ ุงูุง ุงู ุชุงุจุน ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ ฺุฑุง ฺฉู ูุง ุงุฒ ูฺฺฏ <code>#[no_main]</code> ุงุณุชูุงุฏู ูโฺฉูู ู ููุทู ุดุฑูุน ุฎูุฏูุงู ุฑุง ุงุฌุงุฏ ฺฉุฑุฏู.</p>
<div class = "warning">
<p><strong>ุงุฏุฏุงุดุช:</strong> ุฏุฑุญุงู ุญุงุถุฑ ฺฉ ุจุงฺฏ ุฏุฑ ฺฉุงุฑฺฏู ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุฏุฑ ุจุฑุฎ ููุงุฑุฏ ููุช ุงุฒ <code>cargo test</code> ุงุณุชูุงุฏู ูโฺฉูู ูุง ุฑุง ุจู ุณูุช ุฎุทุง โduplicate lang itemโ ูโุจุฑุฏ. ุฒูุงู ุฑุฎ ูโุฏูุฏ ฺฉู ุดูุง <code>panic = &quot;abort&quot;</code> ุฑุง ุจุฑุง ฺฉ ูพุฑููุงู ุฏุฑ <code>Cargo.toml</code> ุชูุธู ฺฉุฑุฏูโุงุฏ. ุณุน ฺฉูุฏ ุขู ุฑุง ุญุฐู ฺฉูุฏุ ุณูพุณ <code>cargo test</code> ุจุงุฏ ุจู ุฏุฑุณุช ฺฉุงุฑ ฺฉูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุจุดุชุฑ <a href="https://github.com/rust-lang/cargo/issues/7359">ุงุดู ฺฉุงุฑฺฏู</a> ุฑุง ุจุจูุฏ.</p>
</div>
<p>ุจุฑุง ุญู ฺฉุฑุฏู ุงู ูุดฺฉูุ ูุง ุงุจุชุฏุง ูุงุฒ ุฏุงุฑู ฺฉู ูุงู ุชุงุจุน ุชููุฏ ุดุฏู ุฑุง ุงุฒ ุทุฑู ุตูุช <code>reexport_test_harness_main</code> ุจู ฺุฒ ุบุฑ ุงุฒ <code>main</code> ุชุบุฑ ุฏูู. ุณูพุณ ูโุชูุงูู ุชุงุจุน ุชุบุฑ ูุงู ุฏุงุฏู ุดุฏู ุฑุง ุงุฒ ุชุงุจุน <code>_start</code> ุตุฏุง ุจุฒูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#![reexport_test_harness_main </span><span style="color:#569cd6;">= </span><span style="color:#d69d85;">&quot;test_main&quot;</span><span>]
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    println!(</span><span style="color:#d69d85;">&quot;Hello World</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, </span><span style="color:#d69d85;">&quot;!&quot;</span><span>);
</span><span>
</span><span>    #[cfg(test)]
</span><span>    test_main();
</span><span>
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span></code></pre>
<p>ูุง ูุงู ูุฑูโูุฑฺฉ ุชุณุช ุชุงุจุน ุดุฑูุน ุฑุง <code>test_main</code> ฺฏุฐุงุดุชู ู ุขู ุฑุง ุฏุฑูู <code>_start</code> ุตุฏุง ุฒุฏู. ุงุฒ <a href="https://doc.rust-lang.org/1.30.0/book/first-edition/conditional-compilation.html">conditional compilation</a> ุจุฑุง ุงุถุงูู ฺฉุฑุฏู ูุฑุงุฎูุงู <code>test_main</code> ููุท ุฏุฑ ุฒูููโูุง ุชุณุช ุงุณุชูุงุฏู ูโฺฉูู ุฒุฑุง ุชุงุจุน ุฑู ฺฉ ุงุฌุฑุง ุนุงุฏ ุชููุฏ ูุดุฏู ุงุณุช.</p>
<p>ุฒูุงู ฺฉู <code>cargo test</code> ุฑุง ุงุฌุฑุง ูโฺฉููุ ูโุจูู ฺฉู ูพุงู โRunning 0 testsโ ุงุฒ <code>test_runner</code> ุฑู ุตูุญู ููุงุด ุฏุงุฏู ูโุดูุฏ. ุญุงู ูุง ุขูุงุฏูโุงู ุชุง ุงููู ุชุงุจุน ุชุณุช ุฑุง ุจุณุงุฒู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>trivial_assertion() {
</span><span>    print!(</span><span style="color:#d69d85;">&quot;trivial assertion... &quot;</span><span>);
</span><span>    assert_eq!(</span><span style="color:#b5cea8;">1</span><span>, </span><span style="color:#b5cea8;">1</span><span>);
</span><span>    println!(</span><span style="color:#d69d85;">&quot;[ok]&quot;</span><span>);
</span><span>}
</span></code></pre>
<p>ุญุงู ููุช <code>cargo test</code> ุฑุง ุงุฌุฑุง ูโฺฉููุ ุฎุฑูุฌ ุฒุฑ ุฑุง ูโุจูู:</p>
<p><img src="qemu-test-runner-output.png" alt="QEMU printing โHello World!โ, โRunning 1 testsโ, and โtrivial assertionโฆ [ok]โ" /></p>
<p>ุญุงูุง ุจุฎุด <code>tests</code> ุงุฑุณุงู ุดุฏู ุจู ุชุงุจุน <code>test_runner</code> ุดุงูู ฺฉ ุงุฑุฌุงุน ุจู ุชุงุจุน <code>trivial_assertion</code> ุงุณุช. ุงุฒ ุฎุฑูุฌ <code>trivial assertion... [ok]</code> ุฑู ุตูุญู ูโูููู ฺฉู ุชุณุช ููุฑุฏ ูุธุฑ ูุฑุงุฎูุงู ุดุฏู ู ููููุช ุขูุฒ ุจูุฏู ุงุณุช.</p>
<p>ูพุณ ุงุฒ ุงุฌุฑุง ุชุณุชโูุงุ <code>test_runner</code> ุจู ุชุงุจุน <code>test_main</code> ุจุฑูโฺฏุฑุฏุฏุ ฺฉู ุจู ููุจู ุฎูุฏ ุจู ุชุงุจุน <code>_start</code> ุจุฑูโฺฏุฑุฏุฏ. ุฏุฑ ุงูุชูุง <code>_start</code>ุ ฺฉ ุญููู ุจโูพุงุงู ุงุฌุงุฏ ูโฺฉูู ุฒุฑุง ุชุงุจุน ุดุฑูุน ุงุฌุงุฒู ุจุฑฺฏุฑุฏุงุฏู ฺุฒ ุฑุง ูุฏุงุฑุฏ (ุนู ุจุฏูู ุฎุฑูุฌ ุงุณุช). ุงู ฺฉ ูุดฺฉู ุงุณุชุ ุฒุฑุง ูโุฎูุงูู <code>cargo test</code> ูพุณ ุงุฒ ุงุฌุฑุง ุชูุงู ุชุณุชโูุง ุจู ฺฉุงุฑ ุฎูุฏ ูพุงุงู ุฏูุฏ.</p>
<h2 id="khrwj-z-qemu"><a class="zola-anchor" href="index.html#khrwj-z-qemu" aria-label="Anchor link for: khrwj-z-qemu">๐</a>ุฎุฑูุฌ ุงุฒ QEMU</h2>
<p>ุฏุฑ ุญุงู ุญุงุถุฑ ูุง ฺฉ ุญููู ุจโูพุงุงู ุฏุฑ ุงูุชูุง ุชุงุจุน <code>&quot;_start&quot;</code> ุฏุงุฑู ู ุจุงุฏ QEMU ุฑุง ุจู ุตูุฑุช ุฏุณุช ุฏุฑ ูุฑ ูุฑุญูู ุงุฒ <code>cargo test</code> ุจุจูุฏู. ุงู ุฌุง ุชุฃุณู ุฏุงุฑุฏ ุฒุฑุง ูุง ููฺูู ูโุฎูุงูู <code>cargo test</code> ุฑุง ุฏุฑ ุงุณฺฉุฑูพุชโูุง ุจุฏูู ุชุนุงูู ฺฉุงุฑุจุฑ ุงุฌุฑุง ฺฉูู. ฺฉ ุฑุงู ุญู ุฎูุจ ูโุชูุงูุฏ ุงุฌุฑุง ฺฉ ุฑูุด ููุงุณุจ ุจุฑุง ุฎุงููุด ฺฉุฑุฏู ุณุณุชู ุนุงูู ุจุงุดุฏ. ูุชุฃุณูุงูู ุงู ฺฉุงุฑ ูุณุจุชุงู ูพฺุฏู ุงุณุชุ ุฒุฑุง ูุงุฒ ุจู ูพุดุชุจุงู ุงุฒ ุงุณุชุงูุฏุงุฑุฏ <a href="https://wiki.osdev.org/APM">APM</a> ุง <a href="https://wiki.osdev.org/ACPI">ACPI</a> ูุฏุฑุช ุชูุงู ุฏุงุฑุฏ.</p>
<p>ุฎูุดุจุฎุชุงููุ ฺฉ ุฏุฑฺู ูุฑุงุฑ ูุฌูุฏ ุฏุงุฑุฏ: QEMU ุงุฒ ฺฉ ุฏุณุชฺฏุงู ุฎุงุต <code>isa-debug-exit</code> ูพุดุชุจุงู ูโฺฉูุฏุ ฺฉู ุฑุงู ุขุณุงู ุจุฑุง ุฎุฑูุฌ ุงุฒ ุณุณุชู QEMU ุงุฒ ุณุณุชู ูููุงู ูุฑุงูู ูโฺฉูุฏ. ุจุฑุง ูุนุงู ฺฉุฑุฏู ุขูุ ุจุงุฏ ฺฉ ุขุฑฺฏููุงู <code>-device</code> ุฑุง ุจู QEMU ููุชูู ฺฉูู. ูุง ูโุชูุงูู ุงู ฺฉุงุฑ ุฑุง ุจุง ุงุถุงูู ฺฉุฑุฏู ฺฉูุฏ ูพฺฉุฑุจูุฏ <code>pack.metadata.bootimage.test-args</code> ุฏุฑ<code> Cargo.toml</code> ุงูุฌุงู ุฏูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">package.metadata.bootimage</span><span>]
</span><span style="color:#569cd6;">test-args </span><span>= [</span><span style="color:#d69d85;">&quot;-device&quot;</span><span>, </span><span style="color:#d69d85;">&quot;isa-debug-exit,iobase=0xf4,iosize=0x04&quot;</span><span>]
</span></code></pre>
<p><code>bootimage runner</code> ุจุฑุง ฺฉูู ุชุณุชโูุง ุงุฌุฑุง <code> test-args</code> ุฑุง ุจู ุฏุณุชูุฑ ูพุด ูุฑุถ QEMU ุงุถุงูู ู ฺฉูุฏ. ุจุฑุง ฺฉ <code>cargo run</code> ุนุงุฏุ ุขุฑฺฏููุงูโูุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.</p>
<p>ููุฑุงู ุจุง ูุงู ุฏุณุชฺฏุงู (<code>isa-debug-exit</code>)ุ ุฏู ูพุงุฑุงูุชุฑ <code>iobase</code> ู <code>iosize</code> ุฑุง ุนุจูุฑ ูโุฏูู ฺฉู <em>ูพูุฑุช I/O</em> ุฑุง ูุดุฎุต ูโฺฉูุฏ ู ูุณุชู ุงุฒ ุทุฑู ุขู ูโุชูุงูุฏ ุจู ุฏุณุชฺฏุงู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ.</p>
<h3 id="pwrthy-i-o"><a class="zola-anchor" href="index.html#pwrthy-i-o" aria-label="Anchor link for: pwrthy-i-o">๐</a>ูพูุฑุชโูุง I/O</h3>
<p>ุจุฑุง ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท ุจู ูพุฑุฏุงุฒูุฏู ู ุณุฎุช ุงูุฒุงุฑ ุฌุงูุจ ุฏุฑ x86ุ ุฏู ุฑูฺฉุฑุฏ ูุฎุชูู ูุฌูุฏ ุฏุงุฑุฏุ<strong>memory-mapped I/O</strong> ู <strong>port-mapped I/O</strong>. ูุง ูุจูุงู ุจุฑุง ุฏุณุชุฑุณ ุจู <a href="../../vga-text-mode/index.html">ุจุงูุฑ ูุชู VGA</a> ุงุฒ ุทุฑู ุขุฏุฑุณ ุญุงูุธู <code>0xb8000</code> ุงุฒ memory-mapped I/O ุงุณุชูุงุฏู ฺฉุฑุฏูโุงู. ุงู ุขุฏุฑุณ ุจู RAM ููพ (ุชุฑุณู) ูุดุฏู ุงุณุชุ ุจูฺฉู ุจู ุจุฑุฎ ุงุฒ ุญุงูุธูโูุง ุฏุณุชฺฏุงู VGA ููพ ุดุฏู ุงุณุช.</p>
<p>ุฏุฑ ููุงุจูุ port-mapped I/O ุงุฒ ฺฉ ฺฏุฐุฑฺฏุงู I/O ุฌุฏุงฺฏุงูู ุจุฑุง ุงุฑุชุจุงุท ุงุณุชูุงุฏู ูโฺฉูุฏ. ูุฑ ูุณูุช ุฌุงูุจ ูุชุตู ุฏุงุฑุง ฺฉ ุง ฺูุฏ ุดูุงุฑู ูพูุฑุช ุงุณุช. ุจุฑุง ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท ุจุง ฺูู ูพูุฑุช I/Oุ ุฏุณุชูุฑุงูุนููโูุง CPU ุฎุงุต ูุฌูุฏ ุฏุงุฑุฏ ฺฉู <code>in</code> ู <code>out</code> ูุงูุฏู ูโุดููุฏุ ฺฉู ฺฉ ุนุฏุฏ ูพูุฑุช ู ฺฉ ุจุงุช ุฏุงุฏู ุฑุง ูโฺฏุฑูุฏ (ููฺูู ุงู ุฏุณุชูุฑุงุช ุชุบุฑุงุช ุฏุงุฑูุฏ ฺฉู ุงุฌุงุฒู ู ุฏูุฏ ฺฉ <code>u16</code> ุง <code>u32</code> ุงุฑุณุงู ฺฉูุฏ).</p>
<p>ุฏุณุชฺฏุงูโูุง <code>isa-debug-exit</code> ุงุฒ port-mapped I/O ุงุณุชูุงุฏู ูโฺฉููุฏ. ูพุงุฑุงูุชุฑ <code>iobase</code> ูุดุฎุต ูโฺฉูุฏ ฺฉู ุฏุณุชฺฏุงู ุจุงุฏ ุฏุฑ ฺฉุฏุงู ุขุฏุฑุณ ูพูุฑุช ูุฑุงุฑ ุจฺฏุฑุฏ (<code>0xf4</code> ฺฉ ูพูุฑุช <a href="https://wiki.osdev.org/I/O_Ports#The_list">ูุนูููุงู ุงุณุชูุงุฏู ูุดุฏู</a> ุฏุฑ ฺฏุฐุฑฺฏุงู IO x86 ุงุณุช) ู <code>iosize</code> ุงูุฏุงุฒู ูพูุฑุช ุฑุง ูุดุฎุต ูโฺฉูุฏ (<code>0x04</code> ุนู ฺูุงุฑ ุจุงุช).</p>
<h3 id="stfdh-z-dstgh-khrwj"><a class="zola-anchor" href="index.html#stfdh-z-dstgh-khrwj" aria-label="Anchor link for: stfdh-z-dstgh-khrwj">๐</a>ุงุณุชูุงุฏู ุงุฒ ุฏุณุชฺฏุงู ุฎุฑูุฌ</h3>
<p>ุนููฺฉุฑุฏ ุฏุณุชฺฏุงู <code>isa-debug-exit</code> ุจุณุงุฑ ุณุงุฏู ุงุณุช. ููุช ฺฉ ููุฏุงุฑ ุจู ูพูุฑุช I/O ูุดุฎุต ุดุฏู ุชูุณุท <code>iobase</code> ููุดุชู ูโุดูุฏุ ุจุงุนุซ ู ุดูุฏ QEMU ุจุง <a href="https://en.wikipedia.org/wiki/Exit_status">exit status</a> ุฎุงุฑุฌ ุดูุฏ <code>(value &lt;&lt; 1) | 1</code>. ุจูุงุจุฑุงู ููฺฏุงู ฺฉู ูุง <code>0</code> ุฑุง ุฏุฑ ูพูุฑุช ูโููุณูุ QEMU ุจุง ูุถุนุช ุฎุฑูุฌ <code>(0 &lt;&lt; 1) | 1 = 1</code> ุฎุงุฑุฌ ูโุดูุฏ ู ููุช ฺฉู ูุง <code>1</code> ุฑุง ุฏุฑ ูพูุฑุช ูโููุณู ุจุง ูุถุนุช ุฎุฑูุฌ <code>(1 &lt;&lt; 1) | 1 = 3</code> ุงุฒ ุขู ุฎุงุฑุฌ ู ุดูุฏ.</p>
<p>ุจู ุฌุง ูุฑุงุฎูุงู ุฏุณุช ุฏุณุชูุฑุงูุนูู ูุง ุงุณูุจู <code>in</code> ู <code>out</code>ุ ูุง ุงุฒ ุงูุชุฒุงุนุงุช ุงุฑุงุฆู ุดุฏู ุชูุณุท ฺฉุฑุช <a href="https://docs.rs/x86_64/0.14.2/x86_64/"><code>x86_64</code></a> ุงุณุชูุงุฏู ูโฺฉูู. ุจุฑุง ุงูุฒูุฏู ฺฉ ูุงุจุณุชฺฏ ุจู ุขู ฺฉุฑุชุ ุขู ุฑุง ุจู ุจุฎุด <code>dependencies</code> ุฏุฑ <code>Cargo.toml</code> ุงุถุงูู ูโฺฉูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">dependencies</span><span>]
</span><span style="color:#569cd6;">x86_64 </span><span>= </span><span style="color:#d69d85;">&quot;0.14.2&quot;
</span></code></pre>
<p>ุงฺฉููู ูโุชูุงูู ุงุฒ ููุน <a href="https://docs.rs/x86_64/0.14.2/x86_64/instructions/port/struct.Port.html"><code>Port</code></a> ุงุฑุงุฆู ุดุฏู ุชูุณุท ฺฉุฑุช ุจุฑุง ุงุฌุงุฏ ุนููฺฉุฑุฏ <code>exit_qemu</code> ุงุณุชูุงุฏู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[derive(Debug, Clone, Copy, PartialEq, Eq)]
</span><span>#[repr(u32)]
</span><span style="color:#569cd6;">pub enum </span><span>QemuExitCode {
</span><span>    Success = </span><span style="color:#b5cea8;">0x10</span><span>,
</span><span>    Failed = </span><span style="color:#b5cea8;">0x11</span><span>,
</span><span>}
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>exit_qemu(exit_code: QemuExitCode) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0xf4</span><span>);
</span><span>        port.write(exit_code </span><span style="color:#569cd6;">as u32</span><span>);
</span><span>    }
</span><span>}
</span></code></pre>
<p>ุงู ุชุงุจุน ฺฉ <a href="https://docs.rs/x86_64/0.14.2/x86_64/instructions/port/struct.Port.html"><code>Port</code></a> ุฌุฏุฏ ุฏุฑ <code>0xf4</code> ุงุฌุงุฏ ูโฺฉูุฏุ ฺฉู <code>iobase</code> ุฏุณุชฺฏุงู <code>isa-debug-exit</code> ุงุณุช. ุณูพุณ ฺฉุฏ ุฎุฑูุฌ ุนุจูุฑ ุฏุงุฏู ุดุฏู ุฑุง ุฏุฑ ูพูุฑุช ูโููุณุฏ. ูุง ุงุฒ <code>u32</code> ุงุณุชูุงุฏู ูโฺฉูู ุฒุฑุง <code>iosize</code> ุฏุณุชฺฏุงู <code>isa-debug-exit</code> ุฑุง ุจู ุนููุงู 4 ุจุงุช ูุดุฎุต ฺฉุฑุฏู. ูุฑ ุฏู ุนููุงุช ุงูู ูุณุชูุฏุ ุฒุฑุง ููุดุชู ุฏุฑ ฺฉ ูพูุฑุช I/O ูโุชูุงูุฏ ููุฌุฑ ุจู ุฑูุชุงุฑ ุฎูุฏุณุฑุงูู ุดูุฏ.</p>
<p>ุจุฑุง ุชุนู ูุถุนุช ุฎุฑูุฌุ ฺฉ ุงโูุงู (ฺฉููู: enum) <code>QemuExitCode</code> ุงุฌุงุฏ ู ฺฉูู. ุงุฏู ุงู ุงุณุช ฺฉู ุงฺฏุฑ ููู ุชุณุชโูุง ููููุช ุขูุฒ ุจูุฏุ ุจุง ฺฉุฏ ุฎุฑูุฌ ููููุช (ุชุฑุฌูู: success exit code) ุฎุงุฑุฌ ุดูุฏ ู ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุจุง ฺฉุฏ ุฎุฑูุฌ ุดฺฉุณุช (ุชุฑุฌูู: failure exit code) ุฎุงุฑุฌ ุดูุฏ. enum ุจู ุนููุงู <code>#[repr(u32)]</code> ุนูุงูุช ฺฏุฐุงุฑ ุดุฏู ุงุณุช ุชุง ูุฑ ููุน ุฑุง ุจุง ฺฉ ุนุฏุฏ ุตุญุญ <code>u32</code> ูุดุงู ุฏูุฏ. ุจุฑุง ููููุช ุงุฒ ฺฉุฏ ุฎุฑูุฌ <code>0x10</code> ู ุจุฑุง ุดฺฉุณุช ุงุฒ <code>0x11</code> ุงุณุชูุงุฏู ูโฺฉูู. ฺฉุฏูุง ุฎุฑูุฌ ูุงูุน ฺูุฏุงู ูู ููู ูุณุชูุฏุ ุจู ุดุฑุท ฺฉู ุจุง ฺฉุฏูุง ุฎุฑูุฌ ูพุด ูุฑุถ QEMU ูุบุงุฑุช ูุฏุงุดุชู ุจุงุดูุฏ. ุจู ุนููุงู ูุซุงูุ ุงุณุชูุงุฏู ุงุฒ ฺฉุฏ ุฎุฑูุฌ <code>0</code> ุจุฑุง ููููุช ุงุฏู ุฎูุจ ูุณุช ุฒุฑุง ูพุณ ุงุฒ ุชุบุฑ ุดฺฉู ุชุจุฏู ุจู <code>(0 &lt;&lt; 1) | 1 = 1</code> ูโุดูุฏุ ฺฉู ฺฉุฏ ุฎุฑูุฌ ูพุด ูุฑุถ ุงุณุช ุจุฑุง ุฒูุงู ฺฉู QEMU ููโุชูุงูุฏ ุงุฌุฑุง ุดูุฏ. ุจูุงุจุฑุงู ูุง ููโุชูุงูู ุฎุทุง QEMU ุฑุง ุงุฒ ฺฉ ุชุณุช ููููุช ุขูุฒ ุชุดุฎุต ุฏูู.</p>
<p>ุงฺฉููู ู ุชูุงูู <code>test_runner</code> ุฎูุฏ ุฑุง ุจู ุฑูุฒ ฺฉูู ุชุง ูพุณ ุงุฒ ุงุชูุงู ุชุณุชโูุง ุงุฒ QEMU ุฎุงุฑุฌ ุดูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#569cd6;">fn </span><span>test_runner(tests: </span><span style="color:#569cd6;">&amp;</span><span>[</span><span style="color:#569cd6;">&amp;</span><span>dyn Fn()]) {
</span><span>    println!(</span><span style="color:#d69d85;">&quot;Running </span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;"> tests&quot;</span><span>, tests.len());
</span><span>    </span><span style="color:#569cd6;">for</span><span> test </span><span style="color:#569cd6;">in</span><span> tests {
</span><span>        test();
</span><span>    }
</span><span>    </span><span style="color:#608b4e;">/// new
</span><span>    exit_qemu(QemuExitCode::Success);
</span><span>}
</span></code></pre>
<p>ุญุงู ููุช <code>cargo test</code> ุฑุง ุงุฌุฑุง ูโฺฉููุ ูโุจูู ฺฉู QEMU ูพุณ ุงุฒ ุงุฌุฑุง ุชุณุชโูุง ุจูุงูุงุตูู ุจุณุชู ูโุดูุฏ. ูุดฺฉู ุงู ุงุณุช ฺฉู <code>cargo test</code> ุชุณุช ุฑุง ุจู ุนููุงู ุดฺฉุณุช ุชูุณุฑ ูโฺฉูุฏ ุญุช ุงฺฏุฑ ฺฉุฏ ุฎุฑูุฌ <code>Success</code> ุฑุง ุนุจูุฑ ุฏูู:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>&gt; cargo test
</span><span>    Finished dev [unoptimized + debuginfo] target(s) in 0.03s
</span><span>     Running target/x86_64-blog_os/debug/deps/blog_os-5804fc7d2dd4c9be
</span><span>Building bootloader
</span><span>   Compiling bootloader v0.5.3 (/home/philipp/Documents/bootloader)
</span><span>    Finished release [optimized + debuginfo] target(s) in 1.07s
</span><span>Running: `qemu-system-x86_64 -drive format=raw,file=/โฆ/target/x86_64-blog_os/debug/
</span><span>    deps/bootimage-blog_os-5804fc7d2dd4c9be.bin -device isa-debug-exit,iobase=0xf4,
</span><span>    iosize=0x04`
</span><span>error: test failed, to rerun pass &#39;--bin blog_os&#39;
</span></code></pre>
<p>ูุณุฆูู ุงู ุงุณุช ฺฉู <code>cargo test</code> ููู ฺฉุฏูุง ุฎุทุง ุจู ุบุฑ ุงุฒ <code>0</code> ุฑุง ุจู ุนููุงู ุดฺฉุณุช ุฏุฑ ูุธุฑ ูโฺฏุฑุฏ.</p>
<h3 id="khd-khrwj-mwfqyt"><a class="zola-anchor" href="index.html#khd-khrwj-mwfqyt" aria-label="Anchor link for: khd-khrwj-mwfqyt">๐</a>ฺฉุฏ ุฎุฑูุฌ ููููุช</h3>
<p>ุจุฑุง ฺฉุงุฑ ุฏุฑ ุงู ููุฑุฏุ <code>bootimage</code> ฺฉ ฺฉูุฏ ูพฺฉุฑุจูุฏ <code>test-success-exit-code</code> ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ฺฉ ฺฉุฏ ุฎุฑูุฌ ูุดุฎุต ุฑุง ุจู ฺฉุฏ ุฎุฑูุฌ <code>0</code> ููพ ูโฺฉูุฏ:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[</span><span style="color:#808080;">package.metadata.bootimage</span><span>]
</span><span style="color:#569cd6;">test-args </span><span>= [</span><span style="color:#ff3333;">โฆ</span><span>]
</span><span style="color:#569cd6;">test-success-exit-code </span><span>= </span><span style="color:#b5cea8;">33         </span><span style="color:#608b4e;"># (0x10 &lt;&lt; 1) | 1
</span></code></pre>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ูพฺฉุฑุจูุฏุ <code>bootimage</code> ฺฉุฏ ุฎุฑูุฌ ููููุช ูุง ุฑุง ุจู ฺฉุฏ ุฎุฑูุฌ 0 ููพ ูโฺฉูุฏุ ุจู ุทูุฑ ฺฉู <code>cargo test</code> ุจู ุฏุฑุณุช ููุฑุฏ ููููุช ุฑุง ุชุดุฎุต ูโุฏูุฏ ู ุชุณุช ุฑุง ุดฺฉุณุช ุฎูุฑุฏู ุจู ุญุณุงุจ ููโุขูุฑุฏ.</p>
<p>ุงุฌุฑุง ฺฉููุฏู ุชุณุช ูุง ุงฺฉููู ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ QEMU ุฑุง ูโุจูุฏุฏ ู ูุชุงุฌ ุชุณุช ุฑุง ุจู ุฏุฑุณุช ฺฏุฒุงุฑุด ูโฺฉูุฏ. ูุง ููฺูุงู ูโุจูู ฺฉู ูพูุฌุฑู QEMU ุจุฑุง ูุฏุช ุจุณุงุฑ ฺฉูุชุงู ุจุงุฒ ุงุณุชุ ุงูุง ุงู ูุฏุช ุจุณุงุฑ ฺฉูุชุงู ุจุฑุง ุฎูุงูุฏู ูุชุงุฌ ฺฉุงู ูุณุช. ุฌุงูุจ ูโุดูุฏ ุงฺฏุฑ ุจุชูุงูู ูุชุงุฌ ุชุณุช ุฑุง ุจู ุฌุง QEMU ุฏุฑ ฺฉูุณูู ฺุงูพ ฺฉููุ ุจูุงุจุฑุงู ูพุณ ุงุฒ ุฎุฑูุฌ ุงุฒ QEMU ูููุฒ ูโุชูุงูู ุขููุง ุฑุง ุจุจูู.</p>
<h2 id="chp-khrdn-dr-khnswl"><a class="zola-anchor" href="index.html#chp-khrdn-dr-khnswl" aria-label="Anchor link for: chp-khrdn-dr-khnswl">๐</a>ฺุงูพ ฺฉุฑุฏู ุฏุฑ ฺฉูุณูู</h2>
<p>ุจุฑุง ุฏุฏู ุฎุฑูุฌ ุชุณุช ุฑู ฺฉูุณููุ ุจุงุฏ ุฏุงุฏูโูุง ุฑุง ุงุฒ ูุณุชู ุฎูุฏ ุจู ูุญู ุจู ุณุณุชู ูุฒุจุงู ุงุฑุณุงู ฺฉูู. ุฑูุดโูุง ูุฎุชูู ุจุฑุง ุฏุณุชุงุจ ุจู ุงู ูุฏู ูุฌูุฏ ุฏุงุฑุฏุ ุจู ุนููุงู ูุซุงู ุจุง ุงุฑุณุงู ุฏุงุฏูโูุง ุงุฒ ุทุฑู ุฑุงุจุท ุดุจฺฉู TCP. ุจุง ุงู ุญุงูุ ุชูุธู ูพุดุชู ุดุจฺฉู ฺฉ ฺฉุงุฑ ฺฉุงููุง ูพฺุฏู ุงุณุชุ ุจูุงุจุฑุงู ูุง ุจู ุฌุง ุขู ุฑุงู ุญู ุณุงุฏูโุชุฑ ุฑุง ุงูุชุฎุงุจ ุฎูุงูู ฺฉุฑุฏ.</p>
<h3 id="pwrt-sryl"><a class="zola-anchor" href="index.html#pwrt-sryl" aria-label="Anchor link for: pwrt-sryl">๐</a>ูพูุฑุช ุณุฑุงู</h3>
<p>ฺฉ ุฑุงู ุณุงุฏู ุจุฑุง ุงุฑุณุงู ุฏุงุฏูโูุง ุงุณุชูุงุฏู ุงุฒ <a href="https://en.wikipedia.org/wiki/Serial_port">ูพูุฑุช ุณุฑุงู</a> ุงุณุชุ ฺฉ ุงุณุชุงูุฏุงุฑุฏ ุฑุงุจุท ูุฏู ฺฉู ุฏฺฏุฑ ุฏุฑ ุฑุงุงููโูุง ูุฏุฑู ุงูุช ููโุดูุฏ. ูพุงุฏูโุณุงุฒ ุขู ุขุณุงู ุงุณุช ู QEMU ูโุชูุงูุฏ ุจุงุชโูุง ุงุฑุณุงู ุงุฒ ุทุฑู ุณุฑุงู ุฑุง ุจู ุฎุฑูุฌ ุงุณุชุงูุฏุงุฑุฏ ูุฒุจุงู ุง ฺฉ ูุงู ูุฏุงุช ฺฉูุฏ.</p>
<p>ุชุฑุงุดูโูุง ูพุงุฏู ุณุงุฒ ฺฉ ุฑุงุจุท ุณุฑุงู [UART] ูุงูุฏู ูโุดููุฏ. ุฏุฑ x86 <a href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter#UART_models">ูุฏููุง UART ุฒุงุฏ</a> ูุฌูุฏ ุฏุงุฑุฏุ ุงูุง ุฎูุดุจุฎุชุงูู ุชููุง ุชูุงูุช ุขููุง ูฺฺฏโูุง ูพุดุฑูุชูโุง ุงุณุช ฺฉู ูุงุฒ ุจู ุขูโูุง ูุฏุงุฑู. UART ูุงู ุฑุงุฌ ุงูุฑูุฒู ููู ุจุง <a href="https://en.wikipedia.org/wiki/16550_UART">16550 UART</a> ุณุงุฒฺฏุงุฑ ูุณุชูุฏุ ุจูุงุจุฑุงู ูุง ุงุฒ ุขู ูุฏู ุจุฑุง ูุฑูโูุฑฺฉ ุชุณุช ุฎูุฏ ุงุณุชูุงุฏู ุฎูุงูู ฺฉุฑุฏ.</p>
<p>ูุง ุงุฒ ฺฉุฑุช <a href="https://docs.rs/uart_16550"><code>uart_16550</code></a> ุจุฑุง ุดุฑูุน ุงููู UART ู ุงุฑุณุงู ุฏุงุฏูโูุง ุงุฒ ุทุฑู ูพูุฑุช ุณุฑุงู ุงุณุชูุงุฏู ุฎูุงูู ฺฉุฑุฏ. ุจุฑุง ุงูุฒูุฏู ุขู ุจู ุนููุงู ฺฉ ูุงุจุณุชฺฏุ ูุง <code>Cargo.toml</code> ู <code>main.rs</code> ุฎูุฏ ุฑุง ุจู ุฑูุฒ ูโฺฉูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">dependencies</span><span>]
</span><span style="color:#569cd6;">uart_16550 </span><span>= </span><span style="color:#d69d85;">&quot;0.2.0&quot;
</span></code></pre>
<p>ฺฉุฑุช <code>uart_16550</code> ุญุงู ุณุงุฎุชุงุฑ <code>SerialPort</code> ุงุณุช ฺฉู ููุงุงูฺฏุฑ ุซุจุงุชโูุง UART ุงุณุชุ ุงูุง ูุง ูููุฒ ูู ุจุงุฏ ูููููโุง ุงุฒ ุขู ุฑุง ุฎูุฏูุงู ุจุณุงุฒู. ุจุฑุง ุขู ูุง ฺฉ ูุงฺูู <code>โserial</code> ุฌุฏุฏ ุจุง ูุญุชูุง ุฒุฑ ุงุฌุงุฏ ูโฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span style="color:#569cd6;">mod </span><span>serial;
</span></code></pre>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/serial.rs
</span><span>
</span><span style="color:#569cd6;">use </span><span>uart_16550::SerialPort;
</span><span style="color:#569cd6;">use </span><span>spin::Mutex;
</span><span style="color:#569cd6;">use </span><span>lazy_static::lazy_static;
</span><span>
</span><span>lazy_static! {
</span><span>    </span><span style="color:#569cd6;">pub static ref </span><span style="color:#b4cea8;">SERIAL1</span><span>: Mutex&lt;SerialPort&gt; = {
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> serial_port = </span><span style="color:#569cd6;">unsafe </span><span>{ SerialPort::new(</span><span style="color:#b5cea8;">0x3F8</span><span>) };
</span><span>        serial_port.init();
</span><span>        Mutex::new(serial_port)
</span><span>    };
</span><span>}
</span></code></pre>
<p>ูุงููุฏ <a href="../../vga-text-mode/index.html">ุจุงูุฑ ูุชู VGA</a> <a href="../../vga-text-mode/index.html#lazy-statics">vga lazy-static</a>ุ ูุง ุงุฒ <code>lazy_static</code> ู ฺฉ spinlock ุจุฑุง ุงุฌุงุฏ ฺฉ ููููู ููุณูุฏู <code>static</code> ุงุณุชูุงุฏู ูโฺฉูู. ุจุง ุงุณุชูุงุฏู ุงุฒ <code>lazy_static</code> ูโุชูุงู ุงุทููุงู ุญุงุตู ฺฉุฑุฏ ฺฉู ูุชุฏ <code>init</code> ุฏุฑ ุงููู ุงุณุชูุงุฏู ุฏููุงู ฺฉ ุจุงุฑ ูุฑุงุฎูุงู ูโุดูุฏ.</p>
<p>ูุงููุฏ ุฏุณุชฺฏุงู <code>isa-debug-exit</code>ุ UART ุจุง ุงุณุชูุงุฏู ุงุฒ ูพูุฑุช I/O ุจุฑูุงูู ููุณ ูโุดูุฏ. ุงุฒ ุขูุฌุง ฺฉู UART ูพฺุฏูโุชุฑ ุงุณุชุ ุงุฒ ฺูุฏู ูพูุฑุช I/O ุจุฑุง ุจุฑูุงูู ููุณ ุฑุฌุณุชุฑูุง ูุฎุชูู ุฏุณุชฺฏุงู ุงุณุชูุงุฏู ูโฺฉูุฏ. ุชุงุจุน ูุงุงูู <code>SerialPort::new</code> ุงูุชุธุงุฑ ุฏุงุฑุฏ ฺฉู ุขุฏุฑุณ ุงููู ูพูุฑุช I/O ุงุฒ UART ุจู ุนููุงู ุขุฑฺฏููุงู ุจุงุดุฏุ ฺฉู ุงุฒ ุขู ูโุชูุงูุฏ ุขุฏุฑุณ ุชูุงู ูพูุฑุชโูุง ููุฑุฏ ูุงุฒ ุฑุง ูุญุงุณุจู ฺฉูุฏ. ูุง ุฏุฑ ุญุงู ุนุจูุฑ ุฏุงุฏูู ุขุฏุฑุณ ูพูุฑุช <code>0x3F8</code> ูุณุชู ฺฉู ุดูุงุฑู ูพูุฑุช ุงุณุชุงูุฏุงุฑุฏ ุจุฑุง ุงููู ุฑุงุจุท ุณุฑุงู ุงุณุช.</p>
<p>ุจุฑุง ุงูฺฉู ูพูุฑุช ุณุฑุงู ุจู ุฑุงุญุช ูุงุจู ุงุณุชูุงุฏู ุจุงุดุฏุ ูุงฺฉุฑููุง <code>serial_print!</code> ู <code>serial_println!</code> ุฑุง ุงุถุงูู ูโฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[doc(hidden)]
</span><span style="color:#569cd6;">pub fn </span><span>_print(args: ::core::fmt::Arguments) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#b4cea8;">SERIAL1</span><span>.lock().write_fmt(args).expect(</span><span style="color:#d69d85;">&quot;Printing to serial failed&quot;</span><span>);
</span><span>}
</span><span>
</span><span style="color:#608b4e;">/// Prints to the host through the serial interface.
</span><span>#[macro_export]
</span><span>macro_rules! serial_print {
</span><span>    (</span><span style="color:#569cd6;">$</span><span>($arg:</span><span style="color:#569cd6;">tt</span><span>)</span><span style="color:#569cd6;">*</span><span>) </span><span style="color:#569cd6;">=&gt; </span><span>{
</span><span>        $crate::serial::_print(format_args!(</span><span style="color:#569cd6;">$</span><span>($arg)*));
</span><span>    };
</span><span>}
</span><span>
</span><span style="color:#608b4e;">/// Prints to the host through the serial interface, appending a newline.
</span><span>#[macro_export]
</span><span>macro_rules! serial_println {
</span><span>    () </span><span style="color:#569cd6;">=&gt; </span><span>($crate::serial_print</span><span style="color:#569cd6;">!</span><span>(</span><span style="color:#d69d85;">&quot;</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>));
</span><span>    ($fmt:</span><span style="color:#569cd6;">expr</span><span>) </span><span style="color:#569cd6;">=&gt; </span><span>($crate::serial_print</span><span style="color:#569cd6;">!</span><span>(concat!($fmt, </span><span style="color:#d69d85;">&quot;</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>)));
</span><span>    ($fmt:</span><span style="color:#569cd6;">expr</span><span>, </span><span style="color:#569cd6;">$</span><span>($arg:</span><span style="color:#569cd6;">tt</span><span>)</span><span style="color:#569cd6;">*</span><span>) </span><span style="color:#569cd6;">=&gt; </span><span>($crate::serial_print</span><span style="color:#569cd6;">!</span><span>(
</span><span>        concat!($fmt, </span><span style="color:#d69d85;">&quot;</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>), </span><span style="color:#569cd6;">$</span><span>($arg)*));
</span><span>}
</span></code></pre>
<p>ูพุงุฏู ุณุงุฒ ุจุณุงุฑ ุดุจู ุจู ูพุงุฏู ุณุงุฒ ูุงฺฉุฑููุง <code>print</code> ู<code> println</code> ุงุณุช. ุงุฒ ุขูุฌุง ฺฉู ููุน <code>SerialPort</code> ุชูุฑูุช <a href="https://doc.rust-lang.org/nightly/core/fmt/trait.Write.html"><code>fmt::Write</code></a> ุฑุง ูพุงุฏู ุณุงุฒ ูโฺฉูุฏุ ูุงุฒ ูุณุช ุงู ูพุงุฏู ุณุงุฒ ุฑุง ุฎูุฏูุงู ุงูุฌุงู ุฏูู.</p>
<p>ุงฺฉููู ูโุชูุงูู ุจู ุฌุง ุจุงูุฑ ูุชู VGA ุฏุฑ ฺฉุฏ ุชุณุช ุฎูุฏุ ุฑู ุฑุงุจุท ุณุฑุงู ฺุงูพ ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[cfg(test)]
</span><span style="color:#569cd6;">fn </span><span>test_runner(tests: </span><span style="color:#569cd6;">&amp;</span><span>[</span><span style="color:#569cd6;">&amp;</span><span>dyn Fn()]) {
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Running {} tests&quot;</span><span>, tests.len());
</span><span>    [โฆ]
</span><span>}
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>trivial_assertion() {
</span><span>    serial_print!(</span><span style="color:#d69d85;">&quot;trivial assertion... &quot;</span><span>);
</span><span>    assert_eq!(</span><span style="color:#b5cea8;">1</span><span>, </span><span style="color:#b5cea8;">1</span><span>);
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[ok]&quot;</span><span>);
</span><span>}
</span></code></pre>
<p>ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูุงฺฉุฑู <code>serial_println</code> ูุณุชููุงู ุฏุฑ ุฒุฑ ูุถุง ูุงู (ุชุฑุฌูู: namespace) ุฑุดู ูุฑุงุฑ ูโฺฏุฑุฏ ุฒุฑุง ูุง ุงุฒ ุตูุช <code>#[macro_export]</code> ุงุณุชูุงุฏู ฺฉุฑุฏูุ ุจูุงุจุฑุงู ูุงุฑุฏ ฺฉุฑุฏู ุขู ุงุฒ ุทุฑู <code>use crate::serial::serial_println</code> ฺฉุงุฑ ูู ฺฉูุฏ.</p>
<h3 id="argwmnhy-qemu"><a class="zola-anchor" href="index.html#argwmnhy-qemu" aria-label="Anchor link for: argwmnhy-qemu">๐</a>ุขุฑฺฏููุงูโโูุง QEMU</h3>
<p>ุจุฑุง ุฏุฏู ุฎุฑูุฌ ุณุฑุงู ุงุฒ QEMUุ ุจุงุฏ ุงุฒ ุขุฑฺฏููุงู <code>-serial</code> ุจุฑุง ูุฏุงุช ุฎุฑูุฌ ุจู stdout (ุฎุฑูุฌ ุงุณุชุงูุฏุงุฑุฏ) ุงุณุชูุงุฏู ฺฉูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">package.metadata.bootimage</span><span>]
</span><span style="color:#569cd6;">test-args </span><span>= [
</span><span>    </span><span style="color:#d69d85;">&quot;-device&quot;</span><span>, </span><span style="color:#d69d85;">&quot;isa-debug-exit,iobase=0xf4,iosize=0x04&quot;</span><span>, </span><span style="color:#d69d85;">&quot;-serial&quot;</span><span>, </span><span style="color:#d69d85;">&quot;stdio&quot;
</span><span>]
</span></code></pre>
<p>ุญุงูุง ููุช <code>cargo test</code> ุฑุง ุงุฌุฑุง ูโฺฉููุ ุฎุฑูุฌ ุชุณุช ุฑุง ูุณุชููุงู ุฏุฑ ฺฉูุณูู ูุดุงูุฏู ุฎูุงูู ฺฏุฑุฏ:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>&gt; cargo test
</span><span>    Finished dev [unoptimized + debuginfo] target(s) in 0.02s
</span><span>     Running target/x86_64-blog_os/debug/deps/blog_os-7b7c37b4ad62551a
</span><span>Building bootloader
</span><span>    Finished release [optimized + debuginfo] target(s) in 0.02s
</span><span>Running: `qemu-system-x86_64 -drive format=raw,file=/โฆ/target/x86_64-blog_os/debug/
</span><span>    deps/bootimage-blog_os-7b7c37b4ad62551a.bin -device
</span><span>    isa-debug-exit,iobase=0xf4,iosize=0x04 -serial stdio`
</span><span>Running 1 tests
</span><span>trivial assertion... [ok]
</span></code></pre>
<p>ุจุง ุงู ุญุงูุ ููฺฏุงู ฺฉู ฺฉ ุชุณุช ูุงูููู ุจูุฏุ ูุง ููฺูุงู ุฎุฑูุฌ ุฑุง ุฏุงุฎู QEMU ูุดุงูุฏู ูโฺฉููุ ุฒุฑุง panic handler ูููุฒ ุงุฒ <code>println</code> ุงุณุชูุงุฏู ูโฺฉูุฏ. ุจุฑุง ุดุจูโุณุงุฒ ุงูุ ูโุชูุงูู assertion ุฏุฑูู ุชุณุช <code>trivial_assertion</code> ุฑุง ุจู <code>assert_eq!(0, 1)</code> ุชุบุฑ ุฏูู:</p>
<p><img src="qemu-failed-test.png" alt="QEMU printing โHello World!โ and โpanicked at โassertion failed: (left == right) left: 0, right: 1โ, src/main.rs:55:5" /></p>
<p>ูโุจูู ฺฉู ูพุงู panic (ุชููุธ: ูพููฺฉ) ูููุฒ ุฏุฑ ุจุงูุฑ VGA ฺุงูพ ูโุดูุฏุ ุฏุฑ ุญุงู ฺฉู ุฎุฑูุฌโ ุชุณุช ุฏฺฏุฑ (ููุธูุฑ ุชุณุช ูโุจุงุดุฏ ฺฉู ูพูฺฉ ูฺฉูุฏ) ุฏุฑ ูพูุฑุช ุณุฑุงู ฺุงูพ ูโุดูุฏ. ูพุงู ูพูฺฉ ฺฉุงููุงู ููุฏ ุงุณุชุ ุจูุงุจุฑุงู ุฏุฏู ุขู ุฏุฑ ฺฉูุณูู ูุฒ ููุฏ ุฎูุงูุฏ ุจูุฏ.</p>
<h3 id="chp-khrdn-pym-kht-hngm-pnykh-khrdn"><a class="zola-anchor" href="index.html#chp-khrdn-pym-kht-hngm-pnykh-khrdn" aria-label="Anchor link for: chp-khrdn-pym-kht-hngm-pnykh-khrdn">๐</a>ฺุงูพ ฺฉุฑุฏู ูพุงู ุฎุทุง ููฺฏุงู ูพูฺฉ ฺฉุฑุฏู</h3>
<p>ุจุฑุง ุฎุฑูุฌ ุงุฒ QEMU ุจุง ฺฉ ูพุงู ุฎุทุง ููฺฏุงู ฺฉู ูพูฺฉ ุฑุฎ ูโุฏูุฏุ ูโุชูุงูู ุงุฒ <a href="https://doc.rust-lang.org/1.30.0/book/first-edition/conditional-compilation.html">conditional compilation</a> ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ฺฉ panic handler ูุชูุงูุช ุฏุฑ ุญุงูุช ุชุณุช ุงุณุชูุงุฏู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// our existing panic handler
</span><span>#[cfg(not(test))] </span><span style="color:#608b4e;">// new attribute
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    println!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span><span>
</span><span style="color:#608b4e;">// our panic handler in test mode
</span><span>#[cfg(test)]
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[failed]</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>);
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Error: {}</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    exit_qemu(QemuExitCode::Failed);
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span></code></pre>
<p>ุจุฑุง panic handler ุชุณุชู ุฎูุฏูุงูุ ุงุฒ <code>serial_println</code> ุจู ุฌุง <code>println</code> ุงุณุชูุงุฏู ูโฺฉูู ู ุณูพุณ ุจุง ฺฉุฏ ุฎุฑูุฌ ุฎุทุง ุงุฒ QEMU ุฎุงุฑุฌ ูโุดูู. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุจุนุฏ ุงุฒ ูุฑุงุฎูุงู <code>exit_qemu</code> ูููุฒ ุจู ฺฉ ุญููู ุจโูพุงุงู ูุงุฒ ุฏุงุฑู ุฒุฑุง ฺฉุงููพุงูุฑ ููโุฏุงูุฏ ฺฉู ุฏุณุชฺฏุงู <code>isa-debug-exit</code> ุจุงุนุซ ุฎุฑูุฌ ุจุฑูุงูู ูโุดูุฏ.</p>
<p>ุงฺฉููู QEMU ุจุฑุง ุชุณุชโูุง ูุงูููู ูุฒ ุฎุงุฑุฌ ุดุฏู ู ฺฉ ูพุงู ุฎุทุง ููุฏ ุฑู ฺฉูุณูู ฺุงูพ ู ฺฉูุฏ:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>&gt; cargo test
</span><span>    Finished dev [unoptimized + debuginfo] target(s) in 0.02s
</span><span>     Running target/x86_64-blog_os/debug/deps/blog_os-7b7c37b4ad62551a
</span><span>Building bootloader
</span><span>    Finished release [optimized + debuginfo] target(s) in 0.02s
</span><span>Running: `qemu-system-x86_64 -drive format=raw,file=/โฆ/target/x86_64-blog_os/debug/
</span><span>    deps/bootimage-blog_os-7b7c37b4ad62551a.bin -device
</span><span>    isa-debug-exit,iobase=0xf4,iosize=0x04 -serial stdio`
</span><span>Running 1 tests
</span><span>trivial assertion... [failed]
</span><span>
</span><span>Error: panicked at &#39;assertion failed: `(left == right)`
</span><span>  left: `0`,
</span><span> right: `1`&#39;, src/main.rs:65:5
</span></code></pre>
<p>ุงุฒ ุขูโุฌุง ฺฉู ุงฺฉููู ููู ุฎุฑูุฌโูุง ุชุณุช ุฑุง ุฏุฑ ฺฉูุณูู ูุดุงูุฏู ูโฺฉููุ ุฏฺฏุฑ ูุงุฒ ุจู ูพูุฌุฑู QEMU ูุฏุงุฑู ฺฉู ุจุฑุง ูุฏุช ฺฉูุชุงู ุธุงูุฑ ูโุดูุฏ. ุจูุงุจุฑุงู ูโุชูุงูู ุขู ุฑุง ฺฉุงููุง ูพููุงู ฺฉูู.</p>
<h3 id="pnhn-khrdn-qemu"><a class="zola-anchor" href="index.html#pnhn-khrdn-qemu" aria-label="Anchor link for: pnhn-khrdn-qemu">๐</a>ูพููุงู ฺฉุฑุฏู QEMU</h3>
<p>ุงุฒ ุขูุฌุง ฺฉู ูุง ูุชุงุฌ ฺฉุงูู ุชุณุช ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชฺฏุงู <code>isa-debug-exit</code> ู ูพูุฑุช ุณุฑุงู ฺฏุฒุงุฑุด ูโฺฉููุ ุฏฺฏุฑ ูุงุฒ ุจู ูพูุฌุฑู QEMU ูุฏุงุฑู. ูุง ูโุชูุงูู ุขู ุฑุง ุจุง ุนุจูุฑ ุฏุงุฏู ุขุฑฺฏููุงู <code>-display none</code> ุจู QEMU ูพููุงู ฺฉูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">package.metadata.bootimage</span><span>]
</span><span style="color:#569cd6;">test-args </span><span>= [
</span><span>    </span><span style="color:#d69d85;">&quot;-device&quot;</span><span>, </span><span style="color:#d69d85;">&quot;isa-debug-exit,iobase=0xf4,iosize=0x04&quot;</span><span>, </span><span style="color:#d69d85;">&quot;-serial&quot;</span><span>, </span><span style="color:#d69d85;">&quot;stdio&quot;</span><span>,
</span><span>    </span><span style="color:#d69d85;">&quot;-display&quot;</span><span>, </span><span style="color:#d69d85;">&quot;none&quot;
</span><span>]
</span></code></pre>
<p>ุงฺฉููู QEMU ฺฉุงููุง ุฏุฑ ูพุณ ุฒููู ุงุฌุฑุง ูโุดูุฏ ู ุฏฺฏุฑ ูฺ ูพูุฌุฑูโุง ุจุงุฒ ููโุดูุฏ. ุงู ูู ุชููุง ฺฉูุชุฑ ุขุฒุงุฑ ุฏููุฏู ุงุณุชุ ุจูฺฉู ุจู ูุฑูโูุฑฺฉ ุชุณุช ูุง ุงู ุงูฺฉุงู ุฑุง ูโุฏูุฏ ฺฉู ุฏุฑ ูุญุทโูุง ุจุฏูู ุฑุงุจุท ฺฉุงุฑุจุฑ ฺฏุฑุงูฺฉ ูุงููุฏ ุณุฑูุณโูุง CI ุง ฺฉุงูฺฉุดูโูุง <a href="https://en.wikipedia.org/wiki/Secure_Shell">SSH</a> ุงุฌุฑุง ุดูุฏ.</p>
<h3 id="timeouts"><a class="zola-anchor" href="index.html#timeouts" aria-label="Anchor link for: timeouts">๐</a>Timeouts</h3>
<p>ุงุฒ ุขูุฌุง ฺฉู <code>cargo test</code> ููุชุธุฑ ูโูุงูุฏ ุชุง test runner (ุชุฑุฌูู: ุงุฌุฑุง ฺฉููุฏู ุชุณุช) ูพุงุงู ุงุจุฏุ ุชุณุช ฺฉู ูุฑฺฏุฒ ุจู ุงุชูุงู ููโุฑุณุฏ (ฺู ููููุ ฺู ูุงูููู) ูโุชูุงูุฏ ุจุฑุง ููุดู ุงุฌุฑุง ฺฉููุฏู ุชุณุช ุฑุง ูุณุฏูุฏ ฺฉูุฏ. ุงู ุฌุง ุชุฃุณู ุฏุงุฑุฏุ ุงูุง ุฏุฑ ุนูู ูุดฺฉู ุจุฒุฑฺฏ ูุณุช ุฒุฑุง ุงุฌุชูุงุจ ุงุฒ ุญูููโูุง ุจโูพุงุงู ุจู ุทูุฑ ูุนููู ุขุณุงู ุงุณุช. ุจุง ุงู ุญุงูุ ุฏุฑ ููุฑุฏ ูุงุ ุญูููโูุง ุจโูพุงุงู ูโุชูุงููุฏ ุฏุฑ ูููุนุชโูุง ูุฎุชูู ุฑุฎ ุฏููุฏ:</p>
<ul>
<li>ุจูุช ููุฏุฑ ูููู ุจู ุจุงุฑฺฏุฑ ูุณุชู ููโุดูุฏุ ุฏุฑ ูุชุฌู ุณุณุชู ุจู ุทูุฑ ุจโูููู ุฑุงู ุงูุฏุงุฒ ูุฌุฏุฏ ุดูุฏ.</li>
<li>ูุฑูโูุฑฺฉ BIOS/UEFI ูุงุฏุฑ ุจู ุจุงุฑฺฏุฑ ุจูุช ููุฏุฑ ููโุดูุฏุ ุฏุฑ ูุชุฌู ุจุงุฒ ูู ุจุงุนุซ ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ ุจโูพุงุงู ูโุดูุฏ.</li>
<li>ููุช ฺฉู CPU ุฏุฑ ุงูุชูุง ุจุฑุฎ ุงุฒ ุชูุงุจุน ูุง ูุงุฑุฏ ฺฉ <code>loop {}</code> (ุญููู ุจโูพุงุงู) ูโุดูุฏุ ุจู ุนููุงู ูุซุงู ุจู ุฏูู ุงูฺฉู ุฏุณุชฺฏุงู ุฎุฑูุฌ QEMU ุจู ุฏุฑุณุช ฺฉุงุฑ ููโฺฉูุฏ.</li>
<li>ุง ููุช ฺฉู ุณุฎุช ุงูุฒุงุฑ ุจุงุนุซ ุฑุณุช ุดุฏู ุณุณุชู ูโุดูุฏุ ุจู ุนููุงู ูุซุงู ููุช ฺฉ ุงุณุชุซูุง ูพุฑุฏุงุฒูุฏู (ุชุฑุฌูู: CPU exception) ฺฏุฑ ููโุงูุชุฏ (ุฏุฑ ูพุณุช ุจุนุฏ ุชูุถุญ ุฏุงุฏู ุดุฏู ุงุณุช).</li>
</ul>
<p>ุงุฒ ุขูุฌุง ฺฉู ุญููู ูุง ุจโูพุงุงู ุฏุฑ ุจุณุงุฑ ุงุฒ ุดุฑุงุท ููฺฉู ุงุณุช ุฑุฎ ุฏูุฏุ ุจู ุทูุฑ ูพุด ูุฑุถ ุงุจุฒุงุฑ <code>bootimage</code> ุจุฑุง ูุฑ ุชุณุช ต ุฏููู ุฒูุงู ุชุนู ูโฺฉูุฏ. ุงฺฏุฑ ุชุณุช ุฏุฑ ุงู ุฒูุงู ุจู ูพุงุงู ูุฑุณุฏุ ุจู ุนููุงู ูุงูููู ุนูุงูุช ฺฏุฐุงุฑ ุดุฏู ู ุฎุทุง โTimed Outโ ุฏุฑ ฺฉูุณูู ฺุงูพ ู ุดูุฏ. ุงู ูฺฺฏ ุชุถูู ูโฺฉูุฏ ฺฉู ุชุณุชโูุง ฺฉู ุฏุฑ ฺฉ ุญููู ุจโูพุงุงู ฺฏุฑ ฺฉุฑุฏูโุงูุฏุ <code>cargo test</code> ุฑุง ุจุฑุง ููุดู ูุณุฏูุฏ ููโฺฉููุฏ.</p>
<p>ุฎูุฏุชุงู ูโุชูุงูุฏ ุจุง ุงูุฒูุฏู ุนุจุงุฑุช <code>loop {}</code> ุฏุฑ ุชุณุช <code>trivial_assertion</code> ุขู ุฑุง ุงูุชุญุงู ฺฉูุฏ. ููฺฏุงู ฺฉู <code>cargo test</code> ุฑุง ุงุฌุฑุง ูโฺฉูุฏุ ูโุจูุฏ ฺฉู ุงู ุชุณุช ูพุณ ุงุฒ ต ุฏููู ุจู ูพุงุงู ุฑุณุฏู ุงุณุช. ูุฏุช ุฒูุงู ูููุช ุงุฒ ุทุฑู ฺฉ ฺฉูุฏ <code>test-timeout</code> ุฏุฑ Cargo.toml <a href="https://github.com/rust-osdev/bootimage#configuration">ูุงุจู ูพฺฉุฑุจูุฏ</a> ุงุณุช:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">package.metadata.bootimage</span><span>]
</span><span style="color:#569cd6;">test-timeout </span><span>= </span><span style="color:#b5cea8;">300          </span><span style="color:#608b4e;"># (in seconds)
</span></code></pre>
<p>ุงฺฏุฑ ููโุฎูุงูุฏ ต ุฏููู ููุชุธุฑ ุจูุงูุฏ ุชุง ุชุณุช <code>trivial_assertion</code> ุชูุงู ุดูุฏุ ูโุชูุงูุฏ ุจู ุทูุฑ ูููุช ููุฏุงุฑ ููู ุฑุง ฺฉุงูุด ุฏูุฏ.</p>
<h3 id="dfh-khrdn-chp-khwdkhr"><a class="zola-anchor" href="index.html#dfh-khrdn-chp-khwdkhr" aria-label="Anchor link for: dfh-khrdn-chp-khwdkhr">๐</a>ุงุถุงูู ฺฉุฑุฏู ฺุงูพ ุฎูุฏฺฉุงุฑ</h3>
<p>ุชุณุช <code>trivial_assertion</code> ุฏุฑ ุญุงู ุญุงุถุฑ ุจุงุฏ ุงุทูุงุนุงุช ูุถุนุช ุฎูุฏ ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ <code>serial_print!</code>/<code>serial_println!</code> ฺุงูพ ฺฉูุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>trivial_assertion() {
</span><span>    serial_print!(</span><span style="color:#d69d85;">&quot;trivial assertion... &quot;</span><span>);
</span><span>    assert_eq!(</span><span style="color:#b5cea8;">1</span><span>, </span><span style="color:#b5cea8;">1</span><span>);
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[ok]&quot;</span><span>);
</span><span>}
</span></code></pre>
<p>ุงูุฒูุฏู ุฏุณุช ุงู ุฏุณุชูุฑุงุช ฺุงูพ ุจุฑุง ูุฑ ุชุณุช ฺฉู ูโููุณู ุฏุณุช ู ูพุง ฺฏุฑ ุงุณุชุ ุจูุงุจุฑุงู ุจุงุฏ <code>test_runner</code> ุฎูุฏ ุฑุง ุจู ุฑูุฒ ฺฉูู ุชุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงู ูพุงูโูุง ุฑุง ฺุงูพ ฺฉูู. ุจุฑุง ุงูุฌุงู ุงู ฺฉุงุฑุ ูุง ุจุงุฏ ฺฉ ุชุฑุช ุฌุฏุฏ ุจู ูุงู <code>Testable</code> ุงุฌุงุฏ ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span style="color:#569cd6;">pub trait </span><span>Testable {
</span><span>    </span><span style="color:#569cd6;">fn </span><span>run(</span><span style="color:#569cd6;">&amp;</span><span>self) -&gt; ();
</span><span>}
</span></code></pre>
<p>ุงู ุชุฑููุฏ ุงฺฉููู ูพุงุฏู ุณุงุฒ ุงู ุชุฑุช ุจุฑุง ููู ุงููุงุน <code>T</code> ุงุณุช ฺฉู <a href="https://doc.rust-lang.org/stable/core/ops/trait.Fn.html"><code>Fn()</code> trait</a> ุฑุง ูพุงุฏู ุณุงุฒ ูโฺฉููุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span style="color:#569cd6;">impl</span><span>&lt;T&gt; Testable </span><span style="color:#569cd6;">for </span><span>T
</span><span style="color:#569cd6;">where
</span><span>    T: Fn(),
</span><span>{
</span><span>    </span><span style="color:#569cd6;">fn </span><span>run(</span><span style="color:#569cd6;">&amp;</span><span>self) {
</span><span>        serial_print!(</span><span style="color:#d69d85;">&quot;{}...</span><span style="color:#e3bbab;">\t</span><span style="color:#d69d85;">&quot;</span><span>, core::any::type_name::&lt;T&gt;());
</span><span>        self();
</span><span>        serial_println!(</span><span style="color:#d69d85;">&quot;[ok]&quot;</span><span>);
</span><span>    }
</span><span>}
</span></code></pre>
<p>ูุง ุจุง ุงููู ฺุงูพู ูุงู ุชุงุจุน ุงุฒ ุทุฑู ุชุงุจุนู <a href="https://doc.rust-lang.org/stable/core/any/fn.type_name.html"><code>any::type_name</code></a>ุ ุชุงุจุน <code>run</code> ุฑุง ูพุงุฏู ุณุงุฒ ู ฺฉูู. ุงู ุชุงุจุน ูุณุชููุงู ุฏุฑ ฺฉุงููพุงูุฑ ูพุงุฏู ุณุงุฒ ุดุฏู ู ฺฉ ุฑุดุชู ุชูุถุญ ุงุฒ ูุฑ ููุน ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุจุฑุง ุชูุงุจุนุ ููุน ุขููุง ูุงูุดุงู ุงุณุชุ ุจูุงุจุฑุงู ุงู ุฏููุงู ููุงู ฺุฒ ุงุณุช ฺฉู ูุง ุฏุฑ ุงู ููุฑุฏ ูโุฎูุงูู. ฺฉุงุฑุงฺฉุชุฑ <code>\t</code> <a href="https://en.wikipedia.org/wiki/Tab_key#Tab_characters">ฺฉุงุฑุงฺฉุชุฑ tab</a> ุงุณุชุ ฺฉู ููุฏุงุฑ ุชุฑุงุฒุจูุฏโ ุจู ูพุงูโูุง <code>[ok]</code> ุงุถุงูู ูโฺฉูุฏ.</p>
<p>ูพุณ ุงุฒ ฺุงูพ ูุงู ุชุงุจุนุ ูุง ุงุฒ ุทุฑู <code>self ()</code> ุชุงุจุน ุชุณุช ุฑุง ูุฑุงุฎูุงู ูโฺฉูู. ุงู ููุท ุจู ุงู ุฏูู ฺฉุงุฑ ูโฺฉูุฏ ฺฉู ูุง ูุงุฒ ุฏุงุฑู ฺฉู <code>self</code> ุชุฑุช <code>Fn()</code> ุฑุง ูพุงุฏู ุณุงุฒ ฺฉูุฏ. ุจุนุฏ ุงุฒ ุจุงุฒฺฏุดุช ุชุงุจุน ุชุณุชุ ูุง <code>[ok]</code> ุฑุง ฺุงูพ ูโฺฉูู ุชุง ูุดุงู ุฏูุฏ ฺฉู ุชุงุจุน ูพูฺฉ ูฺฉุฑุฏู ุงุณุช.</p>
<p>ุขุฎุฑู ูุฑุญูู ุจู ุฑูุฒุฑุณุงู <code>test_runner</code> ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุชุฑุช ุฌุฏุฏ<code> Testable</code> ุงุณุช:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[cfg(test)]
</span><span style="color:#569cd6;">pub fn </span><span>test_runner(tests: </span><span style="color:#569cd6;">&amp;</span><span>[</span><span style="color:#569cd6;">&amp;</span><span>dyn Testable]) {
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Running {} tests&quot;</span><span>, tests.len());
</span><span>    </span><span style="color:#569cd6;">for</span><span> test </span><span style="color:#569cd6;">in</span><span> tests {
</span><span>        test.run(); </span><span style="color:#608b4e;">// new
</span><span>    }
</span><span>    exit_qemu(QemuExitCode::Success);
</span><span>}
</span></code></pre>
<p>ุชููุง ุฏู ุชุบุฑ ุฑุฎ ุฏุงุฏูุ ููุน ุขุฑฺฏููุงู <code>tests</code> ุงุฒ <code>&amp;[&amp;dyn Fn()]</code> ุจู <code>&amp;[&amp;dyn Testable]</code> ุงุณุช ู ูุง ุงฺฉููู <code>test.run()</code> ุฑุง ุจู ุฌุง <code>test()</code> ูุฑุงุฎูุงู ูโฺฉูู.</p>
<p>ุงฺฉููู ูโุชูุงูู ุนุจุงุฑุงุช ฺุงูพ ุฑุง ุงุฒ ุชุณุช <code>trivial_assertion</code> ุญุฐู ฺฉููุ ุฒุฑุง ุขูโูุง ุงฺฉููู ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ฺุงูพ ูโุดููุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>trivial_assertion() {
</span><span>    assert_eq!(</span><span style="color:#b5cea8;">1</span><span>, </span><span style="color:#b5cea8;">1</span><span>);
</span><span>}
</span></code></pre>
<p>ุฎุฑูุฌ <code>cargo test</code> ุงฺฉููู ุจู ุงู ุดฺฉู ุงุณุช:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>Running 1 tests
</span><span>blog_os::trivial_assertion...	[ok]
</span></code></pre>
<p>ูุงู ุชุงุจุน ุงฺฉููู ูุณุฑ ฺฉุงูู ุจู ุชุงุจุน ุฑุง ุดุงูู ูโุดูุฏุ ฺฉู ุฒูุงู ููุฏ ุงุณุช ฺฉู ุชูุงุจุน ุชุณุช ุฏุฑ ูุงฺููโูุง ูุฎุชูู ูุงู ฺฉุณุงู ุฏุงุฑูุฏ. ุฏุฑ ุบุฑ ุงูุตูุฑุช ุฎุฑูุฌ ููุงููุฏ ูุจู ุงุณุชุ ุงูุง ุฏฺฏุฑ ูุงุฒ ูุณุช ฺฉู ุจู ุตูุฑุช ุฏุณุช ุฏุณุชูุฑุงุช ฺุงูพ ุฑุง ุจู ุชุณุชโูุง ุฎูุฏ ุงุถุงูู ฺฉูู.</p>
<h2 id="tst-khrdn-bfr-vga"><a class="zola-anchor" href="index.html#tst-khrdn-bfr-vga" aria-label="Anchor link for: tst-khrdn-bfr-vga">๐</a>ุชุณุช ฺฉุฑุฏู ุจุงูุฑ VGA</h2>
<p>ุงฺฉููู ฺฉู ฺฉ ูุฑูโูุฑฺฉ ุชุณุชู ฺฉุงุฑุง ุฏุงุฑูุ ูโุชูุงูู ฺูุฏ ุชุณุช ุจุฑุง ุงุฌุฑุง ุจุงูุฑ VGA ุฎูุฏ ุงุฌุงุฏ ฺฉูู. ุงุจุชุฏุงุ ูุง ฺฉ ุชุณุช ุจุณุงุฑ ุณุงุฏู ุจุฑุง ุชุฃุฏ ุงูฺฉู <code>println</code> ุจุฏูู ูพูฺฉ ฺฉุฑุฏู ฺฉุงุฑ ูโฺฉูุฏ ุงุฌุงุฏ ูโฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println_simple() {
</span><span>    println!(</span><span style="color:#d69d85;">&quot;test_println_simple output&quot;</span><span>);
</span><span>}
</span></code></pre>
<p>ุงู ุชุณุช ููุท ฺุฒ ุฑุง ุฏุฑ ุจุงูุฑ VGA ฺุงูพ ู ฺฉูุฏ. ุงฺฏุฑ ุจุฏูู ูพูฺฉ ุชูุงู ุดูุฏุ ุจู ุงู ูุนู ุงุณุช ฺฉู ูุฑุงุฎูุงู <code>println</code> ูุฒ ูพูฺฉ ูฺฉุฑุฏู ุงุณุช.</p>
<p>ุจุฑุง ุงุทููุงู ุงุฒ ุงูโ ฺฉู ูพูฺฉ ุงุฌุงุฏ ููโุดูุฏ ุญุช ุงฺฏุฑ ุฎุทูุท ุฒุงุฏ ฺุงูพ ุดุฏู ู ุฎุทูุท ุงุฒ ุตูุญู ุฎุงุฑุฌ ุดููุฏุ ูโุชูุงูู ุขุฒูุงุด ุฏฺฏุฑ ุงุฌุงุฏ ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println_many() {
</span><span>    </span><span style="color:#569cd6;">for _ in </span><span style="color:#b5cea8;">0</span><span style="color:#569cd6;">..</span><span style="color:#b5cea8;">200 </span><span>{
</span><span>        println!(</span><span style="color:#d69d85;">&quot;test_println_many output&quot;</span><span>);
</span><span>    }
</span><span>}
</span></code></pre>
<p>ููฺูู ูโุชูุงูู ุชุงุจุน ุชุณุช ุงุฌุงุฏ ฺฉูู ุชุง ุชุฃุฏ ฺฉูู ฺฉู ุฎุทูุท ฺุงูพ ุดุฏู ูุงูุนุงู ุฑู ุตูุญู ุธุงูุฑ ู ุดููุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println_output() {
</span><span>    </span><span style="color:#569cd6;">let</span><span> s = </span><span style="color:#d69d85;">&quot;Some test string that fits on a single line&quot;</span><span>;
</span><span>    println!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, s);
</span><span>    </span><span style="color:#569cd6;">for </span><span>(i, c) </span><span style="color:#569cd6;">in</span><span> s.chars().enumerate() {
</span><span>        </span><span style="color:#569cd6;">let</span><span> screen_char = </span><span style="color:#b4cea8;">WRITER</span><span>.lock().buffer.chars[</span><span style="color:#b4cea8;">BUFFER_HEIGHT </span><span>- </span><span style="color:#b5cea8;">2</span><span>][i].read();
</span><span>        assert_eq!(</span><span style="color:#569cd6;">char</span><span>::from(screen_char.ascii_character), c);
</span><span>    }
</span><span>}
</span></code></pre>
<p>ุงู ุชุงุจุน ฺฉ ุฑุดุชู ุขุฒูุงุด ุฑุง ุชุนุฑู ูโฺฉูุฏุ ุขู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ <code>println</code> ฺุงูพ ูโฺฉูุฏ ู ุณูพุณ ุจุฑ ุฑู ฺฉุงุฑุงฺฉุชุฑูุง ุตูุญู ุงุฒ <code> WRITER</code> ุซุงุจุช ุชฺฉุฑุงุฑ (iterate) ูโฺฉูุฏุ ฺฉู ูุดุงู ุฏููุฏู ุจุงูุฑ ูุชู vga ุงุณุช. ุงุฒ ุขูุฌุง ฺฉู <code>println</code> ุฏุฑ ุขุฎุฑู ุฎุท ุตูุญู ฺุงูพ ูโุดูุฏ ู ุณูพุณ ุจูุงูุงุตูู ฺฉ ุฎุท ุฌุฏุฏ ุงุถุงูู ูโฺฉูุฏุ ุฑุดุชู ุจุงุฏ ุฏุฑ ุฎุท<code> BUFFER_HEIGHT - 2</code> ุธุงูุฑ ุดูุฏ.</p>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ <a href="https://doc.rust-lang.org/core/iter/trait.Iterator.html#method.enumerate"><code>enumerate</code></a>ุ ุชุนุฏุงุฏ ุชฺฉุฑุงุฑูุง ุฑุง ุฏุฑ ูุชุบุฑ <code>i</code> ุญุณุงุจ ูโฺฉููุ ุณูพุณ ุงุฒ ุขูโูุง ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ฺฉุงุฑุงฺฉุชุฑ ุตูุญู ูุฑุจูุท ุจู <code>c</code> ุงุณุชูุงุฏู ูโฺฉูู. ุจุง ููุงุณู <code>ascii_character</code> ุงุฒ ฺฉุงุฑุงฺฉุชุฑ ุตูุญู ุจุง <code>c</code>ุ ุงุทููุงู ุญุงุตู ูโฺฉูู ฺฉู ูุฑ ฺฉุงุฑุงฺฉุชุฑ ุงุฒ ุงู ุฑุดุชู ูุงูุนุงู ุฏุฑ ุจุงูุฑ ูุชู vga ุธุงูุฑ ูโุดูุฏ.</p>
<p>ููุงูุทูุฑ ฺฉู ูโุชูุงูุฏ ุชุตูุฑ ฺฉูุฏุ ูุง ูโุชูุงูู ุชูุงุจุน ุชุณุช ุจุดุชุฑ ุงุฌุงุฏ ฺฉููุ ุจู ุนููุงู ูุซุงู ุชุงุจุน ฺฉู ุชุณุช ูโฺฉูุฏ ููฺฏุงู ฺุงูพ ุฎุทูุท ุทููุงู ูพูฺฉ ุงุฌุงุฏ ููโุดูุฏ ู ุจู ุฏุฑุณุช ุจุณุชูโุจูุฏ ูโุดููุฏ. ุง ุชุงุจุน ุจุฑุง ุชุณุช ุงู ฺฉู ุฎุทูุท ุฌุฏุฏุ ฺฉุงุฑุงฺฉุชุฑูุง ุบุฑูุงุจู ฺุงูพ (ุชุฑุฌูู: non-printable) ู ฺฉุงุฑุงฺฉุชุฑูุง non-unicode ุจู ุฏุฑุณุช ุงุฏุงุฑู ูโุดููุฏ.</p>
<p>ุจุฑุง ุจูู ุงู ูพุณุชุ ูุง ูุญูู ุงุฌุงุฏ <em>integration tests</em> ุฑุง ุจุฑุง ุชุณุช ุชุนุงูู ุงุฌุฒุง ูุฎุชูู ุจุง ูู ุชูุถุญ ุฎูุงูู ุฏุงุฏ.</p>
<h2 id="tsthy-ykhprchh"><a class="zola-anchor" href="index.html#tsthy-ykhprchh" aria-label="Anchor link for: tsthy-ykhprchh">๐</a>ุชุณุชโูุง ฺฉูพุงุฑฺู</h2>
<p>ูุฑุงุฑุฏุงุฏ <a href="https://doc.rust-lang.org/book/ch11-03-test-organization.html#integration-tests">ุชุณุชโูุง ฺฉูพุงุฑฺู</a> ุฏุฑ Rust ุงู ุงุณุช ฺฉู ุขูโูุง ุฑุง ุฏุฑ ฺฉ ุฏุงุฑฺฉุชูุฑ <code>tests</code> ุฏุฑ ุฑุดู ูพุฑูฺู ูุฑุงุฑ ุฏูุฏ (ุนู ุฏุฑ ฺฉูุงุฑ ููุฑุณุช <code>src</code>).  ูุฑูโูุฑฺฉ ุชุณุช ูพุด ูุฑุถ ู ูุฑูโูุฑฺฉโูุง ุชุณุช ุณูุงุฑุด ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุงู ุชุณุชโูุง ููุฌูุฏ ุฏุฑ ุขู ููุฑุณุช ุฑุง ุงูุชุฎุงุจ ู ุงุฌุฑุง ูโฺฉููุฏ.</p>
<p>ููู ุชุณุชโูุง ฺฉูพุงุฑฺูุ ูุงู ุงุฌุฑุง ุฎุงุต ุฎูุฏุดุงู ูุณุชูุฏ ู ฺฉุงููุงู ุงุฒ <code>main.rs</code> ุฌุฏุง ูุณุชูุฏ. ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ูุฑ ุชุณุช ุจุงุฏ ุชุงุจุน ููุทู ุดุฑูุน ุฎูุฏ ุฑุง ูุดุฎุต ฺฉูุฏ. ุจุงุฏ ฺฉ ููููู ุชุณุช ฺฉูพุงุฑฺู ุจู ูุงู <code>basic_boot</code> ุงุฌุงุฏ ฺฉูู ุชุง ุจุง ุฌุฒุฆุงุช ุจุจูู ฺฉู ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in tests/basic_boot.rs
</span><span>
</span><span>#![no_std]
</span><span>#![no_main]
</span><span>#![feature(custom_test_frameworks)]
</span><span>#![test_runner(crate::test_runner)]
</span><span>#![reexport_test_harness_main </span><span style="color:#569cd6;">= </span><span style="color:#d69d85;">&quot;test_main&quot;</span><span>]
</span><span>
</span><span style="color:#569cd6;">use </span><span>core::panic::PanicInfo;
</span><span>
</span><span>#[no_mangle] </span><span style="color:#608b4e;">// don&#39;t mangle the name of this function
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    test_main();
</span><span>
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span><span>
</span><span style="color:#569cd6;">fn </span><span>test_runner(tests: </span><span style="color:#569cd6;">&amp;</span><span>[</span><span style="color:#569cd6;">&amp;</span><span>dyn Fn()]) {
</span><span>    unimplemented!();
</span><span>}
</span><span>
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span></code></pre>
<p>ุงุฒ ุขูโุฌุง ฺฉู ุชุณุชโูุง ฺฉูพุงุฑฺู ูุงูโูุง ุงุฌุฑุง ุฌุฏุงฺฏุงููโุง ูุณุชูุฏุ ูุง ุจุงุฏ ุชูุงู ุตูุชโูุง ฺฉุฑุช (<code>no_std</code>ุ <code>no_main</code>ุ <code>test_runner</code> ู ุบุฑู) ุฑุง ุฏูุจุงุฑู ุชูู ฺฉูู. ูุง ููฺูู ุจุงุฏ ฺฉ ุชุงุจุน ุดุฑูุน ุฌุฏุฏ <code>_start</code> ุงุฌุงุฏ ฺฉูู ฺฉู ุชุงุจุน ููุทู ุดุฑูุน ุชุณุช <code>test_main</code> ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ. ูุง ุจู ูฺ ฺฉ ุงุฒ ูฺฺฏโูุง <code>cfg (test)</code> ูุงุฒ ูุฏุงุฑู ุฒุฑุง ุงุฌุฑุงโูุง ุชุณุช ฺฉูพุงุฑฺู ูุฑฺฏุฒ ุฏุฑ ุญุงูุช ุบุฑ ุชุณุช ุณุงุฎุชู ููโุดููุฏ.</p>
<p>ูุง ุงุฒ ูุงฺฉุฑู [สปunimplemented] ุงุณุชูุงุฏู ูโฺฉูู ฺฉู ููุดู ุจู ุนููุงู ฺฉ ูฺฉุงู ูฺฏูุฏุงุฑ ุจุฑุง ุชุงุจุน <code>test_runner</code> ูพูฺฉ ูโฺฉูุฏ ู ููุท ุฏุฑ ุญููู ุฑุณุฏฺฏ ฺฉููุฏู <code>panic</code> ูุนูุงู <code>loop</code> ูโุฒูุฏ. ุฏุฑ ุญุงูุช ุงุฏู ุขูุ ูุง ูโุฎูุงูู ุงู ุชูุงุจุน ุฑุง ุฏููุงู ููุงูุทูุฑ ฺฉู ุฏุฑ <code>main.rs</code> ุฎูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ูุงฺฉุฑู<code> serial_println</code> ู ุชุงุจุน <code>exit_qemu</code> ูพุงุฏู ุณุงุฒ ฺฉุฑุฏูุ ูพุงุฏู ุณุงุฒ ฺฉูู. ูุดฺฉู ุงู ุงุณุช ฺฉู ูุง ุจู ุงู ุชูุงุจุน ุฏุณุชุฑุณ ูุฏุงุฑู ุฒุฑุง ุชุณุชโูุง ฺฉุงููุงู ุฌุฏุง ุงุฒ ุงุฌุฑุง <code>main.rs</code> ุณุงุฎุชู ุดุฏูโุงูุฏ.</p>
<p>ุงฺฏุฑ ุฏุฑ ุงู ูุฑุญูู <code>cargo test</code> ุฑุง ุงูุฌุงู ุฏูุฏุ ฺฉ ุญููู ุจโูพุงุงู ุฎูุงูุฏ ฺฏุฑูุช ุฒุฑุง ุฑุณุฏฺฏ ฺฉููุฏู ูพูฺฉ ุฏุงุฑุง ุญููู ุจโูพุงุงู ุงุณุช. ุจุฑุง ุฎุฑูุฌ ุงุฒ QEMU ุจุงุฏ ุงุฒ ูุงูุจุฑ ุตูุญู ฺฉูุฏ <code>Ctrl + c</code> ุงุณุชูุงุฏู ฺฉูุฏ.</p>
<h3 id="skht-ykh-khtbkhnh"><a class="zola-anchor" href="index.html#skht-ykh-khtbkhnh" aria-label="Anchor link for: skht-ykh-khtbkhnh">๐</a>ุณุงุฎุช ฺฉ ฺฉุชุงุจุฎุงูู</h3>
<p>ุจุฑุง ุฏุฑ ุฏุณุชุฑุณ ูุฑุงุฑ ุฏุงุฏู ุชูุงุจุน ููุฑุฏ ูุงุฒ ุฏุฑ ุชุณุช ฺฉูพุงุฑฺูุ ุจุงุฏ ฺฉ ฺฉุชุงุจุฎุงูู ุฑุง ุงุฒ <code>main.rs</code> ุฌุฏุง ฺฉููุ ฺฉุชุงุจุฎุงููโุง ฺฉู ูโุชูุงูุฏ ุชูุณุท ฺฉุฑุชโูุง ุฏฺฏุฑ ู ุชุณุชโูุง ฺฉูพุงุฑฺู ููุฑุฏ ุงุณุชูุงุฏู ูุฑุงุฑ ุจฺฏุฑุฏ. ุจุฑุง ุงู ฺฉุงุฑุ ฺฉ ูุงู ุฌุฏุฏ <code>src/lib.rs</code> ุงุฌุงุฏ ูโฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// src/lib.rs
</span><span>
</span><span>#![no_std]
</span><span>
</span></code></pre>
<p>ูุงููุฏ <code>main.rs</code> ุ<code>lib.rs</code> ฺฉ ูุงู ุฎุงุต ุงุณุช ฺฉู ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุณุท ฺฉุงุฑฺฏู ุดูุงุณุง ูโุดูุฏ. ฺฉุชุงุจุฎุงูู ฺฉ ูุงุญุฏ ุชููู ุฌุฏุงฺฏุงูู ุงุณุชุ ุจูุงุจุฑุงู ุจุงุฏ ูฺฺฏ <code>#![no_std]</code> ุฑุง ุฏูุจุงุฑู ูุดุฎุต ฺฉูู.</p>
<p>ุจุฑุง ุงูฺฉู ฺฉุชุงุจุฎุงููโูุงู ุจุง <code>cargo test</code> ฺฉุงุฑ ฺฉูุฏุ ุจุงุฏ ุชูุงุจุน ู ุตูุชโูุง ุชุณุช ุฑุง ูุฒ ุงุถุงูู ฺฉูู:
To make our library work with <code>cargo test</code>, we need to also add the test functions and attributes:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span>#![cfg_attr(test, no_main)]
</span><span>#![feature(custom_test_frameworks)]
</span><span>#![test_runner(crate::test_runner)]
</span><span>#![reexport_test_harness_main </span><span style="color:#569cd6;">= </span><span style="color:#d69d85;">&quot;test_main&quot;</span><span>]
</span><span>
</span><span style="color:#569cd6;">use </span><span>core::panic::PanicInfo;
</span><span>
</span><span style="color:#569cd6;">pub trait </span><span>Testable {
</span><span>    </span><span style="color:#569cd6;">fn </span><span>run(</span><span style="color:#569cd6;">&amp;</span><span>self) -&gt; ();
</span><span>}
</span><span>
</span><span style="color:#569cd6;">impl</span><span>&lt;T&gt; Testable </span><span style="color:#569cd6;">for </span><span>T
</span><span style="color:#569cd6;">where
</span><span>    T: Fn(),
</span><span>{
</span><span>    </span><span style="color:#569cd6;">fn </span><span>run(</span><span style="color:#569cd6;">&amp;</span><span>self) {
</span><span>        serial_print!(</span><span style="color:#d69d85;">&quot;{}...</span><span style="color:#e3bbab;">\t</span><span style="color:#d69d85;">&quot;</span><span>, core::any::type_name::&lt;T&gt;());
</span><span>        self();
</span><span>        serial_println!(</span><span style="color:#d69d85;">&quot;[ok]&quot;</span><span>);
</span><span>    }
</span><span>}
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>test_runner(tests: </span><span style="color:#569cd6;">&amp;</span><span>[</span><span style="color:#569cd6;">&amp;</span><span>dyn Testable]) {
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Running {} tests&quot;</span><span>, tests.len());
</span><span>    </span><span style="color:#569cd6;">for</span><span> test </span><span style="color:#569cd6;">in</span><span> tests {
</span><span>        test.run();
</span><span>    }
</span><span>    exit_qemu(QemuExitCode::Success);
</span><span>}
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>test_panic_handler(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[failed]</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>);
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Error: {}</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    exit_qemu(QemuExitCode::Failed);
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span><span>
</span><span style="color:#608b4e;">/// Entry point for `cargo test`
</span><span>#[cfg(test)]
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    test_main();
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span><span>
</span><span>#[cfg(test)]
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    test_panic_handler(info)
</span><span>}
</span></code></pre>
<p>ุจุฑุง ุงูฺฉู <code>test_runner</code> ุฑุง ุฏุฑ ุฏุณุชุฑุณ โุชุณุชโูุง ฺฉูพุงุฑฺู ู ูุงูโูุง ุงุฌุฑุง ูุฑุงุฑ ุฏููุ ุตูุช <code>cfg(test)</code> ุฑุง ุฑู ุขู ุงุนูุงู ููโฺฉูู ู ุนููู ููโฺฉูู. ูุง ููฺูู ูพุงุฏู ุณุงุฒ ุฑุณุฏฺฏ ฺฉููุฏู ูพูฺฉ ุฎูุฏ ุฑุง ุจู ฺฉ ุชุงุจุน ุนููู <code>test_panic_handler</code> ุชุจุฏู ูโฺฉููุ ุจู ุทูุฑ ฺฉู ุจุฑุง ุงุฌุฑุงโูุง ูุฒ ุฏุฑ ุฏุณุชุฑุณ ุจุงุดุฏ.</p>
<p>ุงุฒ ุขูโุฌุง ฺฉู <code>lib.rs</code> ุจู ุทูุฑ ูุณุชูู ุงุฒ<code> main.rs</code> ูุง ุชุณุช ูโุดูุฏุ ููฺฏุงู ฺฉุงููพุงู ฺฉุชุงุจุฎุงูู ุฏุฑ ุญุงูุช ุชุณุชุ ุจุงุฏ ฺฉ ููุทู ุดุฑูุน <code>_start</code> ู ฺฉ ุฑุณุฏฺฏ ฺฉููุฏู ูพูฺฉ ุงุถุงูู ฺฉูู. ุจุง ุงุณุชูุงุฏู ุงุฒ ุตูุช ฺฉุฑุช <a href="https://doc.rust-lang.org/reference/conditional-compilation.html#the-cfg_attr-attribute"><code>cfg_attr</code></a>ุ ุฏุฑ ุงู ุญุงูุช ูฺฺฏ<code>no_main</code> ุฑุง ุจู ุทูุฑ ูุดุฑูุท ูุนุงู ูโฺฉูู.</p>
<p>ูุง ููฺูู ุงโูุงู <code>QemuExitCode</code> ู ุชุงุจุน <code>exit_qemu</code> ุฑุง ุนููู ูโฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span>#[derive(Debug, Clone, Copy, PartialEq, Eq)]
</span><span>#[repr(u32)]
</span><span style="color:#569cd6;">pub enum </span><span>QemuExitCode {
</span><span>    Success = </span><span style="color:#b5cea8;">0x10</span><span>,
</span><span>    Failed = </span><span style="color:#b5cea8;">0x11</span><span>,
</span><span>}
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>exit_qemu(exit_code: QemuExitCode) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0xf4</span><span>);
</span><span>        port.write(exit_code </span><span style="color:#569cd6;">as u32</span><span>);
</span><span>    }
</span><span>}
</span></code></pre>
<p>ุงฺฉููู ูุงูโูุง ุงุฌุฑุง ู ุชุณุชโูุง ฺฉูพุงุฑฺู ูโุชูุงููุฏ ุงู ุชูุงุจุน ุฑุง ุงุฒ ฺฉุชุงุจุฎุงูู ูุงุฑุฏ ฺฉููุฏ ู ูุงุฒ ุจู ุชุนุฑู ูพุงุฏู ุณุงุฒโูุง ุฎูุฏ ูุฏุงุฑูุฏ. ุจุฑุง ุฏุฑ ุฏุณุชุฑุณ ูุฑุงุฑ ุฏุงุฏู <code>println</code> ู <code>serial_println</code>ุ ุงุนูุงู ูุงฺููโูุง ุฑุง ูุฒ ููุชูู ูโฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#569cd6;">pub mod </span><span>serial;
</span><span style="color:#569cd6;">pub mod </span><span>vga_buffer;
</span></code></pre>
<p>ูุง ูุงฺููโูุง ุฑุง ุนููู ูโฺฉูู ุชุง ุงุฒ ุฎุงุฑุฌ ุงุฒ ฺฉุชุงุจุฎุงูู ูุงุจู ุงุณุชูุงุฏู ุจุงุดูุฏ. ุงู ุงูุฑ ููฺูู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ูุงฺฉุฑููุง <code>println</code> ู <code>serial_println</code> ููุฑุฏ ูุงุฒ ุงุณุชุ ุฒุฑุง ุขููุง ุงุฒ ุชูุงุจุน <code>_print</code> ูุงฺููโูุง ุงุณุชูุงุฏู ูโฺฉููุฏ.</p>
<p>ุงฺฉููู ู ุชูุงูู <code>main.rs</code> ุฎูุฏ ุฑุง ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ฺฉุชุงุจุฎุงูู ุจู ุฑูุฒ ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// src/main.rs
</span><span>
</span><span>#![no_std]
</span><span>#![no_main]
</span><span>#![feature(custom_test_frameworks)]
</span><span>#![test_runner(blog_os::test_runner)]
</span><span>#![reexport_test_harness_main </span><span style="color:#569cd6;">= </span><span style="color:#d69d85;">&quot;test_main&quot;</span><span>]
</span><span>
</span><span style="color:#569cd6;">use </span><span>core::panic::PanicInfo;
</span><span style="color:#569cd6;">use </span><span>blog_os::println;
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    println!(</span><span style="color:#d69d85;">&quot;Hello World</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, </span><span style="color:#d69d85;">&quot;!&quot;</span><span>);
</span><span>
</span><span>    #[cfg(test)]
</span><span>    test_main();
</span><span>
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span><span>
</span><span style="color:#608b4e;">/// This function is called on panic.
</span><span>#[cfg(not(test))]
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    println!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span><span>
</span><span>#[cfg(test)]
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    blog_os::test_panic_handler(info)
</span><span>}
</span></code></pre>
<p>ฺฉุชุงุจุฎุงูู ูุงููุฏ ฺฉ ฺฉุฑุช ุฎุงุฑุฌ ูุนููู ูุงุจู ุงุณุชูุงุฏู ุงุณุช. ู ูุงููุฏ ฺฉุฑุช (ฺฉู ุฏุฑ ููุฑุฏ ูุง ฺฉุฑุช <code>blog_os</code> ุงุณุช) ูุฑุงุฎูุงู ูโุดูุฏ. ฺฉุฏ ููู ุงุฒ ุชุงุจุน <code>blog_os :: test_runner</code> ุฏุฑ ุตูุช <code>test_runner</code> ู ุชุงุจุน <code>blog_os :: test_panic_handler</code> ุฏุฑ ุฑุณุฏฺฏ ฺฉููุฏู ูพูฺฉ <code>cfg(test)</code> ุงุณุชูุงุฏู ูโฺฉูุฏ. ููฺูู ูุงฺฉุฑู <code>println</code> ุฑุง ูุงุฑุฏ ูโฺฉูุฏ ุชุง ุฏุฑ ุงุฎุชุงุฑ ุชูุงุจุน <code>_start</code> ู <code>panic</code> ูุฑุงุฑ ฺฏุฑุฏ.</p>
<p>ุฏุฑ ุงู ูุฑุญููุ <code>cargo run</code> ู <code>cargo test</code> ุจุงุฏ ุฏูุจุงุฑู ฺฉุงุฑ ฺฉููุฏ. ุงูุจุชูุ <code>cargo test</code> ูููุฒ ูู ุฏุฑ ฺฉ ุญููู ุจโูพุงุงู ฺฏุฑ ูโฺฉูุฏ (ุจุง <code>ctrl + c</code> ูโุชูุงูุฏ ุฎุงุฑุฌ ุดูุฏ). ุจุงุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุชูุงุจุน ููุฑุฏ ูุงุฒ ฺฉุชุงุจุฎุงูู ุฏุฑ ุชุณุช ฺฉูพุงุฑฺู ุงู ูุดฺฉู ุฑุง ุจุฑุทุฑู ฺฉูู.</p>
<h3 id="tmm-khrdn-tst-ykhprchh"><a class="zola-anchor" href="index.html#tmm-khrdn-tst-ykhprchh" aria-label="Anchor link for: tmm-khrdn-tst-ykhprchh">๐</a>ุชูุงู ฺฉุฑุฏู ุชุณุช ฺฉูพุงุฑฺู</h3>
<p>ูุงููุฏ <code>src/main.rs</code>ุ ุงุฌุฑุง<code> test/basic_boot.rs</code> ูโุชูุงูุฏ ุงููุงุน ูุฎุชูู ุฑุง ุงุฒ ฺฉุชุงุจุฎุงูู ุฌุฏุฏ ูุง ูุงุฑุฏ ฺฉูุฏ. ฺฉู ุงู ุงูฺฉุงู ุฑุง ุจู ูุง ูโุฏูุฏ ุชุง ุงุฌุฒุง ฺฏูุดุฏู ุฑุง ุจุฑุง ุชฺฉูู ุขุฒูุงุด ูุงุฑุฏ ฺฉูู.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in tests/basic_boot.rs
</span><span>
</span><span>#![test_runner(blog_os::test_runner)]
</span><span>
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    blog_os::test_panic_handler(info)
</span><span>}
</span></code></pre>
<p>ูุง ุจู ุฌุง ูพุงุฏู ุณุงุฒ ูุฌุฏุฏ ุงุฌุฑุง ฺฉููุฏู ุชุณุชุ ุงุฒ ุชุงุจุน <code>test_runner</code> ุฏุฑ ฺฉุชุงุจุฎุงูู ุฎูุฏ ุงุณุชูุงุฏู ูโฺฉูู. ุจุฑุง ุฑุณุฏฺฏ ฺฉููุฏู <code>panic</code>ุ ูุง ุชุงุจุน <code>blog_os::test_panic_handler</code> ุฑุง ูุงููุฏ ุขูโฺู ุฏุฑ <code>main.rs</code> ุงูุฌุงู ุฏุงุฏูุ ูุฑุงุฎูุงู ูโฺฉูู.</p>
<p>ุงฺฉููู <code>cargo test</code> ูุฌุฏุฏุงู ุจู ุทูุฑ ูุนููู ูุฌูุฏ ุฏุงุฑุฏ. ููุช ุขู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ ุ ูโุจูุฏ ฺฉู ุชุณุชโูุง <code>lib.rs</code>ุ <code>main.rs</code> ู <code>basic_boot.rs</code> ูุง ุฑุง ุจู ุทูุฑ ุฌุฏุงฺฏุงูู ู ฺฉ ูพุณ ุงุฒ ุฏฺฏุฑ ุงุฌุงุฏ ู ุงุฌุฑุง ูโฺฉูุฏ. ุจุฑุง ุชุณุชโูุง ฺฉูพุงุฑฺู <code>main.rs</code> ู <code>basic_boot</code>ุ ูุชู โRunning 0 testsโ ุฑุง ูุดุงู ูโุฏูุฏ ุฒุฑุง ุงู ูุงูโูุง ูฺ ุชุงุจุน ุจุง ุญุงุดู ููุณ <code>#[test_case]</code> ูุฏุงุฑุฏ.</p>
<p>ุงฺฉููู ูโุชูุงูู ุชุณุชโูุง ุฑุง ุจู <code>basic_boot.rs</code> ุฎูุฏ ุงุถุงูู ฺฉูู. ุจู ุนููุงู ูุซุงูุ ูุง ูโุชูุงูู ุขุฒูุงุด ฺฉูู ฺฉู <code>println</code> ุจุฏูู ูพูฺฉ ฺฉุงุฑ ูโฺฉูุฏุ ูุงููุฏ ุขูฺู ุฏุฑ ุชุณุชโูุง ุจุงูุฑ vga ุงูุฌุงู ุฏุงุฏู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in tests/basic_boot.rs
</span><span>
</span><span style="color:#569cd6;">use </span><span>blog_os::println;
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println() {
</span><span>    println!(</span><span style="color:#d69d85;">&quot;test_println output&quot;</span><span>);
</span><span>}
</span></code></pre>
<p>ุญุงู ููุช <code>cargo test</code> ุฑุง ุงุฌุฑุง ูโฺฉููุ ูโุจูู ฺฉู ุงู ุชุงุจุน ุชุณุช ุฑุง ูพุฏุง ู ุงุฌุฑุง ูโฺฉูุฏ.</p>
<p>ุงู ุชุณุช ููฺฉู ุงุณุช ุฏุฑ ุญุงู ุญุงุถุฑ ฺฉู ุจโูุงุฏู ุจู ูุธุฑ ุจุฑุณุฏุ ุฒุฑุง ุชูุฑุจุงู ูุดุงุจู ฺฉ ุงุฒ ุชุณุชโูุง ุจุงูุฑ VGA ุงุณุช. ุจุง ุงู ุญุงูุ ุฏุฑ ุขูุฏู ููฺฉู ุงุณุช ุชูุงุจุน <code>_start</code> ูุง ุงุฒ <code>main.rs</code> ู <code>lib.rs</code> ุฑุดุฏ ฺฉุฑุฏู ู ุฑูุงูโูุง ุงููู ูุฎุชูู ุฑุง ูุจู ุงุฒ ุงุฌุฑุง ุชุงุจุน <code>test_main</code> ูุฑุงุฎูุงู ฺฉููุฏุ ุจู ุทูุฑ ฺฉู ุงู ุฏู ุชุณุช ุฏุฑ ูุญุทโูุง ุจุณุงุฑ ูุฎุชูู ุงุฌุฑุง ูโุดููุฏ.</p>
<h3 id="tsthy-ayndh"><a class="zola-anchor" href="index.html#tsthy-ayndh" aria-label="Anchor link for: tsthy-ayndh">๐</a>ุชุณุชโูุง ุขูุฏู</h3>
<p>ูุฏุฑุช ุชุณุชโูุง ฺฉูพุงุฑฺู ุงู ุงุณุช ฺฉู ุจุง ุขูโูุง ุจู ุนููุงู ุงุฌุฑุง ฺฉุงููุงู ุฌุฏุงฺฏุงูู ุจุฑุฎูุฑุฏ ูโุดูุฏ. ุงู ุงูุฑ ุจู ุขูโูุง ุงุฌุงุฒู ฺฉูุชุฑู ฺฉุงูู ุจุฑ ูุญุท ุฑุง ูโุฏูุฏุ ู ุงูฺฉุงู ุชุณุช ฺฉุฑุฏู ุงู ฺฉู ฺฉุฏ ุจู ุฏุฑุณุช ุจุง CPU ุง ุฏุณุชฺฏุงูโูุง ุณุฎุชโุงูุฒุงุฑ ุงุฑุชุจุงุท ุฏุงุฑุฏ ุฑุง ุจู ูุง ูโุฏูุฏ.</p>
<p>ุชุณุช <code>basic_boot</code> ูุง ฺฉ ูุซุงู ุจุณุงุฑ ุณุงุฏู ุจุฑุง ุชุณุช ฺฉูพุงุฑฺู ุงุณุช. ุฏุฑ ุขูุฏูุ ูุณุชู ูุง ูฺฺฏโูุง ุจุณุงุฑ ุจุดุชุฑ ูพุฏุง ูโฺฉูุฏ ู ุงุฒ ุฑุงูโูุง ูุฎุชูู ุจุง ุณุฎุช ุงูุฒุงุฑ ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ูโฺฉูุฏ. ุจุง ุงูุฒูุฏู ุชุณุช ูุง ฺฉูพุงุฑฺูุ ูโุชูุงูู ุงุทููุงู ุญุงุตู ฺฉูู ฺฉู ุงู ุชุนุงููุงุช ูุทุงุจู ุงูุชุธุงุฑ ฺฉุงุฑ ูโฺฉููุฏ (ู ุจู ฺฉุงุฑ ุฎูุฏ ุงุฏุงูู ูโุฏููุฏ). ุจุฑุฎ ุงุฒ ุงุฏูโูุง ุจุฑุง ุชุณุชโูุง ุงุญุชูุงู ุฏุฑ ุขูุฏู ุนุจุงุฑุชูุฏ ุงุฒ:</p>
<ul>
<li>
<p><strong>ุงุณุชุซูุงุฆุงุช CPU</strong>: ููฺฏุงู ฺฉู ุงู ฺฉุฏ ุนููุงุช ูุงูุนุชุจุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏ (ุจู ุนููุงู ูุซุงู ุชูุณู ุจุฑ ุตูุฑ)ุ CPU ฺฉ ุงุณุชุซูุง ุฑุง ุงุฑุงุฆู ูโุฏูุฏ. ูุณุชู ูโุชูุงูุฏ ุชูุงุจุน ุฑุณุฏฺฏ ฺฉููุฏู ุฑุง ุจุฑุง ฺูู ููุงุฑุฏ ุซุจุช ฺฉูุฏ. ฺฉ ุชุณุช ฺฉูพุงุฑฺู ูโุชูุงูุฏ ุชุฃุฏ ฺฉูุฏ ฺฉู ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุงุณุชุซูุง ูพุฑุฏุงุฒูุฏู ุ ุฑุณุฏฺฏ ฺฉููุฏู ุงุณุชุซูุง ุตุญุญ ูุฑุงุฎูุงู ูโุดูุฏ ุง ุงุฌุฑุง ุขู ูพุณ ุงุฒ ุงุณุชุซูุงูุง ูุงุจู ุญู ุจู ุฏุฑุณุช ุงุฏุงูู ุฏุงุฑุฏ.</p>
</li>
<li>
<p><strong>ุฌุฏููโูุง ุตูุญู</strong>: ุฌุฏููโูุง ุตูุญู ูุดุฎุต ูโฺฉูุฏ ฺฉู ฺฉุฏุงู ููุงุทู ุญุงูุธู ูุนุชุจุฑ ู ูุงุจู ุฏุณุชุฑุณ ูุณุชูุฏ. ุจุง ุงุตูุงุญ ุฌุฏููโูุง ุตูุญูุ ูโุชูุงู ููุงุทู ุญุงูุธู ุฌุฏุฏ ุฑุง ุงุฎุชุตุงุต ุฏุงุฏุ ุจู ุนููุงู ูุซุงู ููฺฏุงู ุฑุงูโุงูุฏุงุฒ ุจุฑูุงููโูุง. ฺฉ ุชุณุช ฺฉูพุงุฑฺู ูโุชูุงูุฏ ุจุฑุฎ ุงุฒ ุชุบุฑุงุช ุฌุฏููโูุง ุตูุญู ุฑุง ุฏุฑ ุชุงุจุน <code>_start</code> ุงูุฌุงู ุฏูุฏ ู ุณูพุณ ุชุฃุฏ ฺฉูุฏ ฺฉู ุงู ุชุบุฑุงุช ุฏุฑ ุชุงุจุนโูุง <code># [test_case]</code> ุงุซุฑุงุช ูุทููุจ ุฏุงุฑูุฏ.</p>
</li>
<li>
<p><strong>ุจุฑูุงููโูุง ูุถุง ฺฉุงุฑุจุฑ</strong>: ุจุฑูุงููโูุง ูุถุง ฺฉุงุฑุจุฑ ุจุฑูุงููโูุง ุจุง ุฏุณุชุฑุณ ูุญุฏูุฏ ุจู ููุงุจุน ุณุณุชู ูุณุชูุฏ. ุจู ุนููุงู ูุซุงูุ ุขููุง ุจู ุณุงุฎุชุงุฑ ุฏุงุฏูโูุง ูุณุชู ุง ุญุงูุธู ุจุฑูุงููโูุง ุฏฺฏุฑ ุฏุณุชุฑุณ ูุฏุงุฑูุฏ. ฺฉ ุชุณุช ฺฉูพุงุฑฺู ูโุชูุงูุฏ ุจุฑูุงููโูุง ูุถุง ฺฉุงุฑุจุฑ ุฑุง ฺฉู ุนููุงุชโูุง ููููุนู ุฑุง ุงูุฌุงู ูโุฏููุฏ ุฑุงูโุงูุฏุงุฒ ฺฉุฑุฏู ู ุจุฑุฑุณ ฺฉูุฏ ูุณุชู ุงุฒ ููู ุขูโูุง ุฌููฺฏุฑ ูโฺฉูุฏ.</p>
</li>
</ul>
<p>ููุงูุทูุฑ ฺฉู ูโุชูุงูุฏ ุชุตูุฑ ฺฉูุฏุ ุชุณุชโูุง ุจุดุชุฑ ุงูฺฉุงู ูพุฐุฑ ุงุณุช. ุจุง ุงูุฒูุฏู ฺูู ุชุณุชโูุงุ ูโุชูุงูู ุงุทููุงู ุญุงุตู ฺฉูู ฺฉู ููุช ูฺฺฏโูุง ุฌุฏุฏ ุจู ูุณุชู ุฎูุฏ ุงุถุงูู ูโฺฉูู ุง ฺฉุฏ ุฎูุฏ ุฑุง ุฏูุจุงุฑู ูโุณุงุฒูุ ุขูโูุง ุฑุง ุจู ุทูุฑ ุชุตุงุฏู ุฎุฑุงุจ ููโฺฉูู. ุงู ุงูุฑ ุจู ูฺู ููฺฏุงู ูููโุชุฑ ูโุดูุฏ ฺฉู ูุณุชู ูุง ุจุฒุฑฺฏุชุฑ ู ูพฺุฏูโุชุฑ ุดูุฏ.</p>
<h3 id="tsthyy-khh-byd-pnykh-khnnd"><a class="zola-anchor" href="index.html#tsthyy-khh-byd-pnykh-khnnd" aria-label="Anchor link for: tsthyy-khh-byd-pnykh-khnnd">๐</a>ุชุณุชโูุง ฺฉู ุจุงุฏ ูพูฺฉ ฺฉููุฏ</h3>
<p>ูุฑูโูุฑฺฉ ุชุณุช ฺฉุชุงุจุฎุงูู ุงุณุชุงูุฏุงุฑุฏ ุงุฒ <a href="https://doc.rust-lang.org/rust-by-example/testing/unit_testing.html#testing-panics">ุตูุช <code>#[should_panic]</code></a> ูพุดุชุจุงู ูโฺฉูุฏ ฺฉู ุงุฌุงุฒู ูโุฏูุฏ ุชุณุชโูุง ุฑุง ุจุณุงุฒุฏ ฺฉู ุจุงุฏ ูุงูููู ุดููุฏ (ุจุงุฏ ูพูฺฉ ฺฉููุฏ). ุงู ููุฏ ุงุณุชุ ุจู ุนููุงู ูุซุงู ุจุฑุง ุชุฃุฏ ูพูฺฉ ฺฉุฑุฏู ฺฉ ุชุงุจุน ููฺฏุงู ุนุจูุฑ ุฏุงุฏู ฺฉ ุขุฑฺฏููุงู ูุงูุนุชุจุฑ ุจู ุขู. ูุชุฃุณูุงูู ุงู ูฺฺฏ ุฏุฑ ฺฉุฑุชโูุง <code>#[no_std]</code> ูพุดุชุจุงู ููโุดูุฏ ุฒุฑุง ุจู ูพุดุชุจุงู ุงุฒ ฺฉุชุงุจุฎุงูู ุงุณุชุงูุฏุงุฑุฏ ูุงุฒ ุฏุงุฑุฏ.</p>
<p>ุงฺฏุฑฺู ููโุชูุงูู ุงุฒ ุตูุช <code>#[should_panic]</code> ุฏุฑ ูุณุชู ุฎูุฏ ุงุณุชูุงุฏู ฺฉููุ ุงูุง ูโุชูุงูู ุจุง ุงุฌุงุฏ ฺฉ ุชุณุช ฺฉูพุงุฑฺู ฺฉู ุจุง ฺฉุฏ ุฎุทุง ููููุช ุขูุฒ ุงุฒ ุฑุณุฏฺฏ ฺฉููุฏู ูพูฺฉ ุฎุงุฑุฌ ูโุดูุฏุ ุฑูุชุงุฑ ูุดุงุจู ุฏุงุดุชู ุจุงุดู. ุจุงุฏ ุดุฑูุน ุจู ุงุฌุงุฏ ฺูู ุชุณุช ุจุง ูุงู <code>should_panic</code> ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in tests/should_panic.rs
</span><span>
</span><span>#![no_std]
</span><span>#![no_main]
</span><span>
</span><span style="color:#569cd6;">use </span><span>core::panic::PanicInfo;
</span><span style="color:#569cd6;">use </span><span>blog_os::{QemuExitCode, exit_qemu, serial_println};
</span><span>
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(_info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[ok]&quot;</span><span>);
</span><span>    exit_qemu(QemuExitCode::Success);
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span></code></pre>
<p>ุงู ุชุณุช ูููุฒ ูุงูุต ุงุณุช ุฒุฑุง ูููุฒ ุชุงุจุน <code>_start</code> ุง ูฺ ฺฉ ุงุฒ ุตูุชโูุง ุงุฌุฑุง ฺฉููุฏู ุชุณุช ุณูุงุฑุด ุฑุง ูุดุฎุต ูฺฉุฑุฏู. ุจุงุฏ ูุณูุชโูุง ฺฏูุดุฏู ุฑุง ุงุถุงูู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in tests/should_panic.rs
</span><span>
</span><span>#![feature(custom_test_frameworks)]
</span><span>#![test_runner(test_runner)]
</span><span>#![reexport_test_harness_main </span><span style="color:#569cd6;">= </span><span style="color:#d69d85;">&quot;test_main&quot;</span><span>]
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    test_main();
</span><span>
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>test_runner(tests: </span><span style="color:#569cd6;">&amp;</span><span>[</span><span style="color:#569cd6;">&amp;</span><span>dyn Fn()]) {
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Running {} tests&quot;</span><span>, tests.len());
</span><span>    </span><span style="color:#569cd6;">for</span><span> test </span><span style="color:#569cd6;">in</span><span> tests {
</span><span>        test();
</span><span>        serial_println!(</span><span style="color:#d69d85;">&quot;[test did not panic]&quot;</span><span>);
</span><span>        exit_qemu(QemuExitCode::Failed);
</span><span>    }
</span><span>    exit_qemu(QemuExitCode::Success);
</span><span>}
</span></code></pre>
<p>ุจู ุฌุง ุงุณุชูุงุฏู ูุฌุฏุฏ ุงุฒ <code>test_runner</code> ุงุฒ <code>lib.rs</code>ุ ุชุณุช ุชุงุจุน <code>test_runner</code> ุฎูุฏ ุฑุง ุชุนุฑู ูโฺฉูุฏ ฺฉู ููฺฏุงู ุจุงุฒฺฏุดุช ฺฉ ุชุณุช ุจุฏูู ูพูฺฉ ุจุง ฺฉ ฺฉุฏ ุฎุฑูุฌ ุฎุทุง ุฎุงุฑุฌ ูโุดูุฏ (ูุง ูโุฎูุงูู ุชุณุชโูุงูุงู ูพูฺฉ ุฏุงุดุชู ุจุงุดูุฏ). ุงฺฏุฑ ูฺ ุชุงุจุน ุชุณุช ุชุนุฑู ูุดุฏู ุจุงุดุฏุ ุงุฌุฑุง ฺฉููุฏู ุจุง ฺฉุฏ ุฎุทุง ููููุช ุฎุงุฑุฌ ูโุดูุฏ. ุงุฒ ุขูโุฌุง ฺฉู ุงุฌุฑุง ฺฉููุฏู ููุดู ูพุณ ุงุฒ ุงุฌุฑุง ฺฉ ุชุณุช ุฎุงุฑุฌ ูโุดูุฏุ ููุทู ูุณุช ฺฉู ุจุด ุงุฒ ฺฉ ุชุงุจุน <code>#[test_case]</code> ุชุนุฑู ุดูุฏ.</p>
<p>ุงฺฉููู ูโุชูุงูู ฺฉ ุชุณุช ุงุฌุงุฏ ฺฉูู ฺฉู ุจุงุฏ ุดฺฉุณุช ุจุฎูุฑุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in tests/should_panic.rs
</span><span>
</span><span style="color:#569cd6;">use </span><span>blog_os::serial_print;
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>should_fail() {
</span><span>    serial_print!(</span><span style="color:#d69d85;">&quot;should_panic::should_fail...</span><span style="color:#e3bbab;">\t</span><span style="color:#d69d85;">&quot;</span><span>);
</span><span>    assert_eq!(</span><span style="color:#b5cea8;">0</span><span>, </span><span style="color:#b5cea8;">1</span><span>);
</span><span>}
</span></code></pre>
<p>ุงู ุชุณุช ุจุง ุงุณุชูุงุฏู ุงุฒ <code>assert_eq</code> ุงุฏุนุง (ุชุฑุฌูู: assert) ูโฺฉูุฏ ฺฉู <code>0</code> ู <code>1</code> ุจุฑุงุจุฑ ูุณุชูุฏ. ุงู ุงูุจุชู ูุงูููู ุงุณุชุ ุจู ุทูุฑ ฺฉู ุชุณุช ูุง ูุทุงุจู ุฏูุฎูุงู ูพูฺฉ ูโฺฉูุฏ. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูุง ุจุงุฏ ูุงู ุชุงุจุน ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ <code>serial_print!</code> ุฏุฑ ุงูุฌุง ฺุงูพ ุฏุณุช ฺฉูู ุฒุฑุง ุงุฒ ุชุฑุช <code>Testable</code> ุงุณุชูุงุฏู ููโฺฉูู.</p>
<p>ููฺฏุงู ฺฉู ูุง ุชุณุช ุฑุง ุงุฒ ุทุฑู <code>cargo test --test should_panic</code> ุงูุฌุงู ุฏููุ ูโุจูู ฺฉู ููููุช ุขูุฒ ุงุณุช ุฒุฑุง ุชุณุช ูุทุงุจู ุงูุชุธุงุฑ ูพูฺฉ ฺฉุฑุฏ. ููุช ุงุฏุนุง ุฑุง ฺฉุงููุช ฺฉูู ู ุชุณุช ุฑุง ุฏูุจุงุฑู ุงุฌุฑุง ฺฉููุ ูโุจูู ฺฉู ุจุง ูพุงู <em>โtest did not panicโ</em> ุจุง ุดฺฉุณุช ููุงุฌู ูโุดูุฏ.</p>
<p>ฺฉ ุงุดฺฉุงู ูุงุจู ุชูุฌู ุฏุฑ ุงู ุฑูุด ุงู ุงุณุช ฺฉู ุงู ุฑูุด ููุท ุจุฑุง ฺฉ ุชุงุจุน ุชุณุช ฺฉุงุฑ ูโฺฉูุฏ. ุจุง ฺูุฏู ุชุงุจุน <code>#[test_case]</code>ุ ููุท ุงููู ุชุงุจุน ุงุฌุฑุง ูโุดูุฏ ุฒุฑุง ูพุณ ุงูโฺฉู ุฑุณุฏฺฏ ฺฉููุฏู ูพูฺฉ ูุฑุงุฎูุงู ุดุฏุ ุงุฌุฑุง ุชูุงู ูโุดูุฏ. ูู ุฏุฑ ุญุงู ุญุงุถุฑ ุฑุงู ุฎูุจ ุจุฑุง ุญู ุงู ูุดฺฉู ููโุฏุงููุ ุจูุงุจุฑุงู ุงฺฏุฑ ุงุฏูโุง ุฏุงุฑุฏ ุจู ูู ุงุทูุงุน ุฏูุฏ!</p>
<h3 id="tst-hy-bdwn-mhr"><a class="zola-anchor" href="index.html#tst-hy-bdwn-mhr" aria-label="Anchor link for: tst-hy-bdwn-mhr">๐</a>ุชุณุช ูุง ุจุฏูู ููุงุฑ</h3>
<p>ุจุฑุง ุชุณุชโูุง ฺฉูพุงุฑฺู ฺฉู ููุท ฺฉ ุชุงุจุน ุชุณุช ุฏุงุฑูุฏ (ูุงููุฏ ุชุณุช <code>should_panic</code> ูุง)ุ ุงุฌุฑุง ฺฉููุฏู ุชุณุช ููุฑุฏ ูุงุฒ ูุณุช. ุจุฑุง ููุงุฑุฏ ุงุฒ ุงู ุฏุณุชุ ูุง ูโุชูุงูู ุงุฌุฑุง ฺฉููุฏู ุชุณุช ุฑุง ุจู ุทูุฑ ฺฉุงูู ุบุฑูุนุงู ฺฉูู ู ุชุณุช ุฎูุฏ ุฑุง ูุณุชููุงู ุฏุฑ ุชุงุจุน <code>_start</code> ุงุฌุฑุง ฺฉูู.</p>
<p>ฺฉูุฏ ุงู ฺฉุงุฑ ุบุฑูุนุงู ฺฉุฑุฏู ูพุฑฺู <code>harness</code> ุจุฑุง ุชุณุช ุฏุฑ<code> Cargo.toml</code> ุงุณุชุ ฺฉู ูุดุฎุต ูโฺฉูุฏ ุขุง ุงุฒ ฺฉ ุงุฌุฑุง ฺฉููุฏู ุชุณุช ุจุฑุง ุชุณุช ฺฉูพุงุฑฺู ุงุณุชูุงุฏู ูโุดูุฏ. ููุช ุฑู <code>false</code> ุชูุธู ุดูุฏุ ูุฑ ุฏู ุงุฌุฑุง ฺฉฺฉูุฏู ุชุณุช ูพุด ูุฑุถ ู ุณูุงุฑุด ุบุฑูุนุงู ูโุดููุฏุ ุจูุงุจุฑุงู ุจุง ุชุณุช ูุงููุฏ ฺฉ ุงุฌุฑุง ูุนููู ุฑูุชุงุฑ ูโุดูุฏ.</p>
<p>ุจุงุฏ ูพุฑฺู <code>harness</code> ุฑุง ุจุฑุง ุชุณุช <code>should_panic</code> ุฎูุฏ ุบุฑูุนุงู ฺฉูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[[</span><span style="color:#808080;">test</span><span>]]
</span><span style="color:#569cd6;">name </span><span>= </span><span style="color:#d69d85;">&quot;should_panic&quot;
</span><span style="color:#569cd6;">harness </span><span>= </span><span style="color:#569cd6;">false
</span></code></pre>
<p>ุงฺฉููู ูุง ุจุง ุญุฐู ฺฉุฏ ูุฑุจูุท ุจู ุขุงุฌุฑุง ฺฉููุฏู ุชุณุชุ ุชุณุช <code>should_panic</code> ุฎูุฏ ุฑุง ุจุณุงุฑ ุณุงุฏู ฺฉุฑุฏู. ูุชุฌู ุจู ุงู ุดฺฉู ุงุณุช:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in tests/should_panic.rs
</span><span>
</span><span>#![no_std]
</span><span>#![no_main]
</span><span>
</span><span style="color:#569cd6;">use </span><span>core::panic::PanicInfo;
</span><span style="color:#569cd6;">use </span><span>blog_os::{exit_qemu, serial_print, serial_println, QemuExitCode};
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    should_fail();
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[test did not panic]&quot;</span><span>);
</span><span>    exit_qemu(QemuExitCode::Failed);
</span><span>    </span><span style="color:#569cd6;">loop</span><span>{}
</span><span>}
</span><span>
</span><span style="color:#569cd6;">fn </span><span>should_fail() {
</span><span>    serial_print!(</span><span style="color:#d69d85;">&quot;should_panic::should_fail...</span><span style="color:#e3bbab;">\t</span><span style="color:#d69d85;">&quot;</span><span>);
</span><span>    assert_eq!(</span><span style="color:#b5cea8;">0</span><span>, </span><span style="color:#b5cea8;">1</span><span>);
</span><span>}
</span><span>
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(_info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[ok]&quot;</span><span>);
</span><span>    exit_qemu(QemuExitCode::Success);
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{}
</span><span>}
</span></code></pre>
<p>ุงฺฉููู ุชุงุจุน <code>should_fail</code> ุฑุง ูุณุชููุงู ุงุฒ ุชุงุจุน <code>_start</code> ุฎูุฏ ูุฑุงุฎูุงู ูโฺฉูู ู ุฏุฑ ุตูุฑุช ุจุงุฒฺฏุดุช ุจุง ฺฉุฏ ุฎุฑูุฌ ุดฺฉุณุช ุฎุงุฑุฌ ูโุดูู. ุงฺฉููู ููุช <code>cargo test --test should_panic</code> ุฑุง ุงุฌุฑุง ูโฺฉููุ ูโุจูู ฺฉู ุชุณุช ุฏููุงู ูุงููุฏ ูุจู ุนูู ูโฺฉูุฏ.</p>
<p>ุบุฑ ุงุฒ ุงุฌุงุฏ ุชุณุชโูุง <code>should_panic</code>ุ ุบุฑูุนุงู ฺฉุฑุฏู ุตูุช <code>harness</code> ููฺูู ูโุชูุงูุฏ ุจุฑุง ุชุณุชโูุง ฺฉูพุงุฑฺู ูพฺุฏู ููุฏ ุจุงุดุฏุ ุจู ุนููุงู ูุซุงู ููฺฏุงู ฺฉู ุชุงุจุนโูุง ูููุฑุฏ ุฏุงุฑุง ุนูุงุฑุถ ุฌุงูุจ ูุณุชูุฏ ู ุจุงุฏ ุจู ุชุฑุชุจ ูุดุฎุต ุงุฌุฑุง ุดููุฏ.</p>
<h2 id="khlsh"><a class="zola-anchor" href="index.html#khlsh" aria-label="Anchor link for: khlsh">๐</a>ุฎูุงุตู</h2>
<p>ุชุณุช ฺฉุฑุฏู ฺฉ ุชฺฉูฺฉ ุจุณุงุฑ ููุฏ ุงุณุช ุชุง ุงุทููุงู ุญุงุตู ุดูุฏ ฺฉู ุงุฌุฒุง ุฎุงุต ุฑูุชุงุฑ ูุทููุจ ุฏุงุฑูุฏ. ุญุช ุงฺฏุฑ ุขูโูุง ูุชูุงููุฏ ููุฏุงู ุงุดฺฉุงูุงุช ุฑุง ูุดุงู ุฏููุฏุ ุขูโูุง ูููุฒ ูู ฺฉ ุงุจุฒุงุฑ ููุฏ ุจุฑุง ุงูุชู ุขูโูุง ู ุจู ูฺู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุฏูุจุงุฑู ฺฉุงุฑ ู ูพุณุฑูุช ูุณุชูุฏ.</p>
<p>ุฏุฑ ุงู ูพุณุช ูุญูู ุชูุธู ูุฑูโูุฑฺฉ ุชุณุช ุจุฑุง ูุณุชู Rust ูุง ุชูุถุญ ุฏุงุฏู ุดุฏู ุงุณุช. ูุง ุงุฒ ูฺฺฏ ูุฑูโูุฑฺฉ ุชุณุช ุณูุงุฑุด Rust ุจุฑุง ูพุงุฏู ุณุงุฒ ูพุดุชุจุงู ุงุฒ ฺฉ ุตูุช ุณุงุฏู <code>#[test_case]</code> ุฏุฑ ูุญุท bare-metal ุฎูุฏ ุงุณุชูุงุฏู ฺฉุฑุฏู. ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชฺฏุงู <code>isa-debug-exit</code> ุดุจูโุณุงุฒ ูุงุดู ู ูุฌุงุฒโุณุงุฒ QEMUุ ุงุฌุฑุง ฺฉููุฏู ุชุณุช ูุง ูโุชูุงูุฏ ูพุณ ุงุฒ ุงุฌุฑุง ุชุณุชโูุง ุงุฒ QEMU ุฎุงุฑุฌ ุดุฏู ู ูุถุนุช ุชุณุช ุฑุง ฺฏุฒุงุฑุด ุฏูุฏ. ุจุฑุง ฺุงูพ ูพุงูโูุง ุฎุทุง ุจู ุฌุง ุจุงูุฑ VGA ุฏุฑ ฺฉูุณููุ ฺฉ ุฏุฑุงูุฑ ุงุณุงุณ ุจุฑุง ูพูุฑุช ุณุฑุงู ุงุฌุงุฏ ฺฉุฑุฏู.</p>
<p>ูพุณ ุงุฒ ุงุฌุงุฏ ฺูุฏ ุชุณุช ุจุฑุง ูุงฺฉุฑู <code>println</code>ุ ุฏุฑ ููู ุฏูู ูพุณุช ุจู ุจุฑุฑุณ ุชุณุชโูุง ฺฉูพุงุฑฺู ูพุฑุฏุงุฎุชู. ูุง ูููุฏู ฺฉู ุขูโูุง ุฏุฑ ุฏุงุฑฺฉุชูุฑ <code>tests</code> ูุฑุงุฑ ูโฺฏุฑูุฏ ู ุจู ุนููุงู ุงุฌุฑุง ฺฉุงููุงู ูุณุชูู ุจุง ุขูโูุง ุฑูุชุงุฑ ูโุดูุฏ. ุจุฑุง ุฏุณุชุฑุณ ุฏุงุฏู ุจู ุขูโูุง ุจู ุชุงุจุน <code>exit_qemu</code> ู ูุงฺฉุฑู <code>serial_println</code>ุ ุจุดุชุฑ ฺฉุฏูุง ุฎูุฏ ุฑุง ุจู ฺฉ ฺฉุชุงุจุฎุงูู ููุชูู ฺฉุฑุฏู ฺฉู ูโุชูุงูุฏ ุชูุณุท ููู ุงุฌุฑุงูุง ู ุชุณุชโูุง ฺฉูพุงุฑฺู ูุงุฑุฏ (import) ุดูุฏ. ุงุฒ ุขูโุฌุง ฺฉู ุชุณุชโูุง ฺฉูพุงุฑฺู ุฏุฑ ูุญุท ุฌุฏุงฺฏุงูู ุฎูุฏ ุงุฌุฑุง ูโุดููุฏุ ุขูโูุง ุชุณุช ุชุนุงููุงุช ุจุง ุณุฎุชโุงูุฒุงุฑ ุง ุงุฌุงุฏ ุชุณุชโูุง ฺฉู ุจุงุฏ ูพูฺฉ ฺฉููุฏ ุฑุง ุงูฺฉุงู ูพุฐุฑ ู ฺฉููุฏ.</p>
<p>ุงฺฉููู ฺฉ ูุฑูโูุฑฺฉ ุชุณุช ุฏุงุฑู ฺฉู ุฏุฑ ฺฉ ูุญุท ูุงูุน ฺฏุฑุงุงูู ุฏุฑ ุฏุงุฎู QEMU ุงุฌุฑุง ูโุดูุฏ. ุจุง ุงุฌุงุฏ ุชุณุชโูุง ุจุดุชุฑ ุฏุฑ ูพุณุชโูุง ุจุนุฏุ ูโุชูุงูู ูุณุชู ุฎูุฏ ุฑุง ููฺฏุงู ฺฉู ูพฺุฏูโุชุฑ ุดูุฏุ ูฺฏูุฏุงุฑ ฺฉูู.</p>
<h2 id="mrhlh-b-dy-chyst"><a class="zola-anchor" href="index.html#mrhlh-b-dy-chyst" aria-label="Anchor link for: mrhlh-b-dy-chyst">๐</a>ูุฑุญูู ุจุนุฏ ฺุณุชุ</h2>
<p>ุฏุฑ ูพุณุช ุจุนุฏุ ูุง <em>ุงุณุชุซูุงุฆุงุช CPU</em> ุฑุง ุจุฑุฑุณ ุฎูุงูู ฺฉุฑุฏ. ุงู ููุงุฑุฏ ุงุณุชุซูุง ุชูุณุท CPU ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุฑฺฏููู ุงุชูุงู ุบุฑูุงูููุ ูุงููุฏ ุชูุณู ุจุฑ ุตูุฑ ุง ุฏุณุชุฑุณ ุจู ุตูุญู ุญุงูุธู ููพ ูุดุฏู (ุงุตุทูุงุญุงู โุฎุทุง ุตูุญูโ)ุ ุฑุฎ ูโุฏูุฏ. ุงูฺฉุงู ฺฉุดู ู ุจุฑุฑุณ ุงู ููุงุฑุฏ ุงุณุชุซูุง ุจุฑุง ุฑูุน ุงุดฺฉุงู ุฏุฑ ุฎุทุงูุง ุขูุฏู ุจุณุงุฑ ููู ุงุณุช. ุฑุณุฏฺฏ ุจู ุงุณุชุซูุงูุง ูุฒ ุจุณุงุฑ ุดุจู ุฑุณุฏฺฏ ุจู ููููโูุง ุณุฎุชโุงูุฒุงุฑ ุงุณุชุ ฺฉู ุจุฑุง ูพุดุชุจุงู ุตูุญู ฺฉูุฏ ููุฑุฏ ูุงุฒ ุงุณุช.</p>

    </div>

    <div class="post-footer-support right-to-left">
        <h2>Support Me</h2>
        
<p>
    Creating and <a href="../../status-update/index.html">maintaining</a> this blog and the associated libraries is a lot of work, but I really enjoy doing it. By supporting me, you allow me to invest more time in new content, new features, and continuous maintenance.
</p>
<p>
    The best way to support me is to <a href="https://github.com/sponsors/phil-opp"><em>sponsor me on GitHub</em></a>, since they don't charge any fees. If you prefer other platforms, I also have <a href="https://www.patreon.com/phil_opp"><em>Patreon</em></a> and <a href="https://donorbox.org/phil-opp"><em>Donorbox</em></a> accounts. The latter is the most flexible as it supports multiple currencies and one-time contributions.
</p>
<p>
    Thank you!
</p>

    </div>

    <hr>
    <div class="PageNavigation">
        
            <a class="prev" href="../vga-text-mode/index.html">&laquo; ุญุงูุช ูุชู VGA</a>
        
        
            <a class="next" href="../cpu-exceptions/index.html">ุงุณุชุซูุงูุง ูพุฑุฏุงุฒูุฏู &raquo;</a>
        
    </div>

    <hr>
    <section>
        <h2 id="comments" class="right-to-left">ูุธุฑุงุช</h2>

        
            
            
            
        
        
    
        
        
    

    
        
        
    

    <p class="comment-note">
        Do you have a problem, want to share feedback, or discuss further ideas? Feel free to leave a comment here! Please stick to English and follow Rust's <a href="https://www.rust-lang.org/policies/code-of-conduct">code of conduct</a>. This comment thread directly maps to a <a href="https://github.com/phil-opp/blog_os/discussions/categories/post-comments-translated?discussions_q=%22Testing%20%28fa%29%22"><em>discussion on GitHub</em></a>, so you can also comment there if you prefer.
    </p>

    <div class="giscus"></div>

    <script src="https://giscus.app/client.js"
        data-repo="phil-opp/blog_os"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzOTU3NTEwMQ=="
        data-category="Post Comments (translated)"
        data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDE4OTg1"
    
        data-mapping="specific"
    
        data-term="Testing (fa)"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-theme="preferred_color_scheme"
        data-lang="fa"
        crossorigin="anonymous"
        async>
    </script>

    <p class="comment-directly-on-github">
        Instead of authenticating the <a href="https://giscus.app">giscus</a> application, you can also comment directly <a href="https://github.com/phil-opp/blog_os/discussions/categories/post-comments-translated?discussions_q=%22Testing%20%28fa%29%22"><em>on GitHub</em></a>.
    </p>

        <p class="right-to-left">
            ูุทูุง ูุธุฑุงุช ุฎูุฏ ุฑุง ุฏุฑ ุตูุฑุช ุงูฺฉุงู ุจู ุงูฺฏูุณ ุจููุณุฏ.
        </p>
        
    </section>

    <aside class="page-aside-right">
        <div class="block" id="language-selector">
            <h2>Other Languages</h2>
            
            <ul><li data-lang-switch-to="en" class=""><a href="../../testing/index.html">
                        English (original)
                    </a></li><li data-lang-switch-to="zh-CN" class=""><a href="../../zh-CN/testing/index.html">
                        Chinese (simplified)
                    </a></li><li data-lang-switch-to="ja" class=""><a href="../../ja/testing/index.html">
                        Japanese
                    </a></li><li data-lang-switch-to="ko" class=""><a href="../../ko/testing/index.html">
                        Korean
                    </a></li></ul>
        </div>
    </aside>

</main>
        </div>

        <div></div>

        <footer class="footer">
            <hr>
            <small>
                &copy; <time datetime="2022">2022</time>. All rights reserved.
                <a class="spaced" href="https://github.com/phil-opp/blog_os#license">License</a>
                <a class="spaced" href="../../contact/index.html">Contact</a>
            </small>
        </footer>
    </div>
</body>

</html>
