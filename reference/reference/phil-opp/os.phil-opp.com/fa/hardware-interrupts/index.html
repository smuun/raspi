<!doctype html>

<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <meta name="description" content="ุฏุฑ ุงู ูพุณุช ูุง ฺฉูุชุฑู ฺฉููุฏู ูุงุจู ุจุฑูุงูู ุฑุฒ ูููู ุฑุง ุชูุธู ู ฺฉูู ุชุง ูููู ูุง ุณุฎุช ุงูุฒุงุฑ ุฑุง ุจู ุฏุฑุณุช ุจู ูพุฑุฏุงุฒูุฏู ููุชูู ฺฉูุฏ. ุจุฑุง ูุฏุฑุช ุงู ููููโูุง ุ ููโฆ">
    <meta name="author" content="Philipp Oppermann">

    
        <link rel="canonical" href="index.html" />
    
    <link href="../../css/edition-2/main.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="RSS feed for os.phil-opp.com" href="../../rss.xml" />

    <script>
        let theme = localStorage.getItem("theme");
        if (theme != null) {
            document.documentElement.setAttribute("data-theme", theme);
        }
    </script>

    <script async src="../../js/edition-2/main.js"></script>

    <title>ููููโูุง ุณุฎุชโุงูุฒุงุฑ | Writing an OS in Rust</title>
</head>

<body>
    <div class="container content">
        <header class="masthead">
            <div style="position:relative">
                <h2 class="masthead-title">
                    <a href="../../index.html" title="Home">Writing an OS in Rust</a>
                </h2>
                <p><small>Philipp&nbsp;Oppermann's&nbsp;blog</small></p>
                
    <aside id="all-posts-link"><a href="https://os.phil-opp.com/fa" title="All Posts">ยซ ููู ูพุณุชโูุง</a></aside>

            </div>
        </header>

        <div class="theme-switch">
            <div class="light-switch" onclick="toggle_lights()" title="Switch between light and dark theme"></div>
            <div class="light-switch-reset" onclick="clear_theme_override()" title="Clear the theme override and go back to the system theme"></div>
        </div>

        <div>
            
<aside id="toc-aside" class="right-to-left">
        <h2>ููุฑุณุช ูุทุงูุจ</h2>
    <ol>
        <li>
            <a href="index.html#mqdmh">ููุฏูู</a>
            
        </li><li>
            <a href="index.html#the-8259-pic">The 8259 PIC</a>
            <ol>
                <li>
                    <a href="index.html#pydh-szy">ูพุงุฏู ุณุงุฒ</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#f-lszy-wqfhh">ูุนุงูโุณุงุฒ ููููโูุง</a>
            
        </li><li>
            <a href="index.html#mdyryt-wqfhhy-tymr">ูุฏุฑุช ููููโูุง ุชุงูุฑ</a>
            <ol>
                <li>
                    <a href="index.html#pyn-wqfh">ูพุงุงู ูููู</a>
                </li><li>
                    <a href="index.html#pykhrbndy-tymr">ูพฺฉุฑุจูุฏ ุชุงูุฑ</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#bnbst-h">ุจูโุจุณุช ูุง</a>
            <ol>
                <li>
                    <a href="index.html#yjd-bnbst">ุงุฌุงุฏ ุจูโุจุณุช</a>
                </li><li>
                    <a href="index.html#rf-bnbst">ุฑูุน ุจูโุจุณุช</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#rf-wd-yt-rqbty">ุฑูุน ูุถุนุช ุฑูุงุจุช</a>
            
        </li><li>
            <a href="index.html#dstwrl-ml-hlt">ุฏุณุชูุฑุงูุนูู hlt</a>
            
        </li><li>
            <a href="index.html#wrwdy-sfhh-khlyd">ูุฑูุฏ ุตูุญู ฺฉูุฏ</a>
            <ol>
                <li>
                    <a href="index.html#khwndn-skhnkhd-h">ุฎูุงูุฏู ุงุณฺฉูโฺฉุฏ ูุง</a>
                </li><li>
                    <a href="index.html#tfsyr-skhnkhd-h">ุชูุณุฑ ุงุณฺฉูโฺฉุฏ ูุง</a>
                </li><li>
                    <a href="index.html#pykhrbndy-sfhh-khlyd">ูพฺฉุฑุจูุฏ ุตูุญู ฺฉูุฏ</a>
                </li>
            </ol>
        </li><li>
            <a href="index.html#khlsh">ุฎูุงุตู</a>
            
        </li><li>
            <a href="index.html#mrhlh-b-dy-chyst">ูุฑุญูู ุจุนุฏ ฺุณุชุ</a>
            
        </li>
        <li class="toc-comments-link"><a href="index.html#comments">ูุธุฑุงุช</a></li>
    </ol>
</aside>

            <main>
    <div class="right-to-left">
    <h1>ููููโูุง ุณุฎุชโุงูุฒุงุฑ</h1>
    <time datetime="2018-10-22" class="post-date">
        Oct 22, 2018
        
    </time>
    </div>

    
        <div class="warning right-to-left">
            
            
            <p>
            <b>ูุญุชูุง ุชุฑุฌูู ุดุฏู:</b>
            ุงู ฺฉ ุชุฑุฌูู ุงุฒ ุฌุงูุนู ฺฉุงุฑุจุฑุงู ุจุฑุง ูพุณุช <strong><a href="../../hardware-interrupts/index.html">Hardware Interrupts</a></strong> ุงุณุช. ููฺฉู ุงุณุช ูุงูุตุ ููุณูุฎ ุดุฏู ุง ุฏุงุฑุง ุฎุทุง ุจุงุดุฏ. ูุทูุง ูุฑ ฺฏููู ูุดฺฉู ุฑุง ุฏุฑ <a href="https://github.com/phil-opp/blog_os/issues/908">ุงู ุงุดู</a> ฺฏุฒุงุฑุด ุฏูุฏ!
            </p>
            <p>
                ุชุฑุฌูู ุชูุณุท <a href="https://github.com/hamidrezakp">@hamidrezakp</a> ู <a href="https://github.com/MHBahrampour">@MHBahrampour</a>.</p>
            </div>
    

    <div class="right-to-left">
    <p>ุฏุฑ ุงู ูพุณุช ูุง ฺฉูุชุฑู ฺฉููุฏู ูุงุจู ุจุฑูุงูู ุฑุฒ ูููู ุฑุง ุชูุธู ู ฺฉูู ุชุง ูููู ูุง ุณุฎุช ุงูุฒุงุฑ ุฑุง ุจู ุฏุฑุณุช ุจู ูพุฑุฏุงุฒูุฏู ููุชูู ฺฉูุฏ. ุจุฑุง ูุฏุฑุช ุงู ููููโูุง ุ ููุงุฑุฏ ุฌุฏุฏ ุจู ุฌุฏูู ุชูุตู ฺฉููุฏู ูููู ุงุถุงูู ู ฺฉูู ุ ุฏููุงู ูุงููุฏ ฺฉุงุฑูุง ฺฉู ุจุฑุง ฺฉูุชุฑู ฺฉููุฏู ูุง ุงุณุชุซูุง ุงูุฌุงู ุฏุงุฏู. ูุง ุงุฏ ุฎูุงูู ฺฏุฑูุช ฺฉู ฺฺฏููู ูููู ูุง ูุชูุงูุจ ุชุงูุฑ ุฑุง ฺฏุฑูุชู ู ฺฺฏููู ุงุฒ ุตูุญู ฺฉูุฏ ูุฑูุฏ ุจฺฏุฑู.</p>
<span id="continue-reading"></span>
<p>ุงู ุจูุงฺฏ ุจุตูุฑุช ุขุฒุงุฏ ุจุฑ ุฑู <a href="https://github.com/phil-opp/blog_os">ฺฏุชโูุงุจ</a> ุชูุณุนู ุฏุงุฏู ุดุฏู. ุงฺฏุฑ ูุดฺฉู ุง ุณูุงู ุฏุงุฑุฏุ ูุทูุงู ุขูโุฌุง ฺฉ ุงุดู ุจุงุฒ ฺฉูุฏ. ููฺูู ูโุชูุงูุฏ <a href="index.html#comments">ุฏุฑ ุฒุฑ</a> ุงู ูพุณุช ฺฉุงููุช ุจฺฏุฐุงุฑุฏ. ุณูุฑุณ ฺฉุฏ ฺฉุงูู ุงู ูพุณุช ุฑุง ูโุชูุงูุฏ ุฏุฑ ุจูุฑููฺ <a href="https://github.com/phil-opp/blog_os/tree/post-07"><code>post-07</code></a> ูพุฏุง ฺฉูุฏ.</p>
<!-- fix for zola anchor checker (target is in template): <a id="comments"> -->

    <details id = "toc-inline">
        <summary><b>ููุฑุณุช ูุทุงูุจ</b></summary>
        <ul>
            <li>
                <a href="index.html#mqdmh">ููุฏูู</a>
                
            </li><li>
                <a href="index.html#the-8259-pic">The 8259 PIC</a>
                <ul>
                    <li>
                        <a href="index.html#pydh-szy">ูพุงุฏู ุณุงุฒ</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#f-lszy-wqfhh">ูุนุงูโุณุงุฒ ููููโูุง</a>
                
            </li><li>
                <a href="index.html#mdyryt-wqfhhy-tymr">ูุฏุฑุช ููููโูุง ุชุงูุฑ</a>
                <ul>
                    <li>
                        <a href="index.html#pyn-wqfh">ูพุงุงู ูููู</a>
                    </li><li>
                        <a href="index.html#pykhrbndy-tymr">ูพฺฉุฑุจูุฏ ุชุงูุฑ</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#bnbst-h">ุจูโุจุณุช ูุง</a>
                <ul>
                    <li>
                        <a href="index.html#yjd-bnbst">ุงุฌุงุฏ ุจูโุจุณุช</a>
                    </li><li>
                        <a href="index.html#rf-bnbst">ุฑูุน ุจูโุจุณุช</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#rf-wd-yt-rqbty">ุฑูุน ูุถุนุช ุฑูุงุจุช</a>
                
            </li><li>
                <a href="index.html#dstwrl-ml-hlt">ุฏุณุชูุฑุงูุนูู hlt</a>
                
            </li><li>
                <a href="index.html#wrwdy-sfhh-khlyd">ูุฑูุฏ ุตูุญู ฺฉูุฏ</a>
                <ul>
                    <li>
                        <a href="index.html#khwndn-skhnkhd-h">ุฎูุงูุฏู ุงุณฺฉูโฺฉุฏ ูุง</a>
                    </li><li>
                        <a href="index.html#tfsyr-skhnkhd-h">ุชูุณุฑ ุงุณฺฉูโฺฉุฏ ูุง</a>
                    </li><li>
                        <a href="index.html#pykhrbndy-sfhh-khlyd">ูพฺฉุฑุจูุฏ ุตูุญู ฺฉูุฏ</a>
                    </li>
                </ul>
            </li><li>
                <a href="index.html#khlsh">ุฎูุงุตู</a>
                
            </li><li>
                <a href="index.html#mrhlh-b-dy-chyst">ูุฑุญูู ุจุนุฏ ฺุณุชุ</a>
                
            </li>
            <li class="toc-comments-link"><a href="index.html#comments">ูุธุฑุงุช</a></li>
        </ul>
    </details>

<h2 id="mqdmh"><a class="zola-anchor" href="index.html#mqdmh" aria-label="Anchor link for: mqdmh">๐</a>ููุฏูู</h2>
<p>ููููโูุง ุฑุงู ุจุฑุง ุงุทูุงุน ุจู ูพุฑุฏุงุฒูุฏู ุงุฒ ุฏุณุชฺฏุงู ูุง ุณุฎุช ุงูุฒุงุฑ ูุชุตู ุงุฑุงุฆู ู ุฏููุฏ. ุจูุงุจุฑุงู ุจู ุฌุง ุงูฺฉู ูพุฑุฏุงุฒูุฏู ุจู ุทูุฑ ุฏูุฑูโุง ุตูุญู ฺฉูุฏ ุฑุง ุจุฑุง ฺฉุงุฑุงฺฉุชุฑูุง ุฌุฏุฏ ุจุฑุฑุณ ฺฉูุฏ(ูุฑุขูุฏ ุจู ูุงู <a href="https://en.wikipedia.org/wiki/Polling_(computer_science)"><em>polling</em></a>) ุ ุตูุญู ฺฉูุฏ ูโุชูุงูุฏ ูุณุชู ุฑุง ุจุฑุง ูุฑ  ูุดุฑุฏู ฺฉูุฏ ูุทูุน ฺฉูุฏ. ุงู ุจุณุงุฑ ฺฉุงุฑุขูุฏุชุฑ ุงุณุช ุฒุฑุง ูุณุชู ููุท ุฒูุงู ฺฉู ุงุชูุงู ุงูุชุงุฏู ุงุณุช ุจุงุฏ ุนูู ฺฉูุฏ. ููฺูู ุฒูุงู ูุงฺฉูุด ุณุฑุน ุชุฑ ุฑุง ูุฑุงูู ู ฺฉูุฏ ุ ุฒุฑุง ูุณุชู ู ุชูุงูุฏ ุจูุงูุงุตูู ู ูู ุชููุง ุฏุฑ ูพูู(ฺฉููู: poll) ุจุนุฏ ูุงฺฉูุด ูุดุงู ุฏูุฏ.</p>
<p>ุงุชุตุงู ูุณุชูู ุชูุงู ุฏุณุชฺฏุงู ูุง ุณุฎุช ุงูุฒุงุฑ ุจู ูพุฑุฏุงุฒูุฏู ุงูฺฉุงู ูพุฐุฑ ูุณุช. ุฏุฑ ุนูุถ ุ ฺฉ <em>ฺฉูุชุฑู ฺฉููุฏู ูููู</em> ุฌุฏุงฺฏุงูู ุ ููููโูุง ุฑุง ุงุฒ ููู ุฏุณุชฺฏุงูโูุง ุฌูุน ฺฉุฑุฏู ู ุณูพุณ ูพุฑุฏุงุฒูุฏู ุฑุง ูุทูุน ู ฺฉูุฏ:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>                                    ____________             _____
</span><span>               Timer ------------&gt; |            |           |     |
</span><span>               Keyboard ---------&gt; | Interrupt  |---------&gt; | CPU |
</span><span>               Other Hardware ---&gt; | Controller |           |_____|
</span><span>               Etc. -------------&gt; |____________|
</span><span>
</span></code></pre>
<p>ุจุดุชุฑ ฺฉูุชุฑู ฺฉููุฏู ูุง ูููู ูุงุจู ุจุฑูุงูู ุฑุฒ ูุณุชูุฏ ุ ุจู ุงู ูุนู ฺฉู ุขููุง ุงุฒ ุงูููุช ูุง ูุฎุชูู ุจุฑุง ููููโูุง ูพุดุชุจุงู ู ฺฉููุฏ. ุจู ุนููุงู ูุซุงู ุ ุงู ุงุฌุงุฒู ุฑุง ู ุฏููุฏ ุชุง ุจู ูููู ูุง ุชุงูุฑ ุงูููุช ุจุดุชุฑ ูุณุจุช ุจู ูููู ูุง ุตูุญู ฺฉูุฏ ุฏุงุฏ ุชุง ุงุฒ ุฒูุงู ุจูุฏ ุฏูู ุงุทููุงู ุญุงุตู ุดูุฏ.</p>
<p>ุจุฑ ุฎูุงู ุงุณุชุซูุงูุง ุ ูููู ูุง ุณุฎุช ุงูุฒุงุฑ <em>ุจู ุตูุฑุช ูุง ูู ุฒูุงู</em> ุงุชูุงู ู ุงูุชูุฏ. ุงู ุจุฏุงู ูุนู ุงุณุช ฺฉู ุขููุง ฺฉุงููุงู ุงุฒ ฺฉุฏ ุงุฌุฑุง ุดุฏู ูุณุชูู ูุณุชูุฏ ู ุฏุฑ ูุฑ ุฒูุงู ููฺฉู ุงุณุช ุฑุฎ ุฏููุฏ. ุจูุงุจุฑุงู ูุง ูุงฺฏูุงู ุดฺฉู ุงุฒ ููุฑููุฏ ุฏุฑ ูุณุชู ุฎูุฏ ุจุง ุชูุงู ุงุดฺฉุงูุงุช ุงุญุชูุงู ูุฑุชุจุท ุจุง ููุฑููุฏ ุฏุงุฑู. ูุฏู ูุงูฺฉุช ุฏูู ุฑุงุณุช ุฏุฑ ุงูุฌุง ุจู ูุง ฺฉูฺฉ ู ฺฉูุฏ ุฒุฑุง ูุงูุน ุญุงูุช ุชุบุฑ ูพุฐุฑ ฺฏููุจุงู ุงุณุช(mutable global state). ุจุง ุงู ุญุงูุ ููฺูุงู ุงุญุชูุงู ุจู ุจุณุช ูุฌูุฏ ุฏุงุฑุฏุ ููุงูุทูุฑ ฺฉู ุจุนุฏุงู ุฏุฑ ุงู ูพุณุช ุฎูุงูู ุฏุฏ.</p>
<h2 id="the-8259-pic"><a class="zola-anchor" href="index.html#the-8259-pic" aria-label="Anchor link for: the-8259-pic">๐</a>The 8259 PIC</h2>
<p><a href="https://en.wikipedia.org/wiki/Intel_8259">Intel 8259</a> ฺฉ ฺฉูุชุฑู ฺฉููุฏู ูููู ูุงุจู ุจุฑูุงูู ุฑุฒ (PIC) ุงุณุช ฺฉู ุฏุฑ ุณุงู 1976 ูุนุฑู ุดุฏ. ูุฏุช ุทููุงู ุงุณุช ฺฉู ุจุง <a href="https://en.wikipedia.org/wiki/Intel_APIC_Architecture">APIC</a> ุฌุฏุฏ ุฌุงฺฏุฒู ุดุฏู ุงุณุช ุ ุงูุง ุฑุงุจุท ุขู ูููุฒ ุจู ุฏูุงู ุณุงุฒฺฏุงุฑ ุฏุฑ ุณุณุชู ูุง ูุนู ูพุดุชุจุงู ู ุดูุฏ. 8259 PIC ุจู ุทูุฑ ูุงุจู ููุงุญุธู ุง ุขุณุงู ุชุฑ ุงุฒ APIC ุงุณุช ุ ุจูุงุจุฑุงู ูุง ูุจู ุงุฒ ููุงุฌุฑุช ู ุงุณุชูุงุฏู ุงุฒ APIC ุฏุฑ ุขูุฏูุ ุงุฒ ุขู ุจุฑุง ูุนุฑู ูููู ุงุณุชูุงุฏู ุฎูุงูู ฺฉุฑุฏ.</p>
<p>8259 ุฏุงุฑุง 8 ุฎุท ูููู ู ฺูุฏู ุฎุท ุจุฑุง ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท ุจุง ูพุฑุฏุงุฒูุฏู ุงุณุช. ุณุณุชู ูุง ูุนููู ุฏุฑ ุขู ุฒูุงู ุจู ุฏู ููููู ุงุฒ 8259 PIC ูุฌูุฒ ุจูุฏูุฏ ุ ฺฉ ุงุตู ู ุฏฺฏุฑ PIC ุซุงููู ฺฉู ุจู ฺฉ ุงุฒ ุฎุทูุท ูููู ุงููู ูุชุตู ุงุณุช:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>                     ____________                          ____________
</span><span>Real Time Clock --&gt; |            |   Timer -------------&gt; |            |
</span><span>ACPI -------------&gt; |            |   Keyboard-----------&gt; |            |      _____
</span><span>Available --------&gt; | Secondary  |----------------------&gt; | Primary    |     |     |
</span><span>Available --------&gt; | Interrupt  |   Serial Port 2 -----&gt; | Interrupt  |---&gt; | CPU |
</span><span>Mouse ------------&gt; | Controller |   Serial Port 1 -----&gt; | Controller |     |_____|
</span><span>Co-Processor -----&gt; |            |   Parallel Port 2/3 -&gt; |            |
</span><span>Primary ATA ------&gt; |            |   Floppy disk -------&gt; |            |
</span><span>Secondary ATA ----&gt; |____________|   Parallel Port 1----&gt; |____________|
</span><span>
</span></code></pre>
<p>ุงู ูููุฏุงุฑ ูุญูู ุงุชุตุงู ูุนููู ุฎุทูุท ูููู ุฑุง ูุดุงู ู ุฏูุฏ. ู ุจูู ฺฉู ุจุดุชุฑ 15 ุฎุท ุฏุงุฑุง ฺฉ ูฺฏุงุดุช ุซุงุจุช ูุณุชูุฏ ุ ุจู ุนููุงู ูุซุงู ุฎุท 4 PIC ุซุงููู ุจู ูุงูุณ ุงุฎุชุตุงุต ุฏุงุฏู ุดุฏู ุงุณุช.</p>
<p>ูุฑ ฺฉูุชุฑู ฺฉููุฏู ุฑุง ู ุชูุงู ุงุฒ ุทุฑู ุฏู <a href="../../testing/index.html#i-o-ports">ูพูุฑุช ูุฑูุฏ/ุฎุฑูุฌ</a> ุ ฺฉ ูพูุฑุช โูุฑูุงูโ ู ฺฉ ูพูุฑุช โุฏุงุฏูโ ูพฺฉุฑุจูุฏ ฺฉุฑุฏ. ุจุฑุง ฺฉูุชุฑู ฺฉููุฏู ุงุตู ุ ุงู ูพูุฑุชโูุง <code>0x20</code> (ูุฑูุงู) ู<code>0x21</code> (ุฏุงุฏู) ูุณุชูุฏ. ุจุฑุง ฺฉูุชุฑู ฺฉููุฏู ุซุงููู ุขููุง <code>0xa0</code> (ูุฑูุงู) ู <code>0xa1</code> (ุฏุงุฏู) ูุณุชูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุจุดุชุฑ ุฏุฑ ููุฑุฏ ูุญูู ูพฺฉุฑุจูุฏ PIC ูุง ุ ุจู <a href="https://wiki.osdev.org/8259_PIC">ููุงููโุง ุฏุฑ osdev.org</a> ูุฑุงุฌุนู ฺฉูุฏ.</p>
<h3 id="pydh-szy"><a class="zola-anchor" href="index.html#pydh-szy" aria-label="Anchor link for: pydh-szy">๐</a>ูพุงุฏู ุณุงุฒ</h3>
<p>ูพฺฉุฑุจูุฏ ูพุด ูุฑุถ PIC ูุง ูุงุจู ุงุณุชูุงุฏู ูุณุชุ ุฒุฑุง ุงุนุฏุงุฏ ุจุฑุฏุงุฑ ูููู ุฑุง ุฏุฑ ูุญุฏูุฏู 15-0 ุจู ูพุฑุฏุงุฒูุฏู ู ูุฑุณุชุฏ. ุงู ุงุนุฏุงุฏ ุฏุฑ ุญุงู ุญุงุถุฑ ุชูุณุท ุงุณุชุซูุงูุง ูพุฑุฏุงุฒูุฏู ุงุดุบุงู ุดุฏูโุงูุฏ ุ ุจู ุนููุงู ูุซุงู ุดูุงุฑู 8 ูุฑุจูุท ุจู ฺฉ ุฎุทุง ุฏูฺฏุงูู ุงุณุช. ุจุฑุง ุฑูุน ุงู ูุดฺฉู ูููพูุดุงูุ ุจุงุฏ ูููู ูุง PIC ุฑุง ุจู ุงุนุฏุงุฏ ุฏฺฏุฑ ุชุบุฑ ุฏูู. ุฏุงููู ูุงูุน ููู ูุณุช ุจู ุดุฑุท ฺฉู ุจุง ุงุณุชุซูุงูุง ูููพูุดุงู ูุฏุงุดุชู ุจุงุดุฏ ุ ุงูุง ูุนูููุงู ูุญุฏูุฏู 47-32 ุงูุชุฎุงุจ ู ุดูุฏุ ุฒุฑุง ุงููุง ุงููู ุดูุงุฑู ูุง ุขุฒุงุฏ ูพุณ ุงุฒ 32 ุงุณูุงุช ุงุณุชุซูุง ูุณุชูุฏ.</p>
<p>ูพฺฉุฑุจูุฏ ุจุง ููุดุชู ููุงุฏุฑ ูฺู ุฏุฑ ูพูุฑุช ูุง ูุฑูุงู ู ุฏุงุฏู PIC ูุง ุงุชูุงู ู ุงูุชุฏ. ุฎูุดุจุฎุชุงูู ูุจูุง ฺฉุฑุชโุง ุจู ูุงู <a href="https://docs.rs/pic8259/0.10.1/pic8259/"><code>pic8259</code></a> ูุฌูุฏ ุฏุงุฑุฏุ ุจูุงุจุฑุงู ูุงุฒ ูุณุช ฺฉู ุชูุงู ุฑุงู ุงูุฏุงุฒ ุงููู ุฑุง ุฎูุฏูุงู ุจููุณู. ุฏุฑ ุตูุฑุช ุนูุงููโููุฏ ุจูุฏู ุจู ฺฺฏููฺฏ ุนููฺฉุฑุฏ ุขูุ <a href="https://docs.rs/crate/pic8259/0.10.1/source/src/lib.rs">ฺฉุฏ ููุจุน ุขู</a> ุฑุง ุจุฑุฑุณ ฺฉูุฏุ ูุณุจุชุงู ฺฉูฺฺฉ ู ุฏุงุฑุง ูุณุชูุฏ ุฎูุจ ุงุณุช.</p>
<p>ุจุฑุง ุงูุฒูุฏู ฺฉุฑุช ุจู ุนููุงู ูุงุจุณุชฺฏ ุ ููุงุฑุฏ ุฒุฑ ุฑุง ุจู ูพุฑูฺู ุฎูุฏ ุงุถุงูู ู ฺฉูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">dependencies</span><span>]
</span><span style="color:#569cd6;">pic8259 </span><span>= </span><span style="color:#d69d85;">&quot;0.10.1&quot;
</span></code></pre>
<p>ุงูุชุฒุงุน ุงุตู ุงุฑุงุฆู ุดุฏู ุชูุณุท ฺฉุฑุชุ ุณุงุฎุชูุงู <a href="https://docs.rs/pic8259/0.10.1/pic8259/struct.ChainedPics.html"><code>ChainedPics</code></a> ุงุณุช ฺฉู ููุงุงูฺฏุฑ ุทุฑุญ ุงููู/ุซุงููู PIC ุงุณุช ฺฉู ุฏุฑ ุจุงูุง ุฏุฏู. ุจุฑุง ุงุณุชูุงุฏู ุจู ุฑูุด ุฒุฑ ุทุฑุงุญ ุดุฏู ุงุณุช:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">use </span><span>pic8259::ChainedPics;
</span><span style="color:#569cd6;">use</span><span> spin;
</span><span>
</span><span style="color:#569cd6;">pub const </span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#b5cea8;">32</span><span>;
</span><span style="color:#569cd6;">pub const </span><span style="color:#b4cea8;">PIC_2_OFFSET</span><span>: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#b4cea8;">PIC_1_OFFSET </span><span>+ </span><span style="color:#b5cea8;">8</span><span>;
</span><span>
</span><span style="color:#569cd6;">pub static </span><span style="color:#b4cea8;">PICS</span><span>: spin::Mutex&lt;ChainedPics&gt; =
</span><span>    spin::Mutex::new(</span><span style="color:#569cd6;">unsafe </span><span>{ ChainedPics::new(</span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>, </span><span style="color:#b4cea8;">PIC_2_OFFSET</span><span>) });
</span></code></pre>
<p>ููุงูุทูุฑ ฺฉู ุฏุฑ ุจุงูุง ุงุดุงุฑู ฺฉุฑุฏูุ ุงูุณุช PIC ูุง ุฑุง ุฏุฑ ูุญุฏูุฏู 47-32 ุชูุธู ู ฺฉูู. ุจุง ุจุณุชู ุจูุฏ ุณุงุฎุชูุงู <code>ChainedPics</code> ุฏุฑ <code>Mutex</code> ู ุชูุงูู ุฏุณุชุฑุณ ูุงุจู ุชุบุฑ ู ุงูู (ุงุฒ ุทุฑู <a href="https://docs.rs/spin/0.5.2/spin/struct.Mutex.html#method.lock">ูุชุฏ lock</a>) ุจู ุขู ุฏุงุดุชู ุจุงุดูุ ฺฉู ุฏุฑ ูุฑุญูู ุจุนุฏ ุจู ุขู ูุงุฒ ุฏุงุฑู. ุชุงุจุน <code>ChainedPics::new</code> ูุงุงูู ุงุณุช ุฒุฑุง ุงูุณุช ุงุดุชุจุงู ููฺฉู ุงุณุช ุจุงุนุซ ุฑูุชุงุฑ ูุงูุดุฎุต ุดูุฏ.</p>
<p>ุงฺฉููู ู ุชูุงูู 8259 PIC ุฑุง ุฏุฑ ุชุงุจุน <code>init</code> ุฎูุฏ ููุฏุงุฑ ุฏู ุงููู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>init() {
</span><span>    gdt::init();
</span><span>    interrupts::init_idt();
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{ interrupts::</span><span style="color:#b4cea8;">PICS</span><span>.lock().initialize() }; </span><span style="color:#608b4e;">// new
</span><span>}
</span></code></pre>
<p>ูุง ุงุฒ ุชุงุจุน <a href="https://docs.rs/pic8259/0.10.1/pic8259/struct.ChainedPics.html#method.initialize"><code>initialize</code></a> ุจุฑุง ุงูุฌุงู ููุฏุงุฑุฏู ุงููู PIC ุงุณุชูุงุฏู ู ฺฉูู. ูุงููุฏ ุชุงุจุน <code>ChainedPics::new</code>ุ ุงู ุชุงุจุน ูุฒ ุงูู ูุณุช ุฒุฑุง ุฏุฑ ุตูุฑุช ุนุฏู ูพฺฉุฑุจูุฏ ุตุญุญ PIC ู ุชูุงูุฏ ุจุงุนุซ ุฑูุชุงุฑ ูุงูุดุฎุต ุดูุฏ.</p>
<p>ุงฺฏุฑ ููู ฺุฒ ุฎูุจ ูพุด ุจุฑูุฏ ุ ุจุงุฏ ููฺฏุงู ุงุฌุฑุง <code>cargo run</code> ูพุงู โIt did not crashโ ุฑุง ุจุจูู.</p>
<h2 id="f-lszy-wqfhh"><a class="zola-anchor" href="index.html#f-lszy-wqfhh" aria-label="Anchor link for: f-lszy-wqfhh">๐</a>ูุนุงูโุณุงุฒ ููููโูุง</h2>
<p>ุชุงฺฉููู ูฺ ุงุชูุงู ููุชุงุฏู ุงุณุช ุฒุฑุง ููููโูุง ููฺูุงู ุฏุฑ ุชูุธูุงุช ูพุฑุฏุงุฒูุฏู ุบุฑูุนุงู ูุณุชูุฏ. ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ูพุฑุฏุงุฒูุฏู ุจู ูฺ ูุฌู ุจู ฺฉูุชุฑู ฺฉููุฏู ูููู ฺฏูุด ูู ุฏูุฏุ ุจูุงุจุฑุงู ูฺ ูููู ุง ูู ุชูุงูุฏ ุจู ูพุฑุฏุงุฒูุฏู ุจุฑุณุฏ. ุจุงุฏ ุงู ุฑุง ุชุบุฑ ุฏูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>init() {
</span><span>    gdt::init();
</span><span>    interrupts::init_idt();
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{ interrupts::</span><span style="color:#b4cea8;">PICS</span><span>.lock().initialize() };
</span><span>    x86_64::instructions::interrupts::enable();     </span><span style="color:#608b4e;">// new
</span><span>}
</span></code></pre>
<p>ุชุงุจุน <code>interrupts::enable</code> ุงุฒ ฺฉุฑุช <code>x86_64</code> ุฏุณุชูุฑุงูุนูู ุฎุงุต <code>sti</code> ุฑุง ุงุฌุฑุง ู ฺฉูุฏ (โset interruptsโ) ุชุง ูููู ูุง ุฎุงุฑุฌ ุฑุง ูุนุงู ฺฉูุฏ. ุงฺฉููู ููุช <code>cargo run</code> ุฑุง ุงูุชุญุงู ู ฺฉูู ุ ู ุจูู ฺฉู ฺฉ ุฎุทุง ุฏูฺฏุงูู ุฑุฎ ูโุฏูุฏ:</p>
<p><img src="qemu-hardware-timer-double-fault.png" alt="QEMU printing EXCEPTION: DOUBLE FAULT because of hardware timer" /></p>
<p>ุฏูู ุงู ุฎุทุง ุฏูฺฏุงูู ุงู ุงุณุช ฺฉู ุชุงูุฑ ุณุฎุช ุงูุฒุงุฑ (ุจู ุทูุฑ ุฏูู ุชุฑ <a href="https://en.wikipedia.org/wiki/Intel_8253">Intel 8253</a>) ุจู ุทูุฑ ูพุด ูุฑุถ ูุนุงู ุงุณุชุ ุจูุงุจุฑุงู ุจู ูุญุถ ูุนุงู ฺฉุฑุฏู ููููโูุง ุ ุดุฑูุน ุจู ุฏุฑุงูุช ูููู ูุง ุชุงูุฑ ู ฺฉูู. ุงุฒ ุขูุฌุง ฺฉู ูููุฒ ฺฉ ุชุงุจุน ฺฉูุชุฑู ฺฉููุฏู ุจุฑุง ุขู ุชุนุฑู ูฺฉุฑุฏูโุงู ุ ฺฉูุชุฑู ฺฉููุฏู ุฎุทุง ุฏูฺฏุงูู ูุฑุงุฎูุงู ู ุดูุฏ.</p>
<h2 id="mdyryt-wqfhhy-tymr"><a class="zola-anchor" href="index.html#mdyryt-wqfhhy-tymr" aria-label="Anchor link for: mdyryt-wqfhhy-tymr">๐</a>ูุฏุฑุช ููููโูุง ุชุงูุฑ</h2>
<p>ููุงูุทูุฑ ฺฉู ุฏุฑ ุดฺฉู <a href="index.html#the-8259-pic">ุจุงูุง</a> ู ุจููุ ุชุงูุฑ ุงุฒ ุฎุท 0 ุงุฒ PIC ุงุตู ุงุณุชูุงุฏู ู ฺฉูุฏ. ุงู ุจู ุงู ูุนู ุงุณุช ฺฉู ุจู ุตูุฑุช ูููู 32 (0 + ุงูุณุช 32) ุจู ูพุฑุฏุงุฒูุฏู ู ุฑุณุฏ. ุจู ุฌุง ูุงุฑุฏ-ฺฉุฏ(Hardcode) ฺฉุฑุฏู 32ุ ุขู ุฑุง ุฏุฑ ฺฉ ุงูุงู(enum) ุจู ูุงู <code>InterruptIndex</code> ุฐุฎุฑู ู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span>#[derive(Debug, Clone, Copy)]
</span><span>#[repr(u8)]
</span><span style="color:#569cd6;">pub enum </span><span>InterruptIndex {
</span><span>    Timer = </span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>,
</span><span>}
</span><span>
</span><span style="color:#569cd6;">impl </span><span>InterruptIndex {
</span><span>    </span><span style="color:#569cd6;">fn </span><span>as_u8(self) -&gt; </span><span style="color:#569cd6;">u8 </span><span>{
</span><span>        self </span><span style="color:#569cd6;">as u8
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">fn </span><span>as_usize(self) -&gt; </span><span style="color:#569cd6;">usize </span><span>{
</span><span>        </span><span style="color:#569cd6;">usize</span><span>::from(self.as_u8())
</span><span>    }
</span><span>}
</span></code></pre>
<p>ุงูุงู ฺฉ <a href="https://doc.rust-lang.org/reference/items/enumerations.html#custom-discriminant-values-for-fieldless-enumerations">ุงูุงู C ูุงููุฏ</a> ุงุณุช ุจูุงุจุฑุงู ูุง ู ุชูุงูู ุงูุฏฺฉุณ ุฑุง ุจุฑุง ูุฑ ููุน ุจู ุทูุฑ ูุณุชูู ูุดุฎุต ฺฉูู. ูฺฺฏ <code>repr(u8)</code> ูุดุฎุต ู ฺฉูุฏ ฺฉู ูุฑ ููุน ุจู ุนููุงู <code>u8</code> ูุดุงู ุฏุงุฏู ู ุดูุฏ. ุฏุฑ ุขูุฏู ุงููุงุน ุจุดุชุฑ ุจุฑุง ูููู ูุง ุฏฺฏุฑ ุงุถุงูู ุฎูุงูู ฺฉุฑุฏ.</p>
<p>ุงฺฉููู ู ุชูุงูู ฺฉ ุชุงุจุน ฺฉูุชุฑู ฺฉููุฏู ุจุฑุง ูููู ุชุงูุฑ ุงุถุงูู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">use crate</span><span>::print;
</span><span>
</span><span>lazy_static! {
</span><span>    </span><span style="color:#569cd6;">static ref </span><span style="color:#b4cea8;">IDT</span><span>: InterruptDescriptorTable = {
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> idt = InterruptDescriptorTable::new();
</span><span>        idt.breakpoint.set_handler_fn(breakpoint_handler);
</span><span>        [โฆ]
</span><span>        idt[InterruptIndex::Timer.as_usize()]
</span><span>            .set_handler_fn(timer_interrupt_handler); </span><span style="color:#608b4e;">// new
</span><span>
</span><span>        idt
</span><span>    };
</span><span>}
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>timer_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    print!(</span><span style="color:#d69d85;">&quot;.&quot;</span><span>);
</span><span>}
</span></code></pre>
<p><code>timer_interrupt_handler</code> ูุง ุฏุงุฑุง ุงูุถุง ูุดุงุจู ฺฉูุชุฑู ฺฉููุฏู ูุง ุงุณุชุซูุง ูุง ุงุณุช ุ ุฒุฑุง ูพุฑุฏุงุฒูุฏู ุจู ุทูุฑ ฺฉุณุงู ุจู ุงุณุชุซูุงูุง ู ูููู ูุง ุฎุงุฑุฌ ูุงฺฉูุด ูุดุงู ู ุฏูุฏ (ุชููุง ุชูุงูุช ุงู ุงุณุช ฺฉู ุจุฑุฎ ุงุฒ ุงุณุชุซูุงูุง ฺฉุฏ ุฎุทุง ุฑุง ุฏุฑ ูพุดุชู ุฐุฎุฑู ูโฺฉููุฏ). ุณุงุฎุชูุงู <a href="https://docs.rs/x86_64/0.14.2/x86_64/structures/idt/struct.InterruptDescriptorTable.html"><code>InterruptDescriptorTable</code></a> ุชุฑุช <a href="https://doc.rust-lang.org/core/ops/trait.IndexMut.html"><code>IndexMut</code></a> ุฑุง ูพุงุฏู ุณุงุฒ ู ฺฉูุฏุ ุจูุงุจุฑุงู ู ุชูุงูู ุงุฒ ุทุฑู ุณูุชฺฉุณ ุงูุฏฺฉุณโุฏู ุขุฑุงูุ ุจู ุงุชู ูุง ุฌุฏุงฺฏุงูู ุฏุณุชุฑุณ ูพุฏุง ฺฉูู.</p>
<p>ุฏุฑ ฺฉูุชุฑู ฺฉููุฏู ูููู ุชุงูุฑุ ฺฉ ููุทู ุฑุง ุฑู ุตูุญู ฺุงูพ ู ฺฉูู. ููุงูุทูุฑ ฺฉู ูููู ุชุงูุฑ ุจู ุตูุฑุช ุฏูุฑู ุง ุงุชูุงู ู ุงูุชุฏ ุ ุงูุชุธุงุฑ ุฏุงุฑู ฺฉู ุฏุฑ ูุฑ ุชฺฉ ุชุงูุฑ ฺฉ ููุทู ุธุงูุฑ ุดูุฏ. ุจุง ุงู ุญุงูุ ููฺฏุงู ฺฉู ุขู ุฑุง ุงุฌุฑุง ู ฺฉูู ู ุจูู ฺฉู ููุท ฺฉ ููุทู ฺุงูพ ู ุดูุฏ:</p>
<p><img src="qemu-single-dot-printed.png" alt="QEMU printing only a single dot for hardware timer" /></p>
<h3 id="pyn-wqfh"><a class="zola-anchor" href="index.html#pyn-wqfh" aria-label="Anchor link for: pyn-wqfh">๐</a>ูพุงุงู ูููู</h3>
<p>ุฏูู ุงู ุงูุฑ ุงู ุงุณุช ฺฉู PIC ุงูุชุธุงุฑ ุฏุงุฑุฏ ฺฉ ุณฺฏูุงู ุตุฑุญ โูพุงุงู ููููโ (EOI) ุงุฒ ฺฉูุชุฑู ฺฉููุฏู ูููู ูุง ุฏุฑุงูุช ฺฉูุฏ. ุงู ุณฺฏูุงู ุจู PIC ู ฺฏูุฏ ฺฉู ูููู ูพุฑุฏุงุฒุด ุดุฏู ู ุณุณุชู ุขูุงุฏู ุฏุฑุงูุช ูููู ุจุนุฏ ุงุณุช. ุจูุงุจุฑุงู PIC ูฺฉุฑ ู ฺฉูุฏ ูุง ูููุฒ ูุดุบูู ูพุฑุฏุงุฒุด ูููู ุชุงูุฑ ุงูู ูุณุชู ู ูุจู ุงุฒ ุงุฑุณุงู ุณฺฏูุงู ุจุนุฏ ุจุง ุตุจุฑ ู ุญูุตูู ููุชุธุฑ ุณฺฏูุงู EOI ุงุฒ ูุง ูุณุช.</p>
<p>ุจุฑุง ุงุฑุณุงู EOI ุ ูุง ุฏูุจุงุฑู ุงุฒ ุณุงุฎุชูุงู ุซุงุจุช <code>PICS</code> ุฎูุฏ ุงุณุชูุงุฏู ู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>timer_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    print!(</span><span style="color:#d69d85;">&quot;.&quot;</span><span>);
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Timer.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p><code>notify_end_of_interrupt</code> ุชุดุฎุต ูโุฏูุฏ ฺฉู PIC ุงุตู ุง ุซุงููู ูููู ุฑุง ุงุฑุณุงู ฺฉุฑุฏู ุงุณุช ู ุณูพุณ ุงุฒ ูพูุฑุช ูุง <code>command</code> ู <code>data</code> ุจุฑุง ุงุฑุณุงู ุณฺฏูุงู EOI ุจู PIC ูุง ูุฑุจูุทู ุงุณุชูุงุฏู ู ฺฉูุฏ. ุงฺฏุฑ PIC ุซุงููู ูููู ุฑุง ุงุฑุณุงู ฺฉุฑุฏ ุ ูุฑ ุฏู PIC ุจุงุฏ ูุทูุน ุดููุฏ ุฒุฑุง PIC ุซุงููู ุจู ฺฉ ุฎุท ูุฑูุฏ ุงุฒ PIC ุงุตู ูุชุตู ุงุณุช.</p>
<p>ูุง ุจุงุฏ ูุฑุงูุจ ุจุงุดู ฺฉู ุงุฒ ุดูุงุฑู ุจุฑุฏุงุฑ ูููู ุตุญุญ ุงุณุชูุงุฏู ฺฉููุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ู ุชูุงูู ุจู ุทูุฑ ุชุตุงุฏู ฺฉ ูููู ููู ุงุฑุณุงู ูุดุฏู ุฑุง ุญุฐู ฺฉูู ุง ุจุงุนุซ ููฺฏ ุณุณุชู ุฎูุฏ ุดูู. ุงู ุฏูู ุขู ุงุณุช ฺฉู ุชุงุจุน ูุงุงูู ุงุณุช.</p>
<p>ุงฺฉููู ููฺฏุงู ฺฉู <code>cargo run</code> ุฑุง ุงุฌุฑุง ู ฺฉููุ ููุงุท ุฑุง ู ุจูู ฺฉู ุจู ุตูุฑุช ุฏูุฑู ุง ุฑู ุตูุญู ุธุงูุฑ ู ุดููุฏ:</p>
<p><img src="qemu-hardware-timer-dots.gif" alt="QEMU printing consecutive dots showing the hardware timer" /></p>
<h3 id="pykhrbndy-tymr"><a class="zola-anchor" href="index.html#pykhrbndy-tymr" aria-label="Anchor link for: pykhrbndy-tymr">๐</a>ูพฺฉุฑุจูุฏ ุชุงูุฑ</h3>
<p>ุชุงูุฑ ุณุฎุช ุงูุฒุงุฑ ฺฉู ูุง ุงุฒ ุขู ุงุณุชูุงุฏู ู ฺฉูู ุ <em>Programmable Interval Timer</em> ุง ุจู ุงุฎุชุตุงุฑ PIT ูุงูุฏู ู ุดูุฏ. ููุงูุทูุฑ ฺฉู ุงุฒ ูุงู ุขู ูุดุฎุต ุงุณุช ุ ู ุชูุงู ูุงุตูู ุจู ุฏู ูููู ุฑุง ูพฺฉุฑุจูุฏ ฺฉุฑุฏ. ูุง ุฏุฑ ุงูุฌุง ุจู ุฌุฒุฆุงุช ูู ูพุฑุฏุงุฒู ุฒุฑุง ุจู ุฒูุฏ ุจู <a href="https://wiki.osdev.org/APIC_timer">ุชุงูุฑ APIC</a> ุณูฺ ุฎูุงูู ฺฉุฑุฏุ ุงูุง ูฺฉ OSDev ููุงูู ููุตู ุฏุฑุจุงุฑู <a href="https://wiki.osdev.org/Programmable_Interval_Timer">ูพฺฉุฑุจูุฏ PIT</a> ุฏุงุฑุฏ.</p>
<h2 id="bnbst-h"><a class="zola-anchor" href="index.html#bnbst-h" aria-label="Anchor link for: bnbst-h">๐</a>ุจูโุจุณุช ูุง</h2>
<p>ุงฺฉููู ููุน ููุฑููุฏ ุฏุฑ ูุณุชู ุฎูุฏ ุฏุงุฑู: ูููู ูุง ุชุงูุฑ ุจู ุตูุฑุช ูุงููุฒูุงู ุงุชูุงู ู ุงูุชูุฏ ุ ุจูุงุจุฑุงู ู ุชูุงููุฏ ุชุงุจุน <code>start_</code> ุฑุง ุฏุฑ ูุฑ ุฒูุงู ูุทุน ฺฉููุฏ. ุฎูุดุจุฎุชุงูู ุณุณุชู ูุงูฺฉุช ุฑุงุณุช ุงุฒ ุจุณุงุฑ ุงุฒ ูุดฺฉูุงุช ูุฑุจูุท ุจู ููุฑููุฏ ุฏุฑ ุฒูุงู ฺฉุงููพุงู ุฌููฺฏุฑ ู ฺฉูุฏ. ฺฉ ุงุณุชุซูุง ูุงุจู ุชูุฌู ุจูโุจุณุช ุงุณุช. ุฏุฑุตูุฑุช ฺฉู ูุฎ(Thread) ุจุฎูุงูุฏ ููู ุฑุง ุจุฏุณุช ุขูุฑุฏ ฺฉู ูุฑฺฏุฒ ุขุฒุงุฏ ูุฎูุงูุฏ ุดุฏุ ุจูโุจุณุช ุจู ูุฌูุฏ ู ุขุฏ. ุจูุงุจุฑุงู ูุฎ ุจู ุทูุฑ ูุงูุญุฏูุฏ ููฺฏ ูโฺฉูุฏ.</p>
<p>ูุง ู ุชูุงูู ุฏุฑ ูุณุชู ุฎูุฏ ุจูโุจุณุช ุงุฌุงุฏ ฺฉูู. ุงฺฏุฑ ุจู ุงุฏ ุฏุงุดุชู ุจุงุดุฏุ ูุงฺฉุฑู <code>println</code> ูุง ุชุงุจุน <code>vga_buffer::_print</code> ุฑุง ูุฑุงุฎูุงู ู ฺฉูุฏุ ฺฉู ุจุง ุงุณุชูุงุฏู ุงุฒ spinlock ฺฉ <a href="../../vga-text-mode/index.html#spinlocks"><code>WRITER</code> ฺฏููุจุงู ุฑุง ููู ูฺฉูุฏ</a>.</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>[โฆ]
</span><span>
</span><span>#[doc(hidden)]
</span><span style="color:#569cd6;">pub fn </span><span>_print(args: fmt::Arguments) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#b4cea8;">WRITER</span><span>.lock().write_fmt(args).unwrap();
</span><span>}
</span></code></pre>
<p><code>WRITER</code> ุฑุง ููู ู ฺฉูุฏุ <code>write_fmt</code> ุฑุง ุฑู ุขู ูุฑุงุฎูุงู ู ฺฉูุฏ ู ุฏุฑ ุงูุชูุง ุชุงุจุน ุจู ุทูุฑ ุถูู ููู ุขู ุฑุง ุจุงุฒ ู ฺฉูุฏ. ุญุงู ุชุตูุฑ ฺฉูุฏ ฺฉู ุฏุฑ ุญุงู ฺฉู <code>WRITER</code> ููู ุดุฏู ุงุณุช ูููู ุฑุฎ ุฏูุฏ ู ฺฉูุชุฑู ฺฉููุฏู ูููู ูุฒ ุณุน ฺฉูุฏ ฺุฒ ุฑุง ฺุงูพ ฺฉูุฏ:</p>
<table><thead><tr><th>Timestep</th><th>_start</th><th>interrupt_handler</th></tr></thead><tbody>
<tr><td>0</td><td>calls <code>println!</code></td><td>ย</td></tr>
<tr><td>1</td><td><code>print</code> locks <code>WRITER</code></td><td>ย</td></tr>
<tr><td>2</td><td></td><td><strong>interrupt occurs</strong>, handler begins to run</td></tr>
<tr><td>3</td><td></td><td>calls <code>println!</code></td></tr>
<tr><td>4</td><td></td><td><code>print</code> tries to lock <code>WRITER</code> (already locked)</td></tr>
<tr><td>5</td><td></td><td><code>print</code> tries to lock <code>WRITER</code> (already locked)</td></tr>
<tr><td>โฆ</td><td></td><td>โฆ</td></tr>
<tr><td><em>never</em></td><td><em>unlock <code>WRITER</code></em></td><td></td></tr>
</tbody></table>
<p><code>WRITER</code> ููู ุดุฏู ุงุณุช ุ ุจูุงุจุฑุงู ฺฉูุชุฑู ฺฉููุฏู ูููู ููุชุธุฑ ู ูุงูุฏ ุชุง ุขุฒุงุฏ ุดูุฏ. ุงูุง ุงู ูุฑฺฏุฒ ุงุชูุงู ูู ุงูุชุฏ ุ ุฒุฑุง ุชุงุจุน <code>start_</code> ููุท ูพุณ ุงุฒ ุจุงุฒฺฏุดุช ฺฉูุชุฑู ฺฉููุฏู ูููู ุงุฏุงูู ู ุงุจุฏ. ุจูุงุจุฑุงู ฺฉู ุณุณุชู ููฺฏ ุงุณุช.</p>
<h3 id="yjd-bnbst"><a class="zola-anchor" href="index.html#yjd-bnbst" aria-label="Anchor link for: yjd-bnbst">๐</a>ุงุฌุงุฏ ุจูโุจุณุช</h3>
<p>ูุง ู ุชูุงูู ุจุง ฺุงูพ ฺุฒ ุฏุฑ ุญููู ุฏุฑ ุงูุชูุง ุชุงุจุน <code>start_</code> ุฎูุฏ ุ ุจู ุฑุงุญุช ฺูู ุจูโุจุณุชโุง ุฏุฑ ูุณุชู ุฎูุฏ ุงุฌุงุฏ ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    [โฆ]
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{
</span><span>        </span><span style="color:#569cd6;">use </span><span>blog_os::print;
</span><span>        print!(</span><span style="color:#d69d85;">&quot;-&quot;</span><span>);        </span><span style="color:#608b4e;">// new
</span><span>    }
</span><span>}
</span></code></pre>
<p>ููุช ุขู ุฑุง ุฏุฑ QEMU ุงุฌุฑุง ู ฺฉูู ุ ุฎุฑูุฌ ุจู ุญุงูุช ุฒุฑ ุฏุฑุงูุช ูโฺฉูู:</p>
<p><img src="qemu-deadlock.png" alt="QEMU output with many rows of hyphens and no dots" /></p>
<p>ู ุจูู ฺฉู ููุท ุชุนุฏุงุฏ ูุญุฏูุฏ ุฎุท ูุงุตูู ุ ุชุง ุฒูุงู ฺฉู ูููู ุชุงูุฑ ุงูู ุงุชูุงู ุจูุชุฏุ ฺุงูพ ู ุดูุฏ. ุณูพุณ ุณุณุชู ููฺฏ ูโฺฉูุฏ ุฒุฑุง ุชุงูุฑ ููฺฏุงู ุชูุงุด ุจุฑุง ฺุงูพ ฺฉ ููุทู ุจุงุนุซ ุจูโุจุณุช ูโุดูุฏ. ุจู ููู ุฏูู ุงุณุช ฺฉู ุฏุฑ ุฎุฑูุฌ ููู ูฺ ููุทูโุง ูุดุงูุฏู ููโฺฉูู.</p>
<p>ุชุนุฏุงุฏ ูุงูุน ุฎุท ูุงุตูู ุจู ูุฑ ุงุฌุฑุง ูุชูุงูุช ุงุณุช ุฒุฑุง ูููู ุชุงูุฑ ุจู ุตูุฑุช ุบุฑ ููุฒูุงู ุงูุฌุงู ู ุดูุฏ. ุงู ุนุฏู ูุทุนุชุ ุงุดฺฉุงู ุฒุฏุง ุงุดฺฉุงูุงุช ูุฑุจูุท ุจู ููุฑููุฏ ุฑุง ุจุณุงุฑ ุฏุดูุงุฑ ู ฺฉูุฏ.</p>
<h3 id="rf-bnbst"><a class="zola-anchor" href="index.html#rf-bnbst" aria-label="Anchor link for: rf-bnbst">๐</a>ุฑูุน ุจูโุจุณุช</h3>
<p>ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงู ุจูโุจุณุช ุ ุชุง ุฒูุงู ฺฉู <code>Mutex</code> ููู ุดุฏู ุจุงุดุฏุ ู ุชูุงูู ููููโูุง ุฑุง ุบุฑูุนุงู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span style="color:#608b4e;">/// Prints the given formatted string to the VGA text buffer
</span><span style="color:#608b4e;">/// through the global `WRITER` instance.
</span><span>#[doc(hidden)]
</span><span style="color:#569cd6;">pub fn </span><span>_print(args: fmt::Arguments) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::interrupts;   </span><span style="color:#608b4e;">// new
</span><span>
</span><span>    interrupts::without_interrupts(|| {     </span><span style="color:#608b4e;">// new
</span><span>        </span><span style="color:#b4cea8;">WRITER</span><span>.lock().write_fmt(args).unwrap();
</span><span>    });
</span><span>}
</span></code></pre>
<p>ุชุงุจุน <a href="https://docs.rs/x86_64/0.14.2/x86_64/instructions/interrupts/fn.without_interrupts.html"><code>without_interrupts</code></a> ฺฉ <a href="https://doc.rust-lang.org/book/second-edition/ch13-01-closures.html">ฺฉููฺุฑ</a> ุฑุง ฺฏุฑูุชู ู ุขู ุฑุง ุฏุฑ ฺฉ ูุญุท ุจุฏูู ูููู ุงุฌุฑุง ู ฺฉูุฏ. ูุง ุงุฒ ุขู ุงุณุชูุงุฏู ู ฺฉูู ุชุง ุงุทููุงู ุญุงุตู ฺฉูู ฺฉู ุชุง ุฒูุงู ฺฉู <code>Mutex</code> ููู ุดุฏู ุงุณุช ุ ูฺ ูููู ุง ุฑุฎ ูู ุฏูุฏ. ุงฺฉููู ููฺฏุงู ฺฉู ูุณุชู ุฑุง ุงุฌุฑุง ู ฺฉูู ุ ู ุจูู ฺฉู ุขู ุจุฏูู ููฺฏ ฺฉุฑุฏู ุจู ฺฉุงุฑ ุฎูุฏ ุงุฏุงูู ู ุฏูุฏ. (ูุง ูููุฒ ูฺ ููุทู ุง ุฑุง ูุดุงูุฏู ูู ฺฉูู ุ ุงูุง ุงู ุจู ุงู ุฏูู ุงุณุช ฺฉู ุณุฑุนุช ุญุฑฺฉุช ุขููุง ุจุณุงุฑ ุณุฑุน ุงุณุช. ุณุน ฺฉูุฏ ุณุฑุนุช ฺุงูพ ุฑุง ฺฉู ฺฉูุฏุ ูุซูุงู ุจุง ูุฑุงุฑ ุฏุงุฏู <code>for _ in 0..10000 {}</code> ุฏุฑ ุฏุงุฎู ุญููู.)</p>
<p>ูุง ู ุชูุงูู ููู ุชุบุฑ ุฑุง ุฏุฑ ุชุงุจุน ฺุงูพ ุณุฑุงู ูุฒ ุงุนูุงู ฺฉูู ุชุง ุงุทููุงู ุญุงุตู ฺฉูู ฺฉู ูฺ ุจูโุจุณุช ุฏุฑ ุขู ุฑุฎ ูู ุฏูุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/serial.rs
</span><span>
</span><span>#[doc(hidden)]
</span><span style="color:#569cd6;">pub fn </span><span>_print(args: ::core::fmt::Arguments) {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::interrupts;       </span><span style="color:#608b4e;">// new
</span><span>
</span><span>    interrupts::without_interrupts(|| {         </span><span style="color:#608b4e;">// new
</span><span>        </span><span style="color:#b4cea8;">SERIAL1
</span><span>            .lock()
</span><span>            .write_fmt(args)
</span><span>            .expect(</span><span style="color:#d69d85;">&quot;Printing to serial failed&quot;</span><span>);
</span><span>    });
</span><span>}
</span></code></pre>
<p>ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุบุฑูุนุงู ฺฉุฑุฏู ููููโูุง ูุจุงุฏ ฺฉ ุฑุงู ุญู ฺฉู ุจุงุดุฏ. ูุดฺฉู ุงู ุงุณุช ฺฉู ุจุฏุชุฑู ุญุงูุช ุชุฃุฎุฑ ุฏุฑ ูููู ุฑุง ุงูุฒุงุด ู ุฏูุฏ ุ ุนู ุฒูุงู ฺฉู ุณุณุชู ุจู ูููู ูุงฺฉูุด ูุดุงู ู ุฏูุฏ. ุจูุงุจุฑุงู ููููโูุง ุจุงุฏ ููุท ุจุฑุง ูุฏุช ุฒูุงู ฺฉูุชุงู ุบุฑูุนุงู ุดููุฏ.</p>
<h2 id="rf-wd-yt-rqbty"><a class="zola-anchor" href="index.html#rf-wd-yt-rqbty" aria-label="Anchor link for: rf-wd-yt-rqbty">๐</a>ุฑูุน ูุถุนุช ุฑูุงุจุช</h2>
<p>ุงฺฏุฑ <code>cargo test</code> ุฑุง ุงุฌุฑุง ฺฉูุฏ ุ ููฺฉู ุงุณุช ุจุจูุฏ ุชุณุช <code>test_println_output</code> ุจุง ุดฺฉุณุช ููุงุฌู ูโุดูุฏ:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>&gt; cargo test --lib
</span><span>[โฆ]
</span><span>Running 4 tests
</span><span>test_breakpoint_exception...[ok]
</span><span>test_println... [ok]
</span><span>test_println_many... [ok]
</span><span>test_println_output... [failed]
</span><span>
</span><span>Error: panicked at &#39;assertion failed: `(left == right)`
</span><span>  left: `&#39;.&#39;`,
</span><span> right: `&#39;S&#39;`&#39;, src/vga_buffer.rs:205:9
</span></code></pre>
<p>ุฏูู ุขู ูุฌูุฏ ฺฉ <em>ูุถุนุช ุฑูุงุจุช</em> ุจู ุชุณุช ู ฺฉูุชุฑู ฺฉููุฏู ุชุงูุฑ ูุงุณุช. ุงฺฏุฑ ุจู ุงุฏ ุฏุงุดุชู ุจุงุดุฏ ุ ุชุณุช ุจู ุงู ุดฺฉู ุงุณุช:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println_output() {
</span><span>    </span><span style="color:#569cd6;">let</span><span> s = </span><span style="color:#d69d85;">&quot;Some test string that fits on a single line&quot;</span><span>;
</span><span>    println!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, s);
</span><span>    </span><span style="color:#569cd6;">for </span><span>(i, c) </span><span style="color:#569cd6;">in</span><span> s.chars().enumerate() {
</span><span>        </span><span style="color:#569cd6;">let</span><span> screen_char = </span><span style="color:#b4cea8;">WRITER</span><span>.lock().buffer.chars[</span><span style="color:#b4cea8;">BUFFER_HEIGHT </span><span>- </span><span style="color:#b5cea8;">2</span><span>][i].read();
</span><span>        assert_eq!(</span><span style="color:#569cd6;">char</span><span>::from(screen_char.ascii_character), c);
</span><span>    }
</span><span>}
</span></code></pre>
<p>ุงู ุชุณุช ฺฉ ุฑุดุชู ุฑุง ุฏุฑ ุจุงูุฑ VGA ฺุงูพ ู ฺฉูุฏ ู ุณูพุณ ุจุง ูพูุงุด ุฏุณุช ุฑู ุขุฑุงู <code>buffer_chars</code> ุฎุฑูุฌ ุฑุง ุจุฑุฑุณ ู ฺฉูุฏ. ูุถุนุช ุฑูุงุจุช ุฑุฎ ู ุฏูุฏ ุฒุฑุง ููฺฉู ุงุณุช ฺฉูุชุฑู ฺฉููุฏู ูููู ุชุงูุฑ ุจู <code>println</code> ู ุฎูุงูุฏู ฺฉุงุฑุงฺฉุชุฑ ูุง ุตูุญู ุงุฌุฑุง ุดูุฏ. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุงู ฺฉ ุฑูุงุจุช ุฏุงุฏู(Data race) ุฎุทุฑูุงฺฉ ูุณุชุ ฺฉู Rust ุฏุฑ ุฒูุงู ฺฉุงููพุงู ฺฉุงููุงู ุงุฒ ุขู ุฌููฺฏุฑ ฺฉูุฏ. ุจุฑุง ุฌุฒุฆุงุช ุจู <a href="https://doc.rust-lang.org/nomicon/races.html"><em>Rustonomicon</em></a> ูุฑุงุฌุนู ฺฉูุฏ.</p>
<p>ุจุฑุง ุฑูุน ุงู ูุดฺฉู ุ ุจุงุฏ <code>WRITER</code> ุฑุง ุจุฑุง ูุฏุช ุฒูุงู ฺฉุงูู ุชุณุช ููู ูฺฏู ุฏุงุฑู ุ ุจู ุงู ุชุฑุชุจ ฺฉู ฺฉูุชุฑู ฺฉููุฏู ุชุงูุฑ ูู ุชูุงูุฏ <code>.</code> ุฑุง ุฑู ุตูุญู ููุงุด ุฏุฑ ูุงู ฺฉุงุฑ ุชุณุช ุจููุณุฏ. ุชุณุช ุงุตูุงุญ ุดุฏู ุจู ุงู ุดฺฉู ุงุณุช:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/vga_buffer.rs
</span><span>
</span><span>#[test_case]
</span><span style="color:#569cd6;">fn </span><span>test_println_output() {
</span><span>    </span><span style="color:#569cd6;">use </span><span>core::fmt::Write;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::interrupts;
</span><span>
</span><span>    </span><span style="color:#569cd6;">let</span><span> s = </span><span style="color:#d69d85;">&quot;Some test string that fits on a single line&quot;</span><span>;
</span><span>    interrupts::without_interrupts(|| {
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> writer = </span><span style="color:#b4cea8;">WRITER</span><span>.lock();
</span><span>        writeln!(writer, </span><span style="color:#d69d85;">&quot;</span><span style="color:#e3bbab;">\n</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, s).expect(</span><span style="color:#d69d85;">&quot;writeln failed&quot;</span><span>);
</span><span>        </span><span style="color:#569cd6;">for </span><span>(i, c) </span><span style="color:#569cd6;">in</span><span> s.chars().enumerate() {
</span><span>            </span><span style="color:#569cd6;">let</span><span> screen_char = writer.buffer.chars[</span><span style="color:#b4cea8;">BUFFER_HEIGHT </span><span>- </span><span style="color:#b5cea8;">2</span><span>][i].read();
</span><span>            assert_eq!(</span><span style="color:#569cd6;">char</span><span>::from(screen_char.ascii_character), c);
</span><span>        }
</span><span>    });
</span><span>}
</span></code></pre>
<p>ูุง ุชุบุฑุงุช ุฒุฑ ุฑุง ุงูุฌุงู ุฏุงุฏู:</p>
<ul>
<li>ูุง ุจุง ุงุณุชูุงุฏู ุตุฑุญ ุงุฒ ูุชุฏ <code>()lock</code> ุ ููุณูุฏู ุฑุง ุจุฑุง ฺฉู ุชุณุช ููู ู ฺฉูู. ุจู ุฌุง <code>println</code> ุ ุงุฒ ูุงฺฉุฑู <a href="https://doc.rust-lang.org/core/macro.writeln.html"><code>writeln</code></a> ุงุณุชูุงุฏู ู ฺฉูู ฺฉู ุงูฺฉุงู ฺุงูพ ุจุฑ ุฑู ููุณูุฏู ูุจูุงู ููู ุดุฏู ุฑุง ูุฑุงูู ู ฺฉูุฏ.</li>
<li>ุจุฑุง ุฌููฺฏุฑ ุงุฒ ฺฉ ุจูโุจุณุช ุฏฺฏุฑ ุ ููููโูุง ุฑุง ุจุฑุง ูุฏุช ุฒูุงู ุชุณุช ุบุฑูุนุงู ู ฺฉูู. ุฏุฑ ุบุฑ ุงู ุตูุฑุช ููฺฉู ุงุณุช ุชุณุช ุฏุฑ ุญุงู ฺฉู ููุณูุฏู ูููุฒ ููู ุงุณุช ูุทุน ุดูุฏ.</li>
<li>ุงุฒ ุขูุฌุง ฺฉู ฺฉูุชุฑู ฺฉููุฏู ูููู ุชุงูุฑ ูููุฒ ู ุชูุงูุฏ ูุจู ุงุฒ ุชุณุช ุงุฌุฑุง ุดูุฏ ุ ูุจู ุงุฒ ฺุงูพ ุฑุดุชู <code>s</code> ฺฉ ุฎุท ุฌุฏุฏ <code>n\</code> ุงุถุงู ฺุงูพ ู ฺฉูู. ุจู ุงู ุชุฑุชุจ ุ ุงฺฏุฑ ฺฉู ฺฉูุชุฑู ฺฉููุฏู ุชุงูุฑ ุชุนุฏุงุฏ ฺฉุงุฑุงฺฉุชุฑ <code>.</code> ุฑุง ุฏุฑ ุฎุท ูุนู ฺุงูพ ฺฉุฑุฏู ุจุงุดุฏุ ุงุฒ ุดฺฉุณุช ุชุณุช ุฌููฺฏุฑ ู ฺฉูู.</li>
</ul>
<p>ุงฺฉููู ุจุง ุชุบุฑุงุช ููู ุ <code>cargo test</code> ุฏูุจุงุฑู ุจุง ูุทุนุช ูููู ู ุดูุฏ.</p>
<p>ุงู ฺฉ ูุถุนุช ุฑูุงุจุช ุจุณุงุฑ ุจ ุฎุทุฑ ุจูุฏ ฺฉู ููุท ุจุงุนุซ ุดฺฉุณุช ุชุณุช ูโุดุฏ. ููุงูุทูุฑ ฺฉู ู ุชูุงูุฏ ุชุตูุฑ ฺฉูุฏุ ุงุดฺฉุงู ุฒุฏุง ุณุงุฑ ูุถุนุชโูุง ุฑูุงุจุช ุจู ุฏูู ูุงูุช ุบุฑ ูุทุน ุจูุฏู ุขููุง ุจุณุงุฑ ุฏุดูุงุฑุชุฑ ุงุณุช. ุฎูุดุจุฎุชุงููุ ุฑุงุณุช ูุงูุน ุงุฒ ุฑูุงุจุช ุฏุงุฏูโูุง ู ุดูุฏ ุ ฺฉู ุฌุฏโุชุฑู ููุน ูุถุนุช ุฑูุงุจุช ุงุณุช ุ ุฒุฑุง ู ุชูุงูุฏ ุจุงุนุซ ุงููุงุน ุฑูุชุงุฑูุง ุชุนุฑู ูุดุฏู ุ ุงุฒ ุฌููู ฺฉุฑุด ฺฉุฑุฏู ุณุณุชู ู ุฎุฑุงุจ ุดุฏู ุขุฑุงู ู ุจ ุตุฏุง ุญุงูุธู ุดูุฏ.</p>
<h2 id="dstwrl-ml-hlt"><a class="zola-anchor" href="index.html#dstwrl-ml-hlt" aria-label="Anchor link for: dstwrl-ml-hlt">๐</a>ุฏุณุชูุฑุงูุนูู <code>hlt</code></h2>
<p>ุชุงฺฉููู ุงุฒ ฺฉ ุญููู ุฎุงู ุณุงุฏู ุฏุฑ ูพุงุงู ุชูุงุจุน <code>start_</code> ู<code> panic</code> ุงุณุชูุงุฏู ู ฺฉุฑุฏู. ุงู ุจุงุนุซ ู ุดูุฏ ูพุฑุฏุงุฒูุฏู ุจู ุทูุฑ ุจ ูููู ุจฺุฑุฎุฏ ู ุจูุงุจุฑุงู ูุทุงุจู ุงูุชุธุงุฑ ุนูู ู ฺฉูุฏ. ุงูุง ุจุณุงุฑ ูุงฺฉุงุฑุขูุฏ ุงุณุชุ ุฒุฑุง ูพุฑุฏุงุฒูุฏู ููฺูุงู ุจุง ุณุฑุนุช ฺฉุงูู ฺฉุงุฑ ู ฺฉูุฏ ุญุช ุงฺฏุฑ ฺฉุงุฑ ุจุฑุง ุงูุฌุงู ูุฏุงุดุชู ุจุงุดุฏ. ููฺฏุงู ฺฉู ูุณุชู ุฑุง ุงุฌุฑุง ู ฺฉูุฏ ู ุชูุงูุฏ ุงู ูุดฺฉู ุฑุง ุฏุฑ ูุฏุฑ ูุธูู ุฎูุฏ ูุดุงูุฏู ฺฉูุฏ: ูุฑุงูุฏ QEMU ุฏุฑ ฺฉู ูุฏุช ุฒูุงู ูุงุฒ ุจู ุชูุฑุจุงู 100ูช ูพุฑุฏุงุฒูุฏู ุฏุงุฑุฏ.</p>
<p>ฺฉุงุฑ ฺฉู ูุงูุนุงู ู ุฎูุงูู ุงูุฌุงู ุฏูู ุงู ุงุณุช ฺฉู ูพุฑุฏุงุฒูุฏู ุฑุง ุชุง ุฑุณุฏู ูููู ุจุนุฏ ูุชููู ฺฉูู. ุงู ุงุฌุงุฒู ู ุฏูุฏ ูพุฑุฏุงุฒูุฏู ูุงุฑุฏ ุญุงูุช ุฎูุงุจ ุดูุฏ ฺฉู ุฏุฑ ุขู ุงูุฑฺ ุจุณุงุฑ ฺฉูุชุฑ ูุตุฑู ู ฺฉูุฏ. <a href="https://en.wikipedia.org/wiki/HLT_(x86_instruction)">ุฏุณุชูุฑุงูุนูู <code>hlt</code></a> ุฏููุงู ููู ฺฉุงุฑ ุฑุง ู ฺฉูุฏ. ุจุงุฏ ุงุฒ ุงู ุฏุณุชูุฑุงูุนูู ุจุฑุง ุงุฌุงุฏ ฺฉ ุญููู ุจ ูพุงุงู ุจุง ูุตุฑู ุงูุฑฺ ูพุงู ุงุณุชูุงุฏู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>hlt_loop() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    </span><span style="color:#569cd6;">loop </span><span>{
</span><span>        x86_64::instructions::hlt();
</span><span>    }
</span><span>}
</span></code></pre>
<p>ุชุงุจุน <code>instructions::hlt</code> ููุท ฺฉ <a href="https://github.com/rust-osdev/x86_64/blob/5e8e218381c5205f5777cb50da3ecac5d7e3b1ab/src/instructions/mod.rs#L16-L22">ูพูุดุด ูุงุฒฺฉ</a> ุจุฑ ุฑู ุฏุณุชูุฑุงูุนูู ุงุณูุจู ุงุณุช. ุงู ุจ ุฎุทุฑ ุงุณุช ุฒุฑุง ุจู ูฺ ูุฌู ูู ุชูุงูุฏ ุงูู ุญุงูุธู ุฑุง ุจู ุฎุทุฑ ุจูุฏุงุฒุฏ.</p>
<p>ุงฺฉููู ู ุชูุงูู ุงุฒ ุงู <code>hlt_loop</code> ุจู ุฌุง ุญููู ูุง ุจ ูพุงุงู ุฏุฑ ุชูุงุจุน<code> start_</code> ู <code>panic</code> ุงุณุชูุงุฏู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/main.rs
</span><span>
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    [โฆ]
</span><span>
</span><span>    println!(</span><span style="color:#d69d85;">&quot;It did not crash!&quot;</span><span>);
</span><span>    blog_os::hlt_loop();            </span><span style="color:#608b4e;">// new
</span><span>}
</span><span>
</span><span>
</span><span>#[cfg(not(test))]
</span><span>#[panic_handler]
</span><span style="color:#569cd6;">fn </span><span>panic(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    println!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    blog_os::hlt_loop();            </span><span style="color:#608b4e;">// new
</span><span>}
</span><span>
</span></code></pre>
<p>ุจุงุฏ <code>lib.rs</code> ุฑุง ูุฒ ุจู ุฑูุฒ ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/lib.rs
</span><span>
</span><span style="color:#608b4e;">/// Entry point for `cargo test`
</span><span>#[cfg(test)]
</span><span>#[no_mangle]
</span><span style="color:#569cd6;">pub extern </span><span style="color:#d69d85;">&quot;C&quot; </span><span style="color:#569cd6;">fn </span><span>_start() -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    init();
</span><span>    test_main();
</span><span>    hlt_loop();         </span><span style="color:#608b4e;">// new
</span><span>}
</span><span>
</span><span style="color:#569cd6;">pub fn </span><span>test_panic_handler(info: </span><span style="color:#569cd6;">&amp;</span><span>PanicInfo) -&gt; </span><span style="color:#569cd6;">! </span><span>{
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;[failed]</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>);
</span><span>    serial_println!(</span><span style="color:#d69d85;">&quot;Error: {}</span><span style="color:#e3bbab;">\n</span><span style="color:#d69d85;">&quot;</span><span>, info);
</span><span>    exit_qemu(QemuExitCode::Failed);
</span><span>    hlt_loop();         </span><span style="color:#608b4e;">// new
</span><span>}
</span></code></pre>
<p>ุงฺฉููู ููุช ูุณุชู ุฎูุฏ ุฑุง  ุฏุฑ QEMU ุงุฌุฑุง ู ฺฉูู ุ ุดุงูุฏ ุงุณุชูุงุฏู ุจุณุงุฑ ฺฉูุชุฑ ุงุฒ ูพุฑุฏุงุฒูุฏู ูุณุชู.</p>
<h2 id="wrwdy-sfhh-khlyd"><a class="zola-anchor" href="index.html#wrwdy-sfhh-khlyd" aria-label="Anchor link for: wrwdy-sfhh-khlyd">๐</a>ูุฑูุฏ ุตูุญู ฺฉูุฏ</h2>
<p>ุงฺฉููู ฺฉู ูุงุฏุฑ ุจู ูุฏุฑุช ูููู ูุง ุฏุณุชฺฏุงู ูุง ุฎุงุฑุฌ ูุณุชู ุ ุณุฑุงูุฌุงู ูุงุฏุฑ ุจู ูพุดุชุจุงู ุงุฒ ูุฑูุฏ ุตูุญู ฺฉูุฏ ูุณุชู. ุงู ุจู ูุง ุงูฺฉุงู ู ุฏูุฏ ุจุฑุง ุงููู ุจุงุฑ ุจุง ูุณุชู ุฎูุฏ ุชุนุงูู ุฏุงุดุชู ุจุงุดู.</p>
<aside class="post_aside">
<p>ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูุง ููุท ูุญูู ูุฏุฑุช ุตูุญู ฺฉูุฏูุง <a href="https://en.wikipedia.org/wiki/PS/2_port">PS/2</a> ุฑุง ุชูุถุญ ู ุฏูู ุ ูู ุตูุญู ฺฉูุฏูุง USB. ูุฑ ฺูุฏ ฺฉูุ ูุงุฏุฑุจูุฑุฏ ุตูุญู ฺฉูุฏูุง USB ุฑุง ุจู ุนููุงู ุฏุณุชฺฏุงู ูุง PS/2 ุจุฑุง ูพุดุชุจุงู ุงุฒ ูุฑู ุงูุฒุงุฑูุง ูุฏู ุชููุฏ ูโฺฉูุฏ ุ ุจูุงุจุฑุงู ุชุง ุฒูุงู ฺฉู ูุณุชู ูุง ุงุฒ USB ูพุดุชุจุงู ููโฺฉูุฏ ู ุชูุงูู ุจุง ุงุทููุงู ุงุฒ ุตูุญู ฺฉูุฏูุง USB ฺุดู ูพูุด ฺฉูู.</p>
</aside>
<p>ูุงููุฏ ุชุงูุฑ ุณุฎุช ุงูุฒุงุฑ ุ ฺฉูุชุฑู ฺฉููุฏู ุตูุญู ฺฉูุฏ ูุฒ ุจู ุทูุฑ ูพุด ูุฑุถ ุงุฒ ูุจู ูุนุงู ุดุฏู ุงุณุช. ุจูุงุจุฑุงู ุจุง ูุดุงุฑ ุฏุงุฏู ฺฉ ฺฉูุฏ ุ ฺฉูุชุฑู ฺฉููุฏู ุตูุญู ฺฉูุฏ ูููู ุฑุง ุจู PIC ุงุฑุณุงู ู ฺฉูุฏ ู ุขู ุฑุง ุจู ูพุฑุฏุงุฒูุฏู ููุชูู ู ฺฉูุฏ. ูพุฑุฏุงุฒูุฏู ุจู ุฏูุจุงู ฺฉ ุชุงุจุน ฺฉูุชุฑู ฺฉููุฏู ุฏุฑ IDT ูโฺฏุฑุฏุฏ ุ ุงูุง ุงุชู ูุฑุจูุทู ุฎุงู ุงุณุช. ุจูุงุจุฑุงู ฺฉ ุฎุทุง ุฏูฺฏุงูู ุฑุฎ ู ุฏูุฏ.</p>
<p>ูพุณ ุจุงุฏ ฺฉ ุชุงุน ฺฉูุชุฑู ฺฉููุฏู ุจุฑุง ูููู ุตูุญู ฺฉูุฏ ุงุถุงูู ฺฉูู. ุงู ฺฉุงููุงู ูุดุงุจู ูุญูู ุชุนุฑู ฺฉูุชุฑู ฺฉููุฏู ุจุฑุง ูููู ุชุงูุฑ ุงุณุช ุ ููุท ุงุฒ ฺฉ ุดูุงุฑู ูููู ูุชูุงูุช ุงุณุชูุงุฏู ู ฺฉูุฏ:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span>#[derive(Debug, Clone, Copy)]
</span><span>#[repr(u8)]
</span><span style="color:#569cd6;">pub enum </span><span>InterruptIndex {
</span><span>    Timer = </span><span style="color:#b4cea8;">PIC_1_OFFSET</span><span>,
</span><span>    Keyboard, </span><span style="color:#608b4e;">// new
</span><span>}
</span><span>
</span><span>lazy_static! {
</span><span>    </span><span style="color:#569cd6;">static ref </span><span style="color:#b4cea8;">IDT</span><span>: InterruptDescriptorTable = {
</span><span>        </span><span style="color:#569cd6;">let mut</span><span> idt = InterruptDescriptorTable::new();
</span><span>        idt.breakpoint.set_handler_fn(breakpoint_handler);
</span><span>        [โฆ]
</span><span>        </span><span style="color:#608b4e;">// new
</span><span>        idt[InterruptIndex::Keyboard.as_usize()]
</span><span>            .set_handler_fn(keyboard_interrupt_handler);
</span><span>
</span><span>        idt
</span><span>    };
</span><span>}
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    print!(</span><span style="color:#d69d85;">&quot;k&quot;</span><span>);
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p>ููุงูุทูุฑ ฺฉู ุฏุฑ ุดฺฉู <a href="index.html#the-8259-pic">ุจุงูุง</a> ูุดุงูุฏู ู ฺฉูู ุ ุตูุญู ฺฉูุฏ ุงุฒ ุฎุท 1 ุฏุฑ PIC ุงุตู ุงุณุชูุงุฏู ู ฺฉูุฏ. ุงู ุจู ุงู ูุนู ุงุณุช ฺฉู ุจู ุตูุฑุช ูููู 33 (1 + ุงูุณุช 32) ุจู ูพุฑุฏุงุฒูุฏู ู ุฑุณุฏ. ูุง ุงู ุงูุฏฺฉุณ ุฑุง ุจู ุนููุงู ฺฉ ููุน ุฌุฏุฏ <code>Keyboard</code> ุจู ุงโูุงู <code>InterruptIndex</code> ุงุถุงูู ู ฺฉูู. ูุงุฒ ูุณุช ฺฉู ููุฏุงุฑ ุฑุง ุตุฑุญุงู ูุดุฎุต ฺฉูู ุ ุฒุฑุง ุงู ููุฏุงุฑ ุจู ุทูุฑ ูพุด ูุฑุถ ุจุฑุงุจุฑ ููุฏุงุฑ ูุจู ุจุนูุงูู ฺฉ ฺฉู 33 ูุฒ ู ุจุงุดุฏ ุ ูุณุช. ุฏุฑ ฺฉูุชุฑู ฺฉููุฏู ูููู ุ ูุง ฺฉ <code>k</code> ฺุงูพ ู ฺฉูู ู ุณฺฏูุงู ูพุงุงู ูููู ุฑุง ุจู ฺฉูุชุฑู ฺฉููุฏู ูููู ู ูุฑุณุชู.</p>
<p>ุงฺฉููู ู ุจูู ฺฉู ููุช ฺฉูุฏ ุฑุง ูุดุงุฑ ู ุฏูู <code>k</code> ุจุฑ ุฑู ุตูุญู ุธุงูุฑ ู ุดูุฏ. ุจุง ุงู ุญุงู ุ ุงู ููุท ุจุฑุง ุงููู ฺฉูุฏ ฺฉู ูุดุงุฑ ู ุฏูู ฺฉุงุฑ ู ฺฉูุฏ ุ ุญุช ุงฺฏุฑ ุจู ูุดุงุฑ ุฏุงุฏู ฺฉูุฏูุง ุงุฏุงูู ุฏูู ุ ุฏฺฏุฑ <code>k</code> ุจุฑ ุฑู ุตูุญู ููุงุด ุธุงูุฑ ูู ุดูุฏ. ุงู ุงูุฑ ุจู ุงู ุฏูู ุงุณุช ฺฉู ฺฉูุชุฑู ฺฉููุฏู ุตูุญู ฺฉูุฏ ุชุง ุฒูุงู ฺฉู ุงุตุทูุงุญุงู <em>scancode</em> ุฑุง ูุฎูุงูู ุ ูููู ุฏฺฏุฑ ุงุฑุณุงู ูู ฺฉูุฏ.</p>
<h3 id="khwndn-skhnkhd-h"><a class="zola-anchor" href="index.html#khwndn-skhnkhd-h" aria-label="Anchor link for: khwndn-skhnkhd-h">๐</a>ุฎูุงูุฏู ุงุณฺฉูโฺฉุฏ ูุง</h3>
<p>ุจุฑุง ุงูฺฉู ุจูููู <em>ฺฉุฏุงู</em> ฺฉูุฏ ูุดุงุฑ ุฏุงุฏู ุดุฏู ุงุณุช ุ ุจุงุฏ ฺฉูุชุฑู ฺฉููุฏู ุตูุญู ฺฉูุฏ ุฑุง ุฌุณุชุฌู ฺฉูู. ูุง ุงู ฺฉุงุฑ ุฑุง ุจุง ุฎูุงูุฏู ุงุฒ ูพูุฑุช ุฏุงุฏู ฺฉูุชุฑู ฺฉููุฏู PS/2 ุ ฺฉู <a href="../../testing/index.html#i-o-ports">ูพูุฑุช ูุฑูุฏ/ุฎุฑูุฌ</a> ุจุง ุดูุงุฑู <code>0x60</code> ุงุณุช ุ ุงูุฌุงู ู ุฏูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0x60</span><span>);
</span><span>    </span><span style="color:#569cd6;">let</span><span> scancode: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#569cd6;">unsafe </span><span>{ port.read() };
</span><span>    print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, scancode);
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p>ูุง ุจุฑุง ุฎูุงูุฏู ฺฉ ุจุงุช ุงุฒ ูพูุฑุช ุฏุงุฏู ุตูุญู ฺฉูุฏ ุงุฒ ููุน <a href="https://docs.rs/x86_64/0.14.2/x86_64/instructions/port/struct.Port.html"><code>Port</code></a> ฺฉุฑุช <code>x86_64</code> ุงุณุชูุงุฏู ูโฺฉูู. ุงู ุจุงุช <a href="https://en.wikipedia.org/wiki/Scancode"><em>ุงุณฺฉู ฺฉุฏ</em></a> ูุงูุฏู ู ุดูุฏ ู ุนุฏุฏ ุงุณุช ฺฉู ฺฉูุฏ ูุดุฑุฏู ุดุฏู / ุฑูุง ุดุฏู ุฑุง ูุดุงู ู ุฏูุฏ. ูุง ูููุฒ ฺฉุงุฑ ุจุง ุงุณฺฉู ฺฉุฏ ุงูุฌุงู ูู ุฏูู ุ ููุท ุขู ุฑุง ุฑู ุตูุญู ฺุงูพ ู ฺฉูู:</p>
<p><img src="qemu-printing-scancodes.gif" alt="QEMU printing scancodes to the screen when keys are pressed" /></p>
<p>ุชุตูุฑ ุจุงูุง ูุดุงู ู ุฏูุฏ ฺฉู ูู ุขุฑุงู ุขุฑุงู โ123โ ุฑุง ุชุงูพ ู ฺฉูู. ู ุจูู ฺฉู ฺฉูุฏูุง ูุฌุงูุฑ ุฏุงุฑุง ุงุณฺฉู ฺฉุฏ ูุฌุงูุฑ ูุณุชูุฏ ู ูุดุงุฑ ุฏุงุฏู ฺฉ ฺฉูุฏ ุฏุงุฑุง ุงุณฺฉู ฺฉุฏ ูุชูุงูุช ุจุง ุฑูุง ฺฉุฑุฏู ุขู ุงุณุช. ุงูุง ฺฺฏููู ุงุณฺฉูโฺฉุฏูุง ุฑุง ุฏููุงู ุจู ฺฉุงุฑ ุงุตู ุขู ฺฉูุฏ ุชุฑุฌูู ฺฉููุ</p>
<h3 id="tfsyr-skhnkhd-h"><a class="zola-anchor" href="index.html#tfsyr-skhnkhd-h" aria-label="Anchor link for: tfsyr-skhnkhd-h">๐</a>ุชูุณุฑ ุงุณฺฉูโฺฉุฏ ูุง</h3>
<p>ุณู ุงุณุชุงูุฏุงุฑุฏ ูุฎุชูู ุจุฑุง ูฺฏุงุดุช ุจู ุงุณฺฉู ฺฉุฏูุง ู ฺฉูุฏูุง ูุฌูุฏ ุฏุงุฑุฏ ุ ุงุตุทูุงุญุงู  <em>ูุฌููุนู ูุง ุงุณฺฉู ฺฉุฏ</em>. ูุฑ ุณู ุจู ุตูุญู ฺฉูุฏ ุฑุงุงูู ูุง ุงููู IBM ุจุฑู ฺฏุฑุฏูุฏ: <a href="https://en.wikipedia.org/wiki/IBM_Personal_Computer_XT">IBM XT</a> ุ <a href="https://en.wikipedia.org/wiki/IBM_3270_PC">IBM 3270 PC</a> ู <a href="https://en.wikipedia.org/wiki/IBM_Personal_Computer/AT">IBM AT</a>. ุฎูุดุจุฎุชุงูู ุฑุงุงูู ูุง ุจุนุฏ ุฑููุฏ ุชุนุฑู ูุฌููุนู ูุง ุฌุฏุฏ ุงุณฺฉู ฺฉุฏ ุฑุง ุงุฏุงูู ูุฏุงุฏูุฏ ุ ุจูฺฉู ูุฌููุนู ูุง ููุฌูุฏ ุฑุง ุชููุฏ ู ุขููุง ุฑุง ฺฏุณุชุฑุด ุฏุงุฏูุฏ. ุงูุฑูุฒู ุจุดุชุฑ ุตูุญู ฺฉูุฏูุง ุฑุง ู ุชูุงู ุจู ฺฏููู ุง ูพฺฉุฑุจูุฏ ฺฉุฑุฏ ฺฉู ุงุฒ ูุฑ ฺฉุฏุงู ุงุฒ ุณู ูุฌููุนู ุชููุฏ ฺฉูุฏ.</p>
<p>ุจู ุทูุฑ ูพุด ูุฑุถ ุ ุตูุญู ฺฉูุฏูุง PS/2 ูุฌููุนู ุดูุงุฑู 1 (โXTโ) ุฑุง ุชููุฏ ู ฺฉููุฏ. ุฏุฑ ุงู ูุฌููุนู ุ 7 ุจุช ูพุงู ุจุงุช ุงุณฺฉูโฺฉุฏุ ฺฉูุฏ ุฑุง ุชุนุฑู ู ฺฉูุฏ ู ูููุชุฑู ุจุช ูุดุฑุฏู (โ0โ) ุง ุฑูุง ฺฉุฑุฏู (โ1โ) ุฑุง ูุดุฎุต ู ฺฉูุฏ. ฺฉูุฏูุง ฺฉู ุฏุฑ ุตูุญู ฺฉูุฏ ุงุตู <a href="https://en.wikipedia.org/wiki/IBM_Personal_Computer_XT">IBM XT</a> ูุฌูุฏ ูุฏุงุดุชูุฏ ุ ูุงููุฏ ฺฉูุฏ enter ุฑู ฺฉโูพุฏ ุ ุฏู ุงุณฺฉู ฺฉุฏ ุจู ุทูุฑ ูุชูุงู ุงุฌุงุฏ ู ฺฉููุฏ: ฺฉ ุจุงุช ูุฑุงุฑ(escape) <code>0xe0</code> ู ุณูพุณ ฺฉ ุจุงุช ููุงุงูฺฏุฑ ฺฉูุฏ. ุจุฑุง ูุดุงูุฏู ูุณุช ุชูุงู ุงุณฺฉูโฺฉุฏูุง ูุฌููุนู 1 ู ฺฉูุฏูุง ูุฑุจูุท ุจู ุขููุง ุ <a href="https://wiki.osdev.org/Keyboard#Scan_Code_Set_1">ูฺฉ OSDev</a> ุฑุง ูุดุงูุฏู ฺฉูุฏ.</p>
<p>ุจุฑุง ุชุฑุฌูู ุงุณฺฉู ฺฉุฏูุง ุจู ฺฉูุฏูุง ุ ู ุชูุงูู ุงุฒ ุนุจุงุฑุช match ุงุณุชูุงุฏู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0x60</span><span>);
</span><span>    </span><span style="color:#569cd6;">let</span><span> scancode: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#569cd6;">unsafe </span><span>{ port.read() };
</span><span>
</span><span>    </span><span style="color:#608b4e;">// new
</span><span>    </span><span style="color:#569cd6;">let</span><span> key = </span><span style="color:#569cd6;">match</span><span> scancode {
</span><span>        </span><span style="color:#b5cea8;">0x02 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;1&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x03 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;2&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x04 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;3&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x05 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;4&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x06 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;5&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x07 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;6&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x08 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;7&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x09 </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;8&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x0a </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;9&#39;</span><span>),
</span><span>        </span><span style="color:#b5cea8;">0x0b </span><span style="color:#569cd6;">=&gt; </span><span>Some(</span><span style="color:#d69d85;">&#39;0&#39;</span><span>),
</span><span>        </span><span style="color:#569cd6;">_ =&gt; </span><span>None,
</span><span>    };
</span><span>    </span><span style="color:#569cd6;">if let </span><span>Some(key) = key {
</span><span>        print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, key);
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p>ฺฉุฏ ุจุงูุง ูุดุฑุฏู ฺฉูุฏูุง ุนุฏุฏ 9-0 ุฑุง ุชุฑุฌูู ฺฉุฑุฏู ู ฺฉูู ฺฉูุฏูุง ุฏฺฏุฑ ุฑุง ูุงุฏุฏู ู ฺฏุฑุฏ. ุงุฒ ุนุจุงุฑุช <a href="https://doc.rust-lang.org/book/ch06-02-match.html">match</a> ุจุฑุง ุงุฎุชุตุงุต ฺฉ ฺฉุงุฑุงฺฉุชุฑ ุง <code>None</code> ุจู ูุฑ ุงุณฺฉู ฺฉุฏ ุงุณุชูุงุฏู ู ฺฉูุฏ. ุณูพุณ ุจุง ุงุณุชูุงุฏู ุงุฒ <a href="https://doc.rust-lang.org/book/ch18-01-all-the-places-for-patterns.html#conditional-if-let-expressions"><code>if let</code></a> ุงูพุดู <code>key</code> ุฑุง ุงุฒ ุจู ู ุจุฑุฏ. ุจุง ุงุณุชูุงุฏู ุงุฒ ููุงู ูุงู ูุชุบุฑ <code>key</code> ุฏุฑ ุงูฺฏู ฺฉู ฺฉ ุฑูุด ูุนููู ุจุฑุง ุงุฒ ุจู ุจุฑุฏู ุงููุงุน<code>Option</code> ุฏุฑ ุฑุงุณุช ุงุณุช ุชุนุฑู ูุจู ุฑุง  <a href="https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html#shadowing">ุณุงู ู ุฒูู</a>.</p>
<p>ุงฺฉููู ู ุชูุงูู ุงุนุฏุงุฏ ุฑุง ุจููุณู:</p>
<p><img src="qemu-printing-numbers.gif" alt="QEMU printing numbers to the screen" /></p>
<p>ุชุฑุฌูู ฺฉูุฏูุง ุฏฺฏุฑ ูุฒ ุจู ููู ุฑูุด ฺฉุงุฑ ู ฺฉูุฏ. ุฎูุดุจุฎุชุงูู ฺฉุฑุช ุง ุจุง ูุงู <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/"><code>pc-keyboard</code></a> ุจุฑุง ุชุฑุฌูู ุงุณฺฉูโฺฉุฏ ูุฌููุนู ูุง ุงุณฺฉูโฺฉุฏ 1 ู 2 ูุฌูุฏ ุฏุงุฑุฏ ุ ุจูุงุจุฑุงู ูุงุฒู ูุณุช ฺฉู ุฎูุฏูุงู ุงู ุฑุง ูพุงุฏู ุณุงุฒ ฺฉูู. ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ฺฉุฑุช ุ ุขู ุฑุง ุจู <code>Cargo.toml</code> ุงุถุงูู ฺฉุฑุฏู ู ุฏุฑ<code>lib.rs</code> ุฎูุฏ ูุงุฑุฏ ู ฺฉูู:</p>
<pre data-lang="toml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#608b4e;"># in Cargo.toml
</span><span>
</span><span>[</span><span style="color:#808080;">dependencies</span><span>]
</span><span style="color:#569cd6;">pc-keyboard </span><span>= </span><span style="color:#d69d85;">&quot;0.5.0&quot;
</span></code></pre>
<p>ุงฺฉููู ูุชูุงูู ุงุฒ ุงู ฺฉุฑุช ุจุฑุง ุจุงุฒ ููุณ <code>keyboard_interrupt_handler</code> ุงุณุชูุงุฏู ฺฉูู:</p>
<pre data-lang="rust" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#608b4e;">// in/src/interrupts.rs
</span><span>
</span><span style="color:#569cd6;">extern </span><span style="color:#d69d85;">&quot;x86-interrupt&quot; </span><span style="color:#569cd6;">fn </span><span>keyboard_interrupt_handler(
</span><span>    _stack_frame: InterruptStackFrame)
</span><span>{
</span><span>    </span><span style="color:#569cd6;">use </span><span>pc_keyboard::{layouts, DecodedKey, HandleControl, Keyboard, ScancodeSet1};
</span><span>    </span><span style="color:#569cd6;">use </span><span>spin::Mutex;
</span><span>    </span><span style="color:#569cd6;">use </span><span>x86_64::instructions::port::Port;
</span><span>
</span><span>    lazy_static! {
</span><span>        </span><span style="color:#569cd6;">static ref </span><span style="color:#b4cea8;">KEYBOARD</span><span>: Mutex&lt;Keyboard&lt;layouts::Us104Key, ScancodeSet1&gt;&gt; =
</span><span>            Mutex::new(Keyboard::new(layouts::Us104Key, ScancodeSet1,
</span><span>                HandleControl::Ignore)
</span><span>            );
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> keyboard = </span><span style="color:#b4cea8;">KEYBOARD</span><span>.lock();
</span><span>    </span><span style="color:#569cd6;">let mut</span><span> port = Port::new(</span><span style="color:#b5cea8;">0x60</span><span>);
</span><span>
</span><span>    </span><span style="color:#569cd6;">let</span><span> scancode: </span><span style="color:#569cd6;">u8 </span><span>= </span><span style="color:#569cd6;">unsafe </span><span>{ port.read() };
</span><span>    </span><span style="color:#569cd6;">if let </span><span>Ok(Some(key_event)) = keyboard.add_byte(scancode) {
</span><span>        </span><span style="color:#569cd6;">if let </span><span>Some(key) = keyboard.process_keyevent(key_event) {
</span><span>            </span><span style="color:#569cd6;">match</span><span> key {
</span><span>                DecodedKey::Unicode(character) </span><span style="color:#569cd6;">=&gt; </span><span>print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>, character),
</span><span>                DecodedKey::RawKey(key) </span><span style="color:#569cd6;">=&gt; </span><span>print!(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{:?}</span><span style="color:#d69d85;">&quot;</span><span>, key),
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#569cd6;">unsafe </span><span>{
</span><span>        </span><span style="color:#b4cea8;">PICS</span><span>.lock()
</span><span>            .notify_end_of_interrupt(InterruptIndex::Keyboard.as_u8());
</span><span>    }
</span><span>}
</span></code></pre>
<p>ูุง ุงุฒ ูุงฺฉุฑู <code>lazy_static</code> ุจุฑุง ุงุฌุงุฏ ฺฉ ุด ุซุงุจุช <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.Keyboard.html"><code>Keyboard</code></a> ูุญุงูุธุช ุดุฏู ุชูุณุท Mutex ุงุณุชูุงุฏู ู ฺฉูู. <code>Keyboard</code> ุฑุง ุจุง ุทุฑุญ ุตูุญู ฺฉูุฏ ุงุงูุงุช ูุชุญุฏู ู ูุฌููุนู ุงุณฺฉู ฺฉุฏ 1 ููุฏุงุฑุฏู ู ฺฉูู. ูพุงุฑุงูุชุฑ <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/enum.HandleControl.html"><code>HandleControl</code></a> ุงุฌุงุฒู ู ุฏูุฏ ุชุง <code>ctrl+[a-z]</code> ุฑุง ุจู ฺฉุงุฑุงฺฉุชุฑ ูุง <code>U+0001</code> ุชุง <code>U+001A</code> ูฺฏุงุดุช ฺฉูู. ูุง ูู ุฎูุงูู ฺูู ฺฉุงุฑ ุงูุฌุงู ุฏูู ุ ุจูุงุจุฑุงู ุงุฒ ฺฏุฒูู <code>Ignore</code> ุจุฑุง ุจุฑุฎูุฑุฏ ุจุง <code>ctrl</code> ูุงููุฏ ฺฉูุฏูุง ุนุงุฏ ุงุณุชูุงุฏู ู ฺฉูู.</p>
<p>ุฏุฑ ูุฑ ูููู ุ Mutex ุฑุง ููู ู ฺฉูู ุ ุงุณฺฉู ฺฉุฏ ุฑุง ุงุฒ ฺฉูุชุฑู ฺฉููุฏู ุตูุญู ฺฉูุฏ ู ุฎูุงูู ู ุขู ุฑุง ุจู ูุชุฏ <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.Keyboard.html#method.add_byte"><code>add_byte</code></a> ููุชูู ู ฺฉูู ุ ฺฉู ุงุณฺฉู ฺฉุฏ ุฑุง ุจู ฺฉ <code>&lt;Option&lt;KeyEvent</code> ุชุฑุฌูู ู ฺฉูุฏ. <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.KeyEvent.html"><code>KeyEvent</code></a> ุญุงู ููุฏ ุงุณุช ูู ุจุงุนุซ ุฑูุฏุงุฏ ุดุฏู ู ุขุง ุงู ฺฉ ุฑูุฏุงุฏ ูุดุฑุฏู ุง ุฑูุง ฺฉุฑุฏู ุจูุฏู ุงุณุช.</p>
<p>ุจุฑุง ุชูุณุฑ ุงู ุฑูุฏุงุฏ ฺฉูุฏ ุ ุขู ุฑุง ุจู ูุชุฏ <a href="https://docs.rs/pc-keyboard/0.5.0/pc_keyboard/struct.Keyboard.html#method.process_keyevent"><code>process_keyevent</code></a> ููุชูู ู ฺฉูู ุ ฺฉู ุฏุฑ ุตูุฑุช ุงูฺฉุงู ุฑูุฏุงุฏ ฺฉูุฏ ุฑุง ุจู ฺฉ ฺฉุงุฑุงฺฉุชุฑ ุชุฑุฌูู ู ฺฉูุฏ. ุจู ุนููุงู ูุซุงู ุ ุจุณุชู ุจู ูุดุฑุฏู ฺฉูุฏ shift ุ ฺฉ ุฑูุฏุงุฏ ูุดุฑุฏู ฺฉูุฏ <code>A</code> ุฑุง ุจู ฺฉ ุญุฑู ฺฉูฺฺฉ <code>a</code> ุง ฺฉ ุญุฑู ุจุฒุฑฺฏ <code>A</code> ุชุฑุฌูู ู ฺฉูุฏ.</p>
<p>ุจุง ุงุณุชูุงุฏู ุงุฒ ุงู ฺฉูุชุฑู ฺฉููุฏู ูููู ุงุตูุงุญ ุดุฏู ุงฺฉููู ู ุชูุงูู ูุชู ุจููุณู:</p>
<p><img src="qemu-typing.gif" alt="Typing โHello Worldโ in QEMU" /></p>
<h3 id="pykhrbndy-sfhh-khlyd"><a class="zola-anchor" href="index.html#pykhrbndy-sfhh-khlyd" aria-label="Anchor link for: pykhrbndy-sfhh-khlyd">๐</a>ูพฺฉุฑุจูุฏ ุตูุญู ฺฉูุฏ</h3>
<p>ุงูฺฉุงู ูพฺฉุฑุจูุฏ ุจุฑุฎ ุงุฒ ุฌูุจู ูุง ุตูุญู ฺฉูุฏ PS/2 ูุฌูุฏ ุฏุงุฑุฏุ ุจู ุนููุงู ูุซุงู ุงุฒ ฺฉุฏุงู ุงุณฺฉู ฺฉุฏ ุงุณุชูุงุฏู ฺฉูุฏ. ูุง ุฏุฑ ุงูุฌุง ุจู ุขู ูู ูพุฑุฏุงุฒู ุฒุฑุง ุงู ูพุณุช ุจู ุงูุฏุงุฒู ฺฉุงู ุทููุงู ุดุฏู ุงุณุช ุ ุงูุง ูฺฉ OSDev ุฏุงุฑุง ููุง ฺฉู <a href="https://wiki.osdev.org/PS/2_Keyboard#Commands">ุฏุณุชูุฑุงุช ูพฺฉุฑุจูุฏ</a> ููฺฉู ุงุณุช.</p>
<h2 id="khlsh"><a class="zola-anchor" href="index.html#khlsh" aria-label="Anchor link for: khlsh">๐</a>ุฎูุงุตู</h2>
<p>ุฏุฑ ุงู ูพุณุช ูุญูู ูุนุงู ุณุงุฒ ู ูุฏุฑุช ูููู ูุง ุฎุงุฑุฌ ุชูุถุญ ุฏุงุฏู ุดุฏ. ูุง ุฏุฑ ููุฑุฏ 8259 PIC ู ุทุฑุญ ุงููู/ุซุงููู ุขู ุ ูฺฏุงุดุช ุฏูุจุงุฑู ุงุนุฏุงุฏ ูููู ู ุณฺฏูุงู โูพุงุงู ููููโ ุงุทูุงุนุงุช ฺฉุณุจ ฺฉุฑุฏู. ูุง ฺฉูุชุฑู ฺฉููุฏูโูุง ุฑุง ุจุฑุง ุชุงูุฑ ุณุฎุช ุงูุฒุงุฑ ู ุตูุญู ฺฉูุฏ ูพุงุฏู ุณุงุฒ ฺฉุฑุฏู ู ุฏุฑุจุงุฑู ุฏุณุชูุฑุงุช <code>hlt</code> ุงุทูุงุนุงุช ฺฉุณุจ ฺฉุฑุฏู ฺฉู ูพุฑุฏุงุฒูุฏู ุฑุง ุชุง ูููู ุจุนุฏ ูุชููู ู ฺฉูุฏ.</p>
<p>ุงฺฉููู ูุง ูุงุฏุฑ ุจู ุชุนุงูู ุจุง ูุณุชู ุฎูุฏ ูุณุชู ู ุจุฑุฎ ุงุฒ ุนูุงุตุฑ ุงุณุงุณ ุจุฑุง ุงุฌุงุฏ ฺฉ ูพูุณุชู(Shell) ฺฉูฺฺฉ ุง ุจุงุฒ ูุง ุณุงุฏู ุฑุง ุฏุงุฑู.</p>
<h2 id="mrhlh-b-dy-chyst"><a class="zola-anchor" href="index.html#mrhlh-b-dy-chyst" aria-label="Anchor link for: mrhlh-b-dy-chyst">๐</a>ูุฑุญูู ุจุนุฏ ฺุณุชุ</h2>
<p>ูููู ูุง ุชุงูุฑ ุจุฑุง ฺฉ ุณุณุชู ุนุงูู ุถุฑูุฑ ุงุณุชุ ุฒุฑุง ุฑุงู ุจุฑุง ูุทุน ุฏูุฑู ุง ุฑููุฏ ุงุฌุฑุง ู ฺฉูุชุฑู ูุฌุฏุฏ ูุณุชู ูุฑุงูู ู ฺฉูุฏ. ุณูพุณ ูุณุชู ู ุชูุงูุฏ ุจู ูุฑุงูุฏ ุฏฺฏุฑ ุณูฺ ฺฉูุฏ ู ุงู ุชููู ุฑุง ุงุฌุงุฏ ฺฉูุฏ ฺฉู ฺูุฏู ูุฑุขูุฏ ุจู ุทูุฑ ููุงุฒ ุงุฌุฑุง ู ุดููุฏ.</p>
<p>ุงูุง ูุจู ุงุฒ ุงูฺฉู ุจุชูุงูู ูุฑุงูุฏูุง ุง ูุฎโูุง ุฑุง ุงุฌุงุฏ ฺฉูู ุ ุจู ุฑูุด ุจุฑุง ุงุฎุชุตุงุต ุญุงูุธู ุจุฑุง ุขููุง ูุงุฒ ุฏุงุฑู. ุฏุฑ ูพุณุช ูุง ุจุนุฏุ ูุฏุฑุช ุญุงูุธู ููุฑุฏ ุจุฑุฑุณ ูุฑุงุฑ ู ฺฏุฑุฏ ุชุง ุงู ุนูุตุฑ ุงุณุงุณ ุงุฌุงุฏ ุดูุฏ.</p>

    </div>

    <div class="post-footer-support right-to-left">
        <h2>Support Me</h2>
        
<p>
    Creating and <a href="../../status-update/index.html">maintaining</a> this blog and the associated libraries is a lot of work, but I really enjoy doing it. By supporting me, you allow me to invest more time in new content, new features, and continuous maintenance.
</p>
<p>
    The best way to support me is to <a href="https://github.com/sponsors/phil-opp"><em>sponsor me on GitHub</em></a>, since they don't charge any fees. If you prefer other platforms, I also have <a href="https://www.patreon.com/phil_opp"><em>Patreon</em></a> and <a href="https://donorbox.org/phil-opp"><em>Donorbox</em></a> accounts. The latter is the most flexible as it supports multiple currencies and one-time contributions.
</p>
<p>
    Thank you!
</p>

    </div>

    <hr>
    <div class="PageNavigation">
        
            <a class="prev" href="../double-fault-exceptions/index.html">&laquo; ุฎุทุงูุง ุฏูฺฏุงูู</a>
        
        
            <a class="next" href="../paging-introduction/index.html">ููุฏููโุง ุจุฑ ุตูุญูโุจูุฏ &raquo;</a>
        
    </div>

    <hr>
    <section>
        <h2 id="comments" class="right-to-left">ูุธุฑุงุช</h2>

        
            
            
            
        
        
    
        
        
    

    
        
        
    

    <p class="comment-note">
        Do you have a problem, want to share feedback, or discuss further ideas? Feel free to leave a comment here! Please stick to English and follow Rust's <a href="https://www.rust-lang.org/policies/code-of-conduct">code of conduct</a>. This comment thread directly maps to a <a href="https://github.com/phil-opp/blog_os/discussions/categories/post-comments-translated?discussions_q=%22Hardware%20Interrupts%20%28fa%29%22"><em>discussion on GitHub</em></a>, so you can also comment there if you prefer.
    </p>

    <div class="giscus"></div>

    <script src="https://giscus.app/client.js"
        data-repo="phil-opp/blog_os"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzOTU3NTEwMQ=="
        data-category="Post Comments (translated)"
        data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDE4OTg1"
    
        data-mapping="specific"
    
        data-term="Hardware Interrupts (fa)"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-theme="preferred_color_scheme"
        data-lang="fa"
        crossorigin="anonymous"
        async>
    </script>

    <p class="comment-directly-on-github">
        Instead of authenticating the <a href="https://giscus.app">giscus</a> application, you can also comment directly <a href="https://github.com/phil-opp/blog_os/discussions/categories/post-comments-translated?discussions_q=%22Hardware%20Interrupts%20%28fa%29%22"><em>on GitHub</em></a>.
    </p>

        <p class="right-to-left">
            ูุทูุง ูุธุฑุงุช ุฎูุฏ ุฑุง ุฏุฑ ุตูุฑุช ุงูฺฉุงู ุจู ุงูฺฏูุณ ุจููุณุฏ.
        </p>
        
    </section>

    <aside class="page-aside-right">
        <div class="block" id="language-selector">
            <h2>Other Languages</h2>
            
            <ul><li data-lang-switch-to="en" class=""><a href="../../hardware-interrupts/index.html">
                        English (original)
                    </a></li><li data-lang-switch-to="zh-CN" class=""><a href="../../zh-CN/hardware-interrupts/index.html">
                        Chinese (simplified)
                    </a></li><li data-lang-switch-to="ja" class=""><a href="../../ja/hardware-interrupts/index.html">
                        Japanese
                    </a></li><li data-lang-switch-to="ko" class=""><a href="../../ko/hardware-interrupts/index.html">
                        Korean
                    </a></li></ul>
        </div>
    </aside>

</main>
        </div>

        <div></div>

        <footer class="footer">
            <hr>
            <small>
                &copy; <time datetime="2022">2022</time>. All rights reserved.
                <a class="spaced" href="https://github.com/phil-opp/blog_os#license">License</a>
                <a class="spaced" href="../../contact/index.html">Contact</a>
            </small>
        </footer>
    </div>
</body>

</html>
